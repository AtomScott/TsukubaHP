<!DOCTYPE html>
<html lang="ja">

<head>

    <meta charset="utf-8" />
    <title>PHP: The Right Way</title>
    <meta name="description" content="An easy-to-read, quick reference for PHP best practices, accepted coding standards, and links to authoritative PHP tutorials around the Web" />
    <meta name="robots" content="index,follow,archive" />
    <meta property="og:image:url" content="http://www.phptherightway.com/images/og-image.png" />
    <meta property="og:image:width" content="1024" />
    <meta property="og:image:height" content="640" />
    <meta property="og:title" content="PHP: The Right Way" />
    <meta property="og:description" content="An easy-to-read, quick reference for PHP best practices, accepted coding standards, and links to authoritative PHP tutorials around the Web" />
    <meta property="og:url" content="http://www.phptherightway.com" />
    <meta property="og:site_name" content="PHP: The Right Way" />
    <meta property="og:type" content="website" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <link rel="icon" href="/images/favicon.png" type="image/png" />
    <link rel="stylesheet" href="/styles/syntax.css">
    <style>
        @import url(https://fonts.googleapis.com/earlyaccess/sawarabimincho.css);
/*        .wf-sawarabimincho { font-family: "Sawarabi Mincho"; }*/
        @import url(https://fonts.googleapis.com/earlyaccess/nikukyu.css);
        /*      .wf-nikukyu { font-family: "Nikukyu"; }*/

        @import url(https://fonts.googleapis.com/earlyaccess/nicomoji.css);
        /*        .wf-nicomoji { font-family: "Nico Moji"; }*/
        @import url(https://fonts.googleapis.com/earlyaccess/roundedmplus1c.css);
/*        .wf-roundedmplus1c { font-family: "Rounded Mplus 1c"; }*/
        @import url(https://fonts.googleapis.com/earlyaccess/kokoro.css);
/*        .wf-kokoro { font-family: "Kokoro"; }*/
        @import url(https://fonts.googleapis.com/earlyaccess/hannari.css);
/*        .wf-hannari { font-family: "Hannari"; }*/

        * {
            box-sizing: border-box
        }

        p {
            font-family: 'Nico Moji';
            font-weight: 300;
            font-size: 16px;
        }

        body {
            font-size: 24px;
            line-height: 32px;
            text-rendering: optimizeLegibility
        }

        h1,
        h2,
        h3,
        h4 {
            font-family: 'Noto Sans Japanese', serif;
            font-weight: 200;
        }

        h1,
        .alpha {
            position: relative;
            font-size: 48px;
            font-weight: normal;
            line-height: 50px;
            text-align: center
        }

        h2,
        .beta {
            font-size: 32px;
            font-weight: normal;
            line-height: 36px
        }

        h3,
        .gamma {
            font-size: 24px;
            font-weight: bold;
            line-height: 30px
        }

        blockquote {
            border-left: 3px solid #ccc;
            padding-left: 20px;
            color: #777;
            font-style: italic;
            word-wrap: break-word
        }

        a {
            color: #4f5b93
        }

        a:hover {
            color: #8892bf
        }

        .back-to-top {
            text-align: center
        }

        .back-to-top a {
            background: #4f5b93;
            border-radius: 3px;
            display: inline-block;
            height: 40px;
            padding: 0 20px;
            transition: all .1s ease;
            color: white;
            font-family: 'Noto Sans Japanese', serif;
            font-weight: 200;
            font-size: 13px;
            line-height: 40px;
            text-decoration: none;
            text-transform: uppercase
        }

        .back-to-top a:hover {
            background: #8892bf
        }

        img {
            max-width: 100%
        }

        pre,
        code {
            color: #444;
            font-family: "Source Code Pro", Consolas, "Andale Mono WT", "Andale Mono", "Lucida Console", "Lucida Sans Typewriter", "DejaVu Sans Mono", "Bitstream Vera Sans Mono", "Liberation Mono", "Nimbus Mono L", Monaco, "Courier New", Courier, monospace;
            font-size: 90%
        }

        a pre,
        a code {
            color: inherit
        }

        pre {
            background: #f7f7f7;
            border: 1px solid #eee;
            border-radius: 3px;
            display: block;
            overflow: auto;
            padding: 20px;
            width: 100%
        }

        @media (max-width:767px) {
            body {
                font-size: 18px;
                line-height: 24px
            }
            h1,
            .alpha {
                font-size: 36px;
                line-height: 38px
            }
            h2,
            .beta {
                font-size: 24px;
                line-height: 28px
            }
            h3,
            .gamma {
                font-size: 18px;
                line-height: 23px
            }
            blockquote {
                margin-left: 0
            }
            ul,
            ol {
                padding-left: 1em
            }
            pre {
                padding: 5px 10px
            }
        }

        @media (max-width:360px) {
            body {
                font-size: 16px;
                line-height: 21px
            }
            h1,
            .alpha {
                font-size: 28px;
                line-height: 30px
            }
            h2,
            .beta {
                font-size: 20px;
                line-height: 23px
            }
            h3,
            .gamma {
                font-size: 16px;
                line-height: 20px
            }
        }

        .site-header {
            padding-top: 40px;
            margin-bottom: 40px;
            text-align: center
        }

        .site-header h1 {
            margin: 0;
            font-size: 72px;
            line-height: 60px
        }

        .site-header h1 em {
            display: block;
            font-size: 34px;
            font-style: normal
        }

        .site-header h1 a {
            color: #333;
            text-decoration: none
        }

        .site-header h1 a:hover {
            color: #8892bf
        }

        .site-header .build-date {
            margin-bottom: 10px;
            color: #999;
            font-family: 'Noto Sans Japanese', serif;
            font-weight: 200;
            font-size: 11px;
            text-transform: uppercase
        }

        .site-header .btn-share {
            background: #8892bf;
            border-radius: 3px;
            display: inline-block;
            height: 30px;
            padding: 0 20px;
            vertical-align: baseline;
            color: white;
            font-family: 'Noto Sans Japanese', serif;
            font-weight: 200;
            font-size: 12px;
            line-height: 30px;
            text-decoration: none;
            text-transform: uppercase
        }

        .site-header .fork-me {
            background-image: url(data:image/webp;base64,UklGRngFAABXRUJQVlA4IGwFAAAwIACdASqVAJUAPrVYo04nJSMiJdcZ8OAWiWlu3QptV/XWZry889S39pvhDtX7spk71kZtypOeN/wPFx9ef+b3Bv1s6sfofESBfzUELayeqU9F+E+9sx2pWWGCYjACQgUX9/XfDxiSyHfdDwD9kmuGcj5VsxmHTp80IDkuPKZ6NqSD0n2hh9NmbI4t9LGn7/ZG6so4sxC3Z6FUT4fzitW3xONEwI0+IM5ctRhisFPrVc1j43Ovh5tElgawGDvKDgRf3apN6JTvM9lylo9NAq+GejTkhJPEi0A+ySYzdXvkBzs86dPr+wiwSJ+jT+NDK3sFPmhAc5tJ8dSoYgJH5PEH50XtrTh0Rc2wAAD+/2qQpKK83qn3eSZWTYqFJrdkLfsYaNTQsoviTk1gNJJCbnkAn5P/Wy3xDZA1EXFBwNQxQtpw+9+2WRjLcY3P6c1TN0pY78GN3tj3WtVOfGwC3+rn5nJI0nQiNBR+rkyeLcfX4VV5VGlXvbcX5L+YWV/AQGDv3izh6WgWo3Y/uKYPAWVEW/wnRaDOFqvxp45HayjWEkJ7Hcpc22AMiVzkB8kXv9N//HBBLzeMRrjvse6ISIL/LciDyike5ega2qogNoNeVrY94TNW7v/9O23UCYZ1IjjqGqsxiFao/WgFDO1QDaQAVlga7H8dnd/m+gBGRhoeTjKy2LD94M345EPrDs6RZ4T8jfneBdopZbvyQQNOQsRxhO7obC20GL4ZZBRa7YxX4kSA6ZblNkG0NnEXly8UCc8ith0AzgDQcuH7m8sF0aVmGL3+pTbe4SyCC8+I1C13LbrPnVy0+ZI2yihpdbezVTJ5+6UJB5ulyVllw5kT81yHPToOsNQq6c26pX5LMbkjhUBSawcqy5Aj2VJ/LZqf20S2Eff+7TNWEbBs0C9/QGEmVijAfXlPXawpYv5sbnPcRJuS1bgKagf52kf98TX3Hk2GrZcaioGvveI4tC1lcK8ako5/HDKt4q0H/VyYLEdtnkCZhCPZInG9ZlER6J78pGT+zPomSP+M8qiPH2+SMAT/ShFckf73pl0LLfq5W2jsI8fwjIbAw2uVIuNexKHzso7EBh2kfV/mcZj94nHGOMjvzp+mjYcZeysI+1AjyCkPqQNBzoQ3sSs2sSDtQ3jJAmsCO1Se0H7glhG5q2zv1oSuG69LpLfrQl0IqrlWt3YNKsRgKIVgGHSwrQMQ1PS3IAZa1kTIQIPbYaym6oKCMtIxefAuMlMLfSVWlUtkHNbckL/C8OR+vX68hocYanXEYg5ATy6oIQTBCw5O+mJ1H5+r3WKaxdViGYO5Y5MwxYKBALHq/gtpP99o79ZJ+spIPbTlTbI436fmn/muK6Li1ABxNXXiCkZcWvvdCrX6fzzxVgP6MdJERMGzuS+XSgyMLg/dyzkYGUnh1ANr9fzYciY96t8+VAfrLT5xzx4fkWdTtriC9w5TYqZzGFl/ciepQr4g4g4NXY9FqWRoF6VRzqx/MTJebREF4BLV7vdju4phbq/KcbY6YG7308SVAVS7kxzoo99rq2ZyvQqM0fJBG6u/la5f1GxObjdCGZbd97KMsf5b2+C3VA4/qPo6FN30iYKZUonq5cE1G/UbluwrcCFf9fv9E8zrm9f5km5f99TNdK1Y0ayEAhtMM1KFoq+42Y0JL+PH2YEPLJy28ggxAEnUiQ1pmrYLlUSNZ07M9d+jzOXZH6mZ0eclNYwxEDttRxODx5lo4qnmsKzLKmoJIsiGm0+BZnnRaaM/N9GNLNCtn+pnjpcKfqacbWhk3rD4vQH3nqGRqFY/wwq0WCTUiWFABeP+KlDod5ktPppfR1GFz434QVMCGQlDLwAAAA==);
            background-position: top right;
            background-repeat: no-repeat;
            background-size: contain;
            height: 100px;
            width: 100px;
            position: absolute;
            top: 0;
            right: 0;
            z-index: 100;
            width: 120px
        }

        .site-navigation,
        .site-content,
        .site-footer {
            margin: 0 auto;
            max-width: 840px;
            width: 92%
        }

        .site-navigation {
            -webkit-columns: 3;
            -moz-columns: 3;
            columns: 3;
            -webkit-column-gap: 40px;
            -moz-column-gap: 40px;
            column-gap: 40px
        }

        .site-navigation input[type="checkbox"],
        .site-navigation label {
            display: none
        }

        .site-navigation ul {
            list-style: none;
            margin: 0;
            padding: 0
        }

        .site-navigation ul li {
            margin-bottom: 20px;
            font-size: 22px;
            line-height: 23px
        }

        .site-navigation ul li a {
            display: block;
            color: #444;
            font-weight: 700;
            text-decoration: none
        }

        .site-navigation ul li a:hover {
            color: #8892bf
        }

        .site-navigation ul li ul {
            padding-top: 8px
        }

        .site-navigation ul li li {
            margin-bottom: 6px;
            font-size: 18px
        }

        .site-navigation ul li li a {
            border: none;
            color: #777;
            font-weight: normal
        }

        .site-navigation li {
            -webkit-column-break-inside: avoid;
            page-break-inside: avoid;
            break-inside: avoid
        }

        @media (max-width:820px) {
            .site-navigation {
                -webkit-columns: 2;
                -moz-columns: 2;
                columns: 2
            }
        }

        @media (max-width:560px) {
            .site-navigation {
                -webkit-columns: 1;
                -moz-columns: 1;
                columns: 1
            }
        }

        @media (max-width:375px) {
            .site-navigation {
                background: rgba(255, 255, 255, 0.95);
                -webkit-columns: 1;
                -moz-columns: 1;
                columns: 1;
                max-height: 100vh;
                position: fixed;
                bottom: 0;
                left: 0;
                z-index: 100
            }
            .site-navigation label {
                background: #4f5b93;
                box-sizing: border-box;
                display: block;
                height: 40px;
                padding: 0 10px;
                width: 100vh;
                position: absolute;
                bottom: 0;
                left: 0;
                color: white;
                font-family: 'Noto Sans Japanese', serif;
                font-weight: 200;
                font-size: 13px;
                line-height: 40px;
                text-transform: uppercase;
                z-index: 2
            }
            .site-navigation>ul {
                background: rgba(255, 255, 255, 0.96);
                border-top: 3px solid #8892bf;
                box-shadow: rgba(0, 0, 0, 0.25) 0 -5px 10px;
                box-sizing: border-box;
                padding: 20px;
                overflow: auto;
                -webkit-overflow-scrolling: touch;
                position: absolute;
                left: 0;
                bottom: 40px;
                height: 50vh;
                width: 100vh;
                -webkit-transform: translate(0, 100vh);
                -ms-transform: translate(0, 100vh);
                transform: translate(0, 100vh);
                transition: all .2s ease;
                z-index: 1
            }
            .site-navigation input[type="checkbox"]:checked~ul {
                -webkit-transform: translate(0, 0);
                -ms-transform: translate(0, 0);
                transform: translate(0, 0)
            }
        }

        .site-content h1 {
            padding-top: 40px;
            position: relative
        }

        .site-content h1:after {
            border: 1px solid #ddd;
            border-bottom: none;
            content: "";
            display: block;
            height: 8px;
            position: absolute;
            left: 0;
            top: 0;
            width: 100%
        }

        .site-content.chapters {
            counter-reset: chapter
        }

        .site-content.chapters h1 {
            counter-increment: chapter;
            padding-top: 60px
        }

        .site-content.chapters h1:before {
            display: inline-block;
            content: "Chapter " counter(chapter) ".";
            position: absolute;
            top: 30px;
            left: 50%;
            -webkit-transform: translateX(-50%);
            -ms-transform: translateX(-50%);
            transform: translateX(-50%);
            color: #999;
            font-size: 12px;
            letter-spacing: 1px;
            line-height: 20px;
            text-transform: uppercase;
            text-align: center
        }

        .site-content #welcome ul {
            -webkit-columns: 3;
            -moz-columns: 3;
            columns: 3;
            -webkit-column-gap: 30px;
            -moz-column-gap: 30px;
            column-gap: 30px;
            list-style-position: inside
        }

        .site-content .back-to-top {
            margin-bottom: 60px
        }

        @media (max-width:870px) {
            .site-content #welcome ul {
                -webkit-columns: 2;
                -moz-columns: 2;
                columns: 2
            }
        }

        @media (max-width:600px) {
            .site-content #welcome ul {
                -webkit-columns: 1;
                -moz-columns: 1;
                columns: 1
            }
        }

        .site-footer {
            border-top: 1px solid #ccc;
            margin: 60px auto 0 auto;
            padding: 40px 20px;
            font-family: 'Noto Sans Japanese', serif;
            font-weight: 200;
            font-size: 16px;
            text-align: center
        }

        .site-footer .cc-badge {
            background-image: url(data:image/webp;base64,UklGRvIDAABXRUJQVlA4TOUDAAAvV4AHEAfCsG3bSEnR/Xe5zf7XibwGg0aSFM2Dfy/v7Bh/+hxEkqRIfeRfyzlj+O/pGoJsmwrMH/QAj5CEdJ8WUlvcd5aLtt39kQ6AaOPANB8AJBkOQDsABm1A1D3KbQCDBgaAXzLfxZV2ouXB45LzT0YJgei3mn8S/AMX/nhsvcoaNjg+298+lpz5JJdnff7204oadu9PWrQNcNXb8q04ExARMTe2bSsNPKx8JXF37+zG5j8rePf96AAi+s/AbSNFWeYcPkKCbW1tG50PNxEJjXp6j3tvGkWyg/e/K/n/QfF4FhDRfwWOpDSAXXGtj2jhP9UIuMuyJI7CwPeV8jylfD8IozhJs7v7h8fHp6fnq2hsKU3iMPCVK6XjOI6UrqKMabVcy7I0icJAuXK817Rzej+mjGmUzEsCKucWuYgkRBKFvif7R9uhHPvS43b/8PD4VQL5cpkD5ReXS0kcSUxhS+NX09NpuqLh29Alo+RNY9cVQojuDprBXk7CxGHAgp62Bdd3DZSh54dxmt09lFgJIQACQknCSQabRpJMNSMTJgoUhaJep0XbBbCVKqBkhl2PCQHtMH9+nqP4FGLwoxcdk8TcBgBQkgkR+m4fKM61TdZ3WVLCWCjb3noTaFPKKl9hOsaLQWJuiuNhB8zMhAiUPELfCNFgGkeeICeOFeo9pwlyPD8jXyyqqlp0ejYSScdYiAxxNhPCd8fAVDQoHQ/Grh8mKZYk9e3kxeVZiOTPAsCiZyNJgYtIBmSViUPuodtCnHZ5PuWehkIIjb08F38lnKSz+K6qza2FpHl+ErlHSU17e2IvJn8lTzUH7biWKozS3xQYSftd9OiC5N6kHKhID6gbHmAoRIFD93R4L1B0Xw/vrOhQA3Uxhhm3g5Fsqu9vLF5mR28yBFarC8aBKZ4DnGpgY4BxxGzfHC+Ikil2ppi3mUg6kx89aNtJVnbb9qlt9AVoYFn7MWXJXx8nGW0aSbTXK9jkZaN9c5gWKMgTLzBXL9f4P8JTjNkMT+f1Gl2yu7cSKFbLwva7XU7iNtpCC4uj17z2RI0H7oi+0scr/c/s+xhe8B7v7h8en57/tQb/H93f/x/XEf+/+7jov2PhOoKZkmugMH48dpv4/zzGtXWp5BbQ07ZRO9XAX+nNcGWlrEdZ6NX0dJquNCjvfVmw+HMkAE5igTjzWOFIJBh548fRhnHs2wKRGyUbLFsg47Gw1fNI5PWgK/v7ejwN3/elq+rWxi04o1pXaMRWOC6r4uVg8ahcKaXjSCld9Zg3oJ5LTcLYGY8Vj0Xe2CIfJUp5nlLJiHKXRry+3pWGs2f+PrT+V4kAAA==);
            background-position: top left;
            background-repeat: no-repeat;
            background-size: contain;
            display: inline-block;
            height: 31px;
            width: 88px
        }

        .site-footer h2 {
            font-size: 24px;
            font-weight: bold;
            line-height: 30px;
            margin-bottom: 10px
        }

        .site-footer ul {
            list-style: none;
            margin: 0 0 20px 0;
            padding: 0
        }

        .site-footer .license {
            color: #777;
            font-size: 13px
        }

    </style>
    <!-- CSS_ADSBLOCK_START -->
    <link rel="stylesheet" href="http://adblockers.opera-mini.net/css_block/default-domainless.css" type="text/css" />
    <!-- CSS_ADSBLOCK_END -->
</head>

<body>
    <header class="site-header">
        <h1><a href="/">PHP <em>The Right Way</em></a></h1>
        <div class="build-date">最終更新日時: 2017-05-07 01:47:49 +0000</div>
        <div class="share">
            <a class="btn-share" href="https://twitter.com/intent/tweet?text=PHP+The+Right+Way&amp;url=http%3A%2F%2Fwww.phptherightway.com&amp;hashtags=PHP" target="_blank">Share on Twitter</a>
        </div>
        <a class="fork-me" href="https://github.com/codeguy/php-the-right-way" target="_blank"></a>
    </header>

    <nav class="site-navigation">
        <input type="checkbox" id="toggle" />
        <label for="toggle">Table of Contents</label>
        <ul>
            <li><a href="/#welcome">ようこそ</a>
                <ul>
                    <li><a href="/#translations">翻訳</a></li>
                    <li><a href="/#how-to-contribute">協力するには</a></li>
                    <li><a href="/#spread-the-word">拡散希望</a></li>
                </ul>
            </li>





            <li><a href="/#getting_started">はじめに</a>

                <ul>





                    <li><a href="/#use_the_current_stable_version">最新の安定版 (7.1) を使う</a>

                    </li>




                    <li><a href="/#builtin_web_server">ビルトインウェブサーバー</a>

                    </li>




                    <li><a href="/#mac_setup">Mac の人は</a>

                    </li>




                    <li><a href="/#windows_setup">Windows の人は</a>

                    </li>





                </ul>
            </li>



            <li><a href="/#code_style_guide">コーディングスタイル</a>

                <ul>






                </ul>
            </li>



            <li><a href="/#language_highlights">言語仕様のポイント</a>

                <ul>





                    <li><a href="/#programming_paradigms">プログラミングのパラダイム</a>

                    </li>




                    <li><a href="/#namespaces">名前空間</a>

                    </li>




                    <li><a href="/#standard_php_library">Standard PHP Library</a>

                    </li>




                    <li><a href="/#command_line_interface">コマンドラインインターフェイス</a>

                    </li>




                    <li><a href="/#xdebug">Xdebug</a>

                    </li>





                </ul>
            </li>



            <li><a href="/#dependency_management">依存関係の管理</a>

                <ul>





                    <li><a href="/#composer_and_packagist">Composer と Packagist</a>

                    </li>




                    <li><a href="/#pear">PEAR</a>

                    </li>





                </ul>
            </li>



            <li><a href="/#coding_practices">コーディングに関する慣習</a>

                <ul>





                    <li><a href="/#the_basics">基本</a>

                    </li>




                    <li><a href="/#date_and_time">日付や時刻の扱いかた</a>

                    </li>




                    <li><a href="/#design_patterns">デザインパターン</a>

                    </li>




                    <li><a href="/#php_and_utf8">UTF-8の扱い</a>

                    </li>




                    <li><a href="/#i18n_l10n">Internationalization and Localization</a>

                    </li>





                </ul>
            </li>



            <li><a href="/#dependency_injection">依存性の注入</a>

                <ul>





                    <li><a href="/#basic_concept">基本的な概念</a>

                    </li>




                    <li><a href="/#complex_problem">複雑な問題</a>

                    </li>




                    <li><a href="/#containers">コンテナ</a>

                    </li>




                    <li><a href="/#further_reading">あわせて読みたい</a>

                    </li>





                </ul>
            </li>



            <li><a href="/#databases">データベース</a>

                <ul>





                    <li><a href="/#mysql_extension">MySQL 用の拡張モジュール</a>

                    </li>




                    <li><a href="/#pdo_extension">PDO 拡張モジュール</a>

                    </li>




                    <li><a href="/#databases_interacting">データベースとのやりとり</a>

                    </li>




                    <li><a href="/#databases_abstraction_layers">抽象化レイヤー</a>

                    </li>





                </ul>
            </li>



            <li><a href="/#templating">テンプレート</a>

                <ul>





                    <li><a href="/#templating_benefits">メリット</a>

                    </li>




                    <li><a href="/#plain_php_templates">プレーンなPHPによるテンプレート</a>

                    </li>




                    <li><a href="/#compiled_templates">コンパイル形式のテンプレート</a>

                    </li>




                    <li><a href="/#templating_further_reading">あわせて読みたい</a>

                    </li>





                </ul>
            </li>



            <li><a href="/#errors_and_exceptions">エラーと例外処理</a>

                <ul>





                    <li><a href="/#errors">エラー</a>

                    </li>




                    <li><a href="/#exceptions">例外処理</a>

                    </li>





                </ul>
            </li>



            <li><a href="/#security">セキュリティ</a>

                <ul>





                    <li><a href="/#web_application_security">ウェブアプリケーションのセキュリティ</a>

                    </li>




                    <li><a href="/#password_hashing">パスワードのハッシュ処理</a>

                    </li>




                    <li><a href="/#data_filtering">データのフィルタリング</a>

                    </li>




                    <li><a href="/#configuration_files">設定ファイル</a>

                    </li>




                    <li><a href="/#register_globals">Register Globals</a>

                    </li>




                    <li><a href="/#error_reporting">エラーレポート</a>

                    </li>





                </ul>
            </li>



            <li><a href="/#testing">テスト</a>

                <ul>





                    <li><a href="/#test_driven_development">テスト駆動開発</a>

                    </li>




                    <li><a href="/#behavior_driven_development">振る舞い駆動開発</a>

                    </li>




                    <li><a href="/#complementary_testing_tools">その他のテスト用ツール</a>

                    </li>





                </ul>
            </li>



            <li><a href="/#servers_and_deployment">各種サーバーへのデプロイ</a>

                <ul>





                    <li><a href="/#platform_as_a_service">Platform as a Service (PaaS)</a>

                    </li>




                    <li><a href="/#virtual_or_dedicated_servers">仮想サーバー（専用サーバー）</a>

                    </li>




                    <li><a href="/#shared_servers">共有サーバー</a>

                    </li>




                    <li><a href="/#building_and_deploying_your_application">アプリケーションのビルドとデプロイ</a>

                    </li>





                </ul>
            </li>



            <li><a href="/#virtualization">仮想化</a>

                <ul>





                    <li><a href="/#vagrant">Vagrant</a>

                    </li>




                    <li><a href="/#docker">Docker</a>

                    </li>





                </ul>
            </li>



            <li><a href="/#caching">キャッシュ</a>

                <ul>





                    <li><a href="/#opcode_cache">オペコードキャッシュ</a>

                    </li>




                    <li><a href="/#object_caching">オブジェクトキャッシュ</a>

                    </li>





                </ul>
            </li>



            <li><a href="/#documenting">Documenting your Code</a>

                <ul>





                    <li><a href="/#phpdoc">PHPDoc</a>

                    </li>





                </ul>
            </li>



            <li><a href="/#resources">情報源</a>

                <ul>





                    <li><a href="/#from_the_source">ソースから</a>

                    </li>




                    <li><a href="/#people_to_follow">フォローすべき人たち</a>

                    </li>




                    <li><a href="/#mentoring">メンタリング</a>

                    </li>




                    <li><a href="/#php_paas_providers">PHP PaaS プロバイダ</a>

                    </li>




                    <li><a href="/#frameworks">フレームワーク</a>

                    </li>




                    <li><a href="/#components">コンポーネント</a>

                    </li>




                    <li><a href="/#other_resources">その他の資料</a>

                    </li>




                    <li><a href="/#videos">動画チュートリアル</a>

                    </li>




                    <li><a href="/#books">書籍</a>

                    </li>





                </ul>
            </li>



            <li><a href="/#community">コミュニティ</a>

                <ul>





                    <li><a href="/#user_groups">PHP ユーザーグループ</a>

                    </li>




                    <li><a href="/#conferences">PHP カンファレンス</a>

                    </li>




                    <li><a href="/#elephpants">Elephpants</a>

                    </li>



                </ul>
            </li>
            <li><a href="/#credits">クレジット</a></li>
        </ul>
    </nav>

    <div class="site-content chapters">

        <section class="chapter" id="welcome">
            <h1 id="ようこそ">ようこそ</h1>

            <p>時代遅れの情報がウェブ上にあふれている。そんな情報を見たPHP初心者は戸惑ってしまうだろう。そして、まずい手法やまずいコードが広まってしまう。 そんなのはもうやめよう。
                <em>PHP: The Right Way</em> は気軽に読めるクイックリファレンスだ。PHPの一般的なコーディング規約、 ウェブ上のよくできたチュートリアルへのリンク、そして現時点でのベストプラクティスだと執筆者が考えていることをまとめた。


            <p>このサイトは今も成長中なので、有用な情報やサンプルなどが見つかればどんどん更新していくつもりだ。</p>

            <h2 id="翻訳">翻訳</h2>

            <p><em>PHP: The Right Way</em> は、他の言語にも翻訳されている。</p>

            <ul>
                <li><a href="http://www.phptherightway.com">English</a></li>
                <li><a href="http://rwetzlmayr.github.io/php-the-right-way">Deutsch</a></li>
                <li><a href="http://phpdevenezuela.github.io/php-the-right-way">Español</a></li>
                <li><a href="http://eilgin.github.io/php-the-right-way/">Français</a></li>
                <li><a href="http://id.phptherightway.com">Indonesia</a></li>
                <li><a href="http://it.phptherightway.com">Italiano</a></li>
                <li><a href="http://pl.phptherightway.com">Polski</a></li>
                <li><a href="http://br.phptherightway.com">Português do Brasil</a></li>
                <li><a href="https://bgui.github.io/php-the-right-way/">Română</a></li>
                <li><a href="http://sl.phptherightway.com">Slovenščina</a></li>
                <li><a href="http://phpsrbija.github.io/php-the-right-way/">Srpski</a></li>
                <li><a href="http://hkulekci.github.io/php-the-right-way/">Türkçe</a></li>
                <li><a href="http://bg.phptherightway.com">български</a></li>
                <li><a href="http://getjump.github.io/ru-php-the-right-way">Русский язык</a></li>
                <li><a href="http://iflista.github.com/php-the-right-way">Українська</a></li>
                <li><a href="https://adaroobi.github.io/php-the-right-way/">العربية</a></li>
                <li><a href="http://novid.github.io/php-the-right-way/">فارسى</a></li>
                <li><a href="https://apzentral.github.io/php-the-right-way/">ภาษาไทย</a></li>
                <li><a href="http://modernpug.github.io/php-the-right-way">한국어판</a></li>
                <li><a href="http://ja.phptherightway.com">日本語</a></li>
                <li><a href="http://laravel-china.github.io/php-the-right-way/">简体中文</a></li>
                <li><a href="http://laravel-taiwan.github.io/php-the-right-way">繁體中文</a></li>
            </ul>

            <h2 id="book">Book</h2>

            <p>最新版の <em>PHP: The Right Way</em> （英語版）はPDFやEPUBやMOBIでも公開されている。 <a href="https://leanpub.com/phptherightway">Leanpubでゲットしよう。</a></p>

            <h2 id="協力するには">協力するには</h2>

            <p>みんなでこのサイトをもっとよいものにしよう。PHPを勉強したい人たちのために良質な情報を集めるんだ! <a href="https://github.com/codeguy/php-the-right-way/tree/gh-pages">GitHubでね。</a></p>

            <h2 id="拡散希望">拡散希望</h2>

            <p><em>PHP: The Right Way</em> のバナー画像を用意したので、みんなのサイトで使ってほしい。 PHPを勉強したい人たちに「いい情報がここにあるよ！」ってぜひ伝えよう。
            </p>

            <p><a href="/banners.html">バナー画像</a></p>


        </section>



        <div class="back-to-top">
            <p><a href="#top" class="top">Back to Top</a></p>
        </div>
        <section class="chapter" id="getting_started">
            <h1 id="getting_started_title">はじめに</h1>


        </section>


        <section class="chapter" id="use_the_current_stable_version">
            <h2 id="use_the_current_stable_version_title">最新の安定版 (7.1) を使う</h2>

            <p>とりあえず PHP を試したいっていうのなら、最新の安定版である <a href="http://php.net/downloads.php">PHP 7.1</a> を使おう。 PHP 7.1 は公開されたばかりの最新版で、PHP 5.x 系にはない数々の強力な<a href="#language_highlights">新機能</a>が追加された。 エンジンが大幅に書き直された PHP 7.0 は、今までのバージョンよりもずっと高速になっている。</p>

            <p>とはいえ、しばらくは PHP 5.x を使うという人も多いだろう。PHP 5.x の最新バージョンは、5.6 系だ。 これを使うのも悪くない。でも、最新版をできるだけ早めに試してみるべきだ。 PHP 5.6の <a href="http://php.net/supported-versions.php">セキュリティ更新は、2018年になると提供されなくなる。</a> アップグレードはとても簡単だ。というのも、
                <a href="http://php.net/manual/migration71.incompatible.php">過去との互換性を損なうような変更</a> がそんなに多くないからだ。 何かの関数や機能がどのバージョンに含まれているのかを知りたければ、
                <a href="http://php.net/manual/">php.net</a> にあるマニュアルを調べよう。</p>


        </section>


        <section class="chapter" id="builtin_web_server">
            <h2 id="builtin_web_server_title">ビルトインウェブサーバー</h2>

            <p>PHPの勉強を始めるときに、わざわざ本格的なウェブサーバーをインストールする必要はない。そう、PHP 5.4以降ならね。サーバーを立ち上げたかったら、ターミナルでプロジェクトのルートディレクトリに行って、こんなコマンドを実行するだけでいいんだ。</p>

            <figure class="highlight">
                <pre><code class="language-console" data-lang="console"><span class="err">&gt; php -S localhost:8000</span></code></pre>
            </figure>

            <ul>
                <li><a href="http://php.net/features.commandline.webserver">コマンドラインで使えるビルトインウェブサーバーについて、もっと調べる</a></li>
            </ul>


        </section>


        <section class="chapter" id="mac_setup">
            <h2 id="mac_setup_title">Mac の人は</h2>

            <p>OS X には PHP が最初からインストールされているけど、最新の安定版からは微妙に遅れている。 Mavericks についてくるのは PHP 5.4.17 だし Yosemite でも 5.5.9。El Capitan にしても 5.5.29 だし Sierra でも 5.6.24 だ。 PHP 7.1 に比べると、十分だとはいえない。</p>

            <p>PHP を OS X にインストールするには、いくつかの方法がある。</p>

            <h3 id="homebrew-によるインストール">Homebrew によるインストール</h3>

            <p><a href="http://brew.sh/">Homebrew</a> は OS X 用の強力なパッケージ管理ツールで、 PHP やその拡張モジュールも簡単にインストールできる。
                <a href="https://github.com/Homebrew/homebrew-php#installation">Homebrew PHP</a> が、Homebrew 用の PHP 関連の “Formula” をまとめたリポジトリだ。 これを使えば PHP をインストールできる。</p>

            <p>現時点では、<code class="highlighter-rouge">php53</code>、<code class="highlighter-rouge">php54</code>、<code class="highlighter-rouge">php55</code>、<code class="highlighter-rouge">php56</code>、<code class="highlighter-rouge">php70</code>、<code class="highlighter-rouge">php71</code> が <code class="highlighter-rouge">brew install</code> コマンドでインストールできる。 これらを切り替えるには、環境変数 <code class="highlighter-rouge">PATH</code> を設定すればいい。
                <a href="https://github.com/philcook/brew-php-switcher">brew-php-switcher</a> を使えば、そのへんを自動的にやってくれる。</p>

            <h3 id="macports-によるインストール">Macports によるインストール</h3>

            <p><a href="https://www.macports.org/install.php">MacPorts</a> プロジェクトはオープンソースのコミュニティによる取り組みで、 OS X上のオープンソースソフトウェアのコンパイルやインストールそしてアップグレードを簡単にできるようにする仕組みだ。 コマンドラインのソフトからX11やAquaベースのソフトにまで対応している。
            </p>

            <p>MacPorts はコンパイル済みのバイナリにも対応しているので、関連するライブラリなどを毎回ソースからコンパイルしなおす必要はない。 なので、まだ何もパッケージをインストールしていない状態でも、時間の心配をする必要はない。
            </p>

            <p>現時点でインストールできるのは <code class="highlighter-rouge">php54</code>、<code class="highlighter-rouge">php55</code>、<code class="highlighter-rouge">php56</code>、<code class="highlighter-rouge">php70</code>、<code class="highlighter-rouge">php71</code> のいずれかで、<code class="highlighter-rouge">port install</code> コマンドを使ってこのようにインストールする。</p>

            <div class="highlighter-rouge">
                <pre class="highlight"><code>sudo port install php56
sudo port install php71
</code></pre>
            </div>

            <p>そして、<code class="highlighter-rouge">select</code> コマンドを使って、アクティブな PHP を切り替える。</p>

            <div class="highlighter-rouge">
                <pre class="highlight"><code>sudo port select --set php php71
</code></pre>
            </div>

            <h3 id="phpbrew-によるインストール">phpbrew によるインストール</h3>

            <p><a href="https://github.com/phpbrew/phpbrew">phpbrew</a> は、複数のバージョンの PHP をインストールして管理するためのツールだ。 使っているアプリケーションやプロジェクトによって、PHP のバージョンが異なる場合に特に便利で、 仮想マシンを用意する必要がなくなる。
            </p>

            <h3 id="liipのバイナリインストーラーによる-php-のインストール">Liipのバイナリインストーラーによる PHP のインストール</h3>

            <p><a href="http://php-osx.liip.ch/">php-osx.liip.ch</a> は、たった一行で PHP をインストールできる方法だ。バージョン 5.3 から 7.1 に対応している。 Apple がインストールした php のバイナリは上書きせず、まったく別の場所 (/usr/local/php5) にすべてをインストールする。</p>

            <h3 id="ソースからのコンパイル">ソースからのコンパイル</h3>

            <p>もうひとつの選択肢がある。 <a href="http://php.net/install.macosx.compile">自分でコンパイル</a> することで、この方法なら PHP の設定を完全にコントロールできる。 この場合は、Xcode あるいはその代用ツール <a href="https://developer.apple.com/downloads">“Command Line Tools for XCode”</a> をインストールする必要がある。これらは、 Apple の Mac Developer Center からダウンロードできる。</p>

            <h3 id="全部入りのインストーラー">全部入りのインストーラー</h3>

            <p>ここまでの方法は主に PHP 本体だけを扱うもので、たとえば Apache や Nginx、そしてデータベースサーバーなどは用意していない。 いわゆる「全部入り」のソリューションである <a href="http://www.mamp.info/en/downloads/">MAMP</a> や <a href="http://www.apachefriends.org/jp/xampp.html">XAMPP</a> を使えば、 これらのソフトウェアもまとめてインストールしてくれる。 でも、簡単にインストールできるぶん、柔軟性に欠けるという弱点もある。
            </p>


        </section>


        <section class="chapter" id="windows_setup">
            <h2 id="windows_setup_title">Windows の人は</h2>

            <p><a href="http://windows.php.net/download/">windows.php.net/download</a> からバイナリをダウンロードしよう。それを展開したら、 PHPフォルダのルート (php.exe がある場所) に <a href="http://www.windows-commandline.com/set-path-command-line/">PATH</a> を通しておくといい。そうすれば、どこからでも PHP を実行できるようになる。</p>

            <p>学習用にローカルで開発する場合は PHP 5.4 以降のビルトインウェブサーバーを使えばよいので、細かい設定を気にする必要はない。 もしウェブサーバーとかMySQLとかも含めた「全部入り」を使いたければ、
                <a href="https://www.microsoft.com/web/downloads/platform.aspx">Web Platform Installer</a>や
                <a href="http://www.apachefriends.org/en/xampp.html">XAMPP</a>、<a href="http://www.easyphp.org/">EasyPHP</a>、<a href="http://open-server.ru/">OpenServer</a>、そして<a href="http://www.wampserver.com/en/">WAMP</a>などがお勧めだ。これらを使えば Windows 用の開発環境を手早く構築できる。 とはいうものの、これらのツールは実際の運用環境と微妙に異なる。なので、たとえば「Windows で開発して Linux にデプロイ」 とかいう場合は環境の違いに気をつける必要がある。
            </p>

            <p>Windows 上でシステムを実運用する場合は、IIS 7 を使うとよい。これが一番安定しており、かつパフォーマンスも優れている。
                <a href="http://phpmanager.codeplex.com/">phpmanager</a> (IIS 7 用の GUI プラグイン) を使えば PHP の設定は管理をシンプルにできる。 IIS 7 には FastCGI が組み込まれており、すぐに使える。 単に PHP をハンドラとして設定するだけでよい。 その値の詳しい情報は、
                <a href="http://php.iis.net/">dedicated area on iis.net</a>に PHP 専用のエリアがある。</p>

            <p>開発環境と運用環境が違っていると、いざ動かしたときにおかしなバグが発生しがちだ。 Windowsで開発したアプリケーションをLinux（などの非Windows環境）で動かしているのなら、
                <a href="/#virtualization_title">仮想マシン</a>を使うべきだ。</p>

            <p>Chris Tankersley has a very helpful blog post on what tools he uses to do <a href="http://ctankersley.com/2016/11/13/developing-on-windows-2016/">PHP development using Windows</a>.</p>


        </section>

        <div class="back-to-top">
            <p><a href="#top" class="top">Back to Top</a></p>
        </div>
        <section class="chapter" id="code_style_guide">
            <h1 id="code_style_guide_title">コーディングスタイル</h1>

            <p>PHP のコミュニティはとてもでっかくて、いろんな人たちがいる。 そして、数え切れないほどのライブラリやフレームワークそしてコンポーネントが存在する。 そんな中からいくつか選んで、それを組み合わせてひとつのプロジェクトで使うっていうのもよくあることだ。 大切なのは、PHP のコードを書くときに、(できるだけ) 標準的なスタイルに従うことだ。 そうすれば、いろんなライブラリを組み合わせて使うのも簡単になる。
            </p>

            <p><a href="http://www.php-fig.org/">Framework Interop Group</a> っていうところ が、おすすめのスタイルを提案している。 コーディングスタイルに関する提案は、
                <a href="http://www.php-fig.org/psr/psr-0/">PSR-0</a>と<a href="http://www.php-fig.org/psr/psr-1/">PSR-1</a>、<a href="http://www.php-fig.org/psr/psr-2/">PSR-2</a>、そして<a href="http://www.php-fig.org/psr/psr-4/">PSR-4</a>だ。 これって要するに、 Drupal や Zend、Symfony、Laravel、CakePHP、phpBB、AWS SDK、FuelPHP、Lithium などのプロジェクトが採用しつつある規約をまとめただけのものなんだ。 自分のプロジェクトでこれを使ってもいいし、今までの自分のスタイルを使い続けてもいい。
            </p>

            <p>理想を言えば、PHP のコードを書くときには、よく知られた何らかの標準規約に従うべきだ。 さっき説明したPSRの組み合わせでもいいし、PEARとかZendのやつでもかまわない。 そうすれば、他の人にもコードを読んでもらいやすくなるし、手助けも得やすくなるだろう。 また、コンポーネントを実装するアプリケーションがいろんなサードパーティのコードを組み合わせても、一貫性を保てる。
            </p>

            <ul>
                <li><a href="http://www.php-fig.org/psr/psr-0/">PSR-0 とは</a></li>
                <li><a href="http://www.php-fig.org/psr/psr-1/">PSR-1 とは</a></li>
                <li><a href="http://www.php-fig.org/psr/psr-2/">PSR-2 とは</a></li>
                <li><a href="http://www.php-fig.org/psr/psr-4/">PSR-4 とは</a></li>
                <li><a href="http://pear.php.net/manual/ja/standards.php">PEARのコーディング規約</a></li>
                <li><a href="http://symfony.com/doc/current/contributing/code/standards.html">Symfonyのコーディング規約</a></li>
            </ul>

            <p><a href="http://pear.php.net/package/PHP_CodeSniffer/">PHP_CodeSniffer</a>を使えば、 自分のコードがこれらの標準のどれかひとつに準拠しているかどうかを確認できる。 あと、
                <a href="https://github.com/benmatselby/sublime-phpcs">Sublime Text</a>みたいなテキストエディタのプラグインを使えば、 書いているその場でリアルタイムのフィードバックが得られる。
            </p>

            <p>コードのレイアウトを自動的に修正するツールとしては、二つの選択肢がある。</p>

            <ul>
                <li><a href="http://cs.sensiolabs.org/">PHP Coding Standards Fixer</a>がそのひとつで、これはきちんとテストされているコードだ。</li>
                <li>もうひとつの選択肢は <a href="https://github.com/squizlabs/PHP_CodeSniffer/wiki/Fixing-Errors-Automatically">PHP Code Beautifier and Fixer</a> で、これはPHP_CodeSnifferに含まれている。これを使って、コードのレイアウトを適切に調整できる。</li>
            </ul>

            <p>phpcs をシェルから手動で実行することもできる。</p>

            <div class="highlighter-rouge">
                <pre class="highlight"><code>phpcs -sw --standard=PSR2 file.php
</code></pre>
            </div>

            <p>これは、エラーの内容とその修正方法を表示してくれる。 このコマンドをgit hookに仕込んでおけば便利だろう。 そうすれば、標準規約に反する変更を含むブランチは、それを修正するまでリポジトリに投入できなくなる。
            </p>

            <p>PHP_CodeSnifferを使っている場合は、指摘されたコードレイアウトの問題を自動的に修正することもできる。そのためには<a href="https://github.com/squizlabs/PHP_CodeSniffer/wiki/Fixing-Errors-Automatically">PHP Code Beautifier and Fixer</a>を使えばいい。</p>

            <div class="highlighter-rouge">
                <pre class="highlight"><code>phpcbf -w --standard=PSR2 file.php
</code></pre>
            </div>

            <p>もうひとつの選択肢は<a href="http://cs.sensiolabs.org/">PHP Coding Standards Fixer</a>で、 これは、実際に修正するまえにコードにどんな問題があったのかを表示してくれる。
            </p>

            <div class="highlighter-rouge">
                <pre class="highlight"><code>php-cs-fixer fix -v --level=psr2 file.php
</code></pre>
            </div>

            <p>変数名や関数名、そしてディレクトリ名なんかは、英語にしておくことをおすすめする。 コードのコメントに関しては、別に英語にこだわらなくてもかまわない。 そのコードを扱う(将来扱う可能性がある)すべての人が読みやすいものであれば、何語でもかまわない。
            </p>


        </section>

        <div class="back-to-top">
            <p><a href="#top" class="top">Back to Top</a></p>
        </div>
        <section class="chapter" id="language_highlights">
            <h1 id="language_highlights_title">言語仕様のポイント</h1>

        </section>


        <section class="chapter" id="programming_paradigms">
            <h2 id="programming_paradigms_title">プログラミングのパラダイム</h2>

            <p>PHP は柔軟性のある動的言語で、いろんなプログラミングテクニックに対応している。 長年の間に劇的に成長してきた。PHP 5.0 でのオブジェクト指向モデルの追加 (2004 年)、 PHP 5.3 での無名関数や名前空間の追加 (2009 年)、そして PHP 5.4 でのトレイトの追加 (2012 年) などが特筆すべきところだろう。</p>

            <h3 id="オブジェクト指向プログラミング">オブジェクト指向プログラミング</h3>

            <p>PHP には完全なオブジェクト指向プログラミングの機能が搭載されている。 クラスや抽象クラス、インターフェイス、継承、コンストラクタ、クローン、 例外などなどといった機能も、当然使える。
            </p>

            <ul>
                <li><a href="http://php.net/language.oop5">PHP のオブジェクト指向</a></li>
                <li><a href="http://php.net/language.oop5.traits">トレイト</a></li>
            </ul>

            <h3 id="関数プログラミング">関数プログラミング</h3>

            <p>PHP は、ファーストクラスの関数をサポートしている。 つまり、関数を変数に代入できるってことだ。 自分で定義した関数だろうがもともと組み込まれている関数だろうが、 変数で参照したり動的に実行したりできる。 何かの関数を別の関数の引数として渡すこと ( <em>高階関数</em> っていう機能) もできるし、関数の返り値を別の関数にすることもできる。
            </p>

            <p>再帰 (ある関数の中から自分自身を呼ぶこと) も PHP の機能としてサポートしている。 しかし、たいていの PHP コードはそれよりも逐次処理を重視している。</p>

            <p>新型の無名関数 (クロージャにも対応したもの) が使えるようになったのは、PHP 5.3 (2009 年) 以降だ。</p>

            <p>PHP 5.4 からは、クロージャをオブジェクトのスコープにバインドできるようになった。 また callable のサポートも強化され、ほとんどの場合で無名関数と互換性を持つようになった。</p>

            <ul>
                <li>詳しくは <a href="/pages/Functional-Programming.html">PHP における関数型プログラミング</a> で</li>
                <li><a href="http://php.net/functions.anonymous">無名関数</a></li>
                <li><a href="http://php.net/class.closure">Closure クラス</a></li>
                <li><a href="https://wiki.php.net/rfc/closures">クロージャの詳細を知りたければ、RFCを読めばいいよ</a></li>
                <li><a href="http://php.net/language.types.callable">Callable</a></li>
                <li><a href="http://php.net/function.call-user-func-array"><code class="highlighter-rouge">call_user_func_array()</code>による動的な関数実行</a></li>
            </ul>

            <h3 id="メタプログラミング">メタプログラミング</h3>

            <p>PHP はいろんな形式のメタプログラミングに対応しており、リフレクション API やマジックメソッドが使える。 マジックメソッドには <code class="highlighter-rouge">__get()</code> や <code class="highlighter-rouge">__set()</code>、<code class="highlighter-rouge">__clone()</code>、<code class="highlighter-rouge">__toString()</code>、そして <code class="highlighter-rouge">__invoke()</code> などがあり、これらを活用すればクラスの振る舞いをフックできる。 Ruby の人がよく「PHP には <code class="highlighter-rouge">method_missing</code> がなくてさあ」とか言うけど、ちゃんと
                <code class="highlighter-rouge">__call()</code> とか <code class="highlighter-rouge">__callStatic()</code> があるよ。</p>

            <ul>
                <li><a href="http://php.net/language.oop5.magic">マジックメソッド</a></li>
                <li><a href="http://php.net/intro.reflection">リフレクション</a></li>
                <li><a href="http://php.net/language.oop5.overloading">オーバーロード</a></li>
            </ul>


        </section>


        <section class="chapter" id="namespaces">
            <h2 id="namespaces_title">名前空間</h2>

            <p>さっきも言ったとおり、PHP のコミュニティでは多くの人たちがいろんなコードを書いている。 ってことは、誰かが書いたライブラリと別の人が書いたライブラリでクラス名がダブってしまう可能性があるということだ。 両者が同じ名前空間を使っていたら、衝突して問題の原因となってしまう。
            </p>

            <p>そんな問題を解決するのが <em>名前空間</em> だ。 マニュアルにあるとおり、名前空間っていうのは OS のファイルシステムのディレクトリと似てる。 同じ名前のふたつのファイルを同一ディレクトリに置くことはできないけど、 別々のディレクトリに分ければ共存できるというわけだ。 同様に、別々の名前空間に分ければ同じ名前のクラスがふたつあっても共存できる。簡単に言うと、そういうこと。
            </p>

            <p>自分の書くコードにも、名前空間を指定することが大切だ。 そうすれば、誰か他の人があなたのコードを使うときに「これ、他のライブラリと競合しないかな」 と悩まずに済む。
            </p>

            <p>名前空間のおすすめの使い方が <a href="http://www.php-fig.org/psr/psr-4/">PSR-4</a> にまとまっている。 この文書の狙いは、ファイルやクラスそして名前空間の命名規則を標準化して お互いに再利用しやすくすることだ。
            </p>

            <p>2014年10月、PHP-FIG はオートローディングに関する標準であった <a href="http://www.php-fig.org/psr/psr-0/">PSR-0</a> を非推奨とした。 PSR-0もPSR-4も、今はどちらでも使える。 というのも PSR-4 は PHP 5.3 以降が必須だけれど、今でも PHP 5.2 のプロジェクトはたくさんあって、それらが PSR-0 に従っているからだ。</p>

            <p>これから新しくアプリケーションやパッケージを作るときにオートローダーの使いかたの参考にするのなら、まず間違いなく PSR-4 だ。</p>

            <ul>
                <li><a href="http://php.net/language.namespaces">名前空間</a></li>
                <li><a href="http://www.php-fig.org/psr/psr-0/">PSR-0</a></li>
                <li><a href="http://www.php-fig.org/psr/psr-4/">PSR-4</a></li>
            </ul>


        </section>


        <section class="chapter" id="standard_php_library">
            <h2 id="standard_php_library_title">Standard PHP Library</h2>

            <p>Standard PHP Library (SPL) とは PHP に組み込まれた標準ライブラリで、 さまざまなクラスやインターフェイスを提供する。 よく使うデータ構造 (スタックやキュー、ヒープなど) やイテレータなどが含まれており、SPL のインターフェイスを実装したクラスをつくれば それをイテレータで反復処理されることもできる。
            </p>

            <ul>
                <li><a href="http://php.net/book.spl">SPL</a></li>
                <li><a href="http://www.lynda.com/PHP-tutorials/Up-Running-Standard-PHP-Library/175038-2.html">Lynda.comのSPL動画コース(有償)</a></li>
            </ul>


        </section>


        <section class="chapter" id="command_line_interface">
            <h2 id="command_line_interface_title">コマンドラインインターフェイス</h2>

            <p>PHP はもともとウェブアプリケーションを書くために作られたものだが、 コマンドラインインターフェイス (CLI) のプログラムを書くのにも便利だ。 コマンドラインのプログラムを書けば、テストやデプロイといった よくある作業を自動化する助けとなる。
            </p>

            <p>CLI の PHP プログラムが便利なのは、アプリケーションのコードを使うときに わざわざウェブの UI を用意せずに済むところだ。 ただ、CLI の PHP スクリプトをウェブサーバーの公開ディレクトリに置くことは <strong>絶対禁止</strong> ！</p>

            <p>PHP をコマンドラインで実行してみよう。</p>

            <figure class="highlight">
                <pre><code class="language-console" data-lang="console"><span class="err">&gt; php -i</span></code></pre>
            </figure>

            <p><code class="highlighter-rouge">-i</code> は、PHP の設定情報を <a href="http://php.net/function.phpinfo"><code class="highlighter-rouge">phpinfo</code></a> 関数みたいに表示するオプションだ。</p>

            <p><code class="highlighter-rouge">-a</code> オプションで対話シェルを使えるようになる。ruby の IRB とか、Python の対話シェルと同じようなものだ。 それ以外にも、いろんな <a href="http://php.net/features.commandline.options">コマンドラインオプション</a> がある。</p>

            <p>じゃあ、シンプルな “Hello, $name” プログラムを書いてみよう。<code class="highlighter-rouge">hello.php</code> というファイルを作って、 こんな内容にする。
            </p>

            <figure class="highlight">
                <pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$argc</span> <span class="o">!==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="s2">"Usage: php hello.php [name].</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
    <span class="k">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>
<span class="nv">$name</span> <span class="o">=</span> <span class="nv">$argv</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<span class="k">echo</span> <span class="s2">"Hello, </span><span class="nv">$name</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span></code></pre>
            </figure>

            <p>PHP のスクリプトを実行すると、コマンドラインの引数に関する変数がふたつ設定される。
                <a href="http://php.net/reserved.variables.argc"><code class="highlighter-rouge">$argc</code></a> は整数値で、引数の <em>数</em> を表し、
                <a href="http://php.net/reserved.variables.argv"><code class="highlighter-rouge">$argv</code></a> は配列で、各引数の <em>値</em> を含む。 最初の引数は、常に PHP スクリプトのファイル名となる。今回の場合なら <code class="highlighter-rouge">hello.php</code> だ。</p>

            <p><code class="highlighter-rouge">exit()</code> でゼロ以外の数値を返すと、コマンドが失敗したことをシェルに伝えることができる。 よく使われる終了コードは <a href="http://www.gsp.com/cgi-bin/man.cgi?section=3&amp;topic=sysexits">ここ</a> で調べよう。</p>

            <p>このスクリプトをコマンドラインから実行すると、次のようになる。</p>

            <figure class="highlight">
                <pre><code class="language-console" data-lang="console">&gt; php hello.php
Usage: php hello.php [name]
&gt; php hello.php world
<span class="err">Hello, world</span></code></pre>
            </figure>

            <ul>
                <li><a href="http://php.net/features.commandline">PHP をコマンドラインから実行する方法</a></li>
                <li><a href="http://php.net/install.windows.commandline">Windows でもコマンドラインから PHP を実行したい！</a></li>
            </ul>


        </section>


        <section class="chapter" id="xdebug">
            <h2 id="xdebug_title">Xdebug</h2>

            <p>ソフトウェア開発におけるいちばん便利なツールといえば、よくできたデバッガだ。 こいつがあれば、コードを実行しながらその状態を追いかけて、スタックの中身を監視したりできる。 XdebugはPHP用のデバッガで、さまざまなIDEに組み込んで使える。 ブレークポイントを設定したりスタックの中身を見たりできるんだ。 さらに、PHPUnitやKCacheGrindといったツールと組み合わせれば、 コードカバレッジ解析やプロファイリングもできる。
            </p>

            <p>「実はいま困ってるんだよ。仕方なしに<code class="highlighter-rouge">var_dump()</code>とか<code class="highlighter-rouge">print_r()</code>に頼ってるけど、もっといいやりかたがないかなあ…」 そんな君に必要なのは、たぶんデバッガだ。
            </p>

            <p><a href="http://xdebug.org/docs/install">Xdebugのインストール</a>はちょっと面倒だけど、 重要な機能として「リモートデバッグ」が使えるようになる。 ふだんはローカルで開発しているけど、テストはVMや別のサーバーでしているという人は、 今すぐにでも使えるようにしたい機能だろう。
            </p>

            <p>慣例にしたがって、ApacheのVHostあるいは.htaccessファイルにこんな値を設定する。</p>

            <figure class="highlight">
                <pre><code class="language-ini" data-lang="ini"><span class="err">php_value</span> <span class="err">xdebug.remote_host</span> <span class="err">192.168.?.?</span>
<span class="err">php_value</span> <span class="err">xdebug.remote_port</span> <span class="err">9000</span></code></pre>
            </figure>

            <p>“remote host”と”remote port”は、それぞれ開発に使っているホストとIDEがリスンしているポートに対応する。 あとはIDEの設定で「接続をリスンする」モードに変えて、こんなURLを読み込むだけだ。
            </p>

            <div class="highlighter-rouge">
                <pre class="highlight"><code>http://your-website.example.com/index.php?XDEBUG_SESSION_START=1
</code></pre>
            </div>

            <p>これで、IDEがスクリプトの実行に割り込んで、ブレークポイントを設定したり メモリの中身を調べたりできるようになる。
            </p>

            <p>グラフィカルなデバッガを使えば、コードをステップ実行したり変数の中身を調べたり、 今の実行環境上でコードを評価したりといったことが簡単にできるようになる。 たいていのIDEには、Xdebugを使ったグラフィカルなデバッグの仕組みが初めから組み込まれているか、 あるいはプラグインが用意されている。 MacGDBpというソフトもある。これは、Xdebugを使うためのフリーでオープンソースなMac用GUI環境で、スタンドアロンで使える。
            </p>

            <ul>
                <li><a href="http://xdebug.org/docs/">Xdebugについてさらに調べる</a></li>
                <li><a href="http://www.bluestatic.org/software/macgdbp/">MacGDBpについてさらに調べる</a></li>
            </ul>


        </section>

        <div class="back-to-top">
            <p><a href="#top" class="top">Back to Top</a></p>
        </div>
        <section class="chapter" id="dependency_management">
            <h1 id="dependency_management_title">依存関係の管理</h1>

            <p>PHP のライブラリやフレームワークやコンポーネントって、大量に存在する。 きっと、あなたのプロジェクトでも何個か使っているだろう。そういうのを、プロジェクトの依存関係という。 つい最近まで、PHP には依存関係をうまく管理する仕組みがなかった。 手作業で管理していたところで、オートローダーのことも気にしないといけない。 もううんざりだ。
            </p>

            <p>現時点でよく使われているパッケージ管理システムは、<a href="/#composer_and_packagist">Composer</a> と <a href="/#pear">PEAR</a> である。 Composer は現在 PHP のパッケージマネージャーとしていちばん人気があるものだけれど、かつてはパッケージマネージャーといえば PEAR だった。 PEAR の歴史も知っておいたほうがいい。今でも PEAR を使っているところがあるかもしれないし、 たとえ決して使うことがないとしても、知っておいて損はないだろう。
            </p>


        </section>


        <section class="chapter" id="composer_and_packagist">
            <h2 id="composer_and_packagist_title">Composer と Packagist</h2>

            <p>Composerは、PHP用の <strong>すばらしい</strong> 依存管理ツールだ。プロジェクト内の依存関係を
                <code class="highlighter-rouge">composer.json</code> ファイルに書いてシンプルなコマンドを打ち込めば、 Composer が自動的にそれをダウンロードしてくれるだけでなく、オートロードの設定までしてくれるんだ。 Composer は、node.js の NPM や Ruby の Bundler みたいなものだ。</p>

            <p>Composer に対応したライブラリは既にいろいろ出回っていて、自分のプロジェクトですぐに使える。 そんなパッケージをまとめたのが <a href="http://packagist.org/">Packagist</a>。これは、Composer 対応の PHP ライブラリをまとめた公式リポジトリである。</p>

            <h3 id="composer-のインストール">Composer のインストール</h3>

            <p>composer をダウンロードするいちばん安全な方法は、<a href="https://getcomposer.org/download/">公式サイトの指示に従うこと</a>。 この方法だと、インストーラが壊れていたり改ざんされていたりしないかを確かめられる。 インストーラは Composer を <em>ローカルに</em> インストールする。つまり、いま作業中のディレクトリにインストールするということ。</p>

            <p>お勧めは、<em>グローバルにインストールする</em> (要するに、/usr/local/bin にだけ置く) 方式だ。 そのためには、次のコマンドを実行すればいい。
            </p>

            <figure class="highlight">
                <pre><code class="language-console" data-lang="console"><span class="err">mv composer.phar /usr/local/bin/composer</span></code></pre>
            </figure>

            <p><strong>注意:</strong> パーミッションのエラーでこのコマンドが失敗する場合は、頭に <code class="highlighter-rouge">sudo</code> をつけて実行してみよう。</p>

            <p>ローカルにインストールした Composer を実行するときには <code class="highlighter-rouge">php composer.phar</code> とする。グローバルにインストールしたのなら、単に <code class="highlighter-rouge">composer</code> と打つだけだ。</p>

            <h4 id="windows-でのインストール">Windows でのインストール</h4>

            <p>Windowsの場合、一番簡単なのは [ComposerSetup][6] インストーラーを使う方法だ。 これは、すべてのユーザーで使えるようにインストールしたうえで <code class="highlighter-rouge">$PATH</code> も設定してくれるので、 あとはコマンドラインから <code class="highlighter-rouge">composer</code> を呼ぶだけで使えるようになる。</p>

            <h3 id="composer-の手動インストール">Composer の手動インストール</h3>

            <p>手動で Composer をインストールするのは初心者にはおすすめできない。 でもなぜか、さっきのインストール方法よりも手作業でのインストールをしたがる人もいるらしい。 さっきの対話的なインストールでは何をしていたのかというと、こんなことを確かめていたんだ。
            </p>

            <ul>
                <li>適切なバージョンの PHP が入っている</li>
                <li><code class="highlighter-rouge">.phar</code> ファイルを正しく実行できる</li>
                <li>ディレクトリのパーミッションが適切に設定されている</li>
                <li>問題のある特定の拡張モジュールがロードされていない</li>
                <li><code class="highlighter-rouge">php.ini</code> の設定が適切にされている</li>
            </ul>

            <p>手作業でのインストールではこういったチェックは一切行わない。 それでもいいの？
            </p>

            <p>それでもいいという人向けに、手動での Composer のインストール方法を示す。</p>

            <figure class="highlight">
                <pre><code class="language-console" data-lang="console">curl -s https://getcomposer.org/composer.phar -o $HOME/local/bin/composer
<span class="err">chmod +x $HOME/local/bin/composer</span></code></pre>
            </figure>

            <p><code class="highlighter-rouge">$HOME/local/bin</code> (あるいは、その他あなたが指定した場所) にパスを通しておく必要がある。 これで、
                <code class="highlighter-rouge">composer</code> コマンドが使えるようになるだろう。</p>

            <p>何かのドキュメントに「<code class="highlighter-rouge">php composer.phar install</code> で Composer を実行します」と書いてあれば、 その部分を次のように読み替えればいい。
            </p>

            <figure class="highlight">
                <pre><code class="language-console" data-lang="console"><span class="err">composer install</span></code></pre>
            </figure>

            <p>このセクションでは、composer をグローバルにインストールしたものとして説明する。</p>

            <h3 id="依存関係の定義とインストール">依存関係の定義とインストール</h3>

            <p>Composer は、プロジェクトの依存関係を <code class="highlighter-rouge">composer.json</code> というファイルで管理する。 このファイルを手で書き換えてもいいし、Composer を使って編集してもいい。</p>

            <p><code class="highlighter-rouge">composer require</code> を実行すると、プロジェクトの依存関係を追加する。 もしまだ <code class="highlighter-rouge">composer.json</code> がなければ、新しいファイルを作る。 この例は、プロジェクトの依存関係に <a href="http://twig.sensiolabs.org">Twig</a> を追加するものだ。</p>

            <figure class="highlight">
                <pre><code class="language-console" data-lang="console"><span class="err">composer require twig/twig:~1.8</span></code></pre>
            </figure>

            <p>あるいは、 <code class="highlighter-rouge">composer init</code> コマンドを実行して、 自分のプロジェクト用の完全な <code class="highlighter-rouge">composer.json</code> ファイルを作ることもできる。 どちらの方法にせよ、一度 <code class="highlighter-rouge">composer.json</code> ファイルを作ってしまえば、 あとは Composer がすべての依存ライブラリをダウンロードして <code class="highlighter-rouge">vendor/</code> にインストールしてくれる。 次のコマンドは、すでに <code class="highlighter-rouge">composer.json</code> ファイルを含むプロジェクトをダウンロードした場合にも使える。</p>

            <figure class="highlight">
                <pre><code class="language-console" data-lang="console"><span class="err">composer install</span></code></pre>
            </figure>

            <p>次に、アプリケーションで最初に呼ばれる PHP ファイルにこんな行を追加する。 これは、Composer のオートローダーを使ってプロジェクトの依存ライブラリを読むよう指示している。</p>

            <figure class="highlight">
                <pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="k">require</span> <span class="s1">'vendor/autoload.php'</span><span class="p">;</span></code></pre>
            </figure>

            <p>これで、依存ライブラリが使えるようになった。実際に使う場面で、必要に応じて読み込まれる。</p>

            <h3 id="依存関係の更新">依存関係の更新</h3>

            <p>Composer は <code class="highlighter-rouge">composer.lock</code> というファイルを作る。 これは、最初に <code class="highlighter-rouge">composer install</code> を実行したときにダウンロードした、各パッケージの正確なバージョンを記録しておくものだ。 他の開発者とプロジェクトを共有するときに <code class="highlighter-rouge">composer.lock</code> も一緒に配布しておくと、 他の人が <code class="highlighter-rouge">composer install</code> を実行したときにもまったく同じバージョンがインストールされるようになる。 依存関係を更新するには、 <code class="highlighter-rouge">composer update</code> を実行しよう。 デプロイのときには <code class="highlighter-rouge">composer update</code> を使ってはいけない。必ず <code class="highlighter-rouge">composer install</code> を使うこと。 そうしないと、開発環境と運用環境で違うバージョンのパッケージを使ってしまうことになる。
            </p>

            <p>これは、バージョンの要件を柔軟に定義できるので便利だ。 たとえば、バージョンに <code class="highlighter-rouge">~1.8</code> と書いた場合は「<code class="highlighter-rouge">1.8.0</code> 以降のバージョン。ただし <code class="highlighter-rouge">2.0.x-dev</code> は含まない」と指定したことになる。 ワイルドカード <code class="highlighter-rouge">*</code> を使って <code class="highlighter-rouge">1.8.*</code> のように指定してもいい。 これで、Composer で <code class="highlighter-rouge">php composer.phar update</code> を実行したときに、 定義した制約の範囲での最新版に依存ライブラリを更新してくれる。
            </p>

            <h3 id="更新通知">更新通知</h3>

            <p>新バージョンのリリースの通知を受け取りたければ <a href="https://www.versioneye.com/">VersionEye</a> にサインアップするといい。 このサービスは、自分の GitHub アカウントや BitBucket アカウントにある
                <code class="highlighter-rouge">composer.json</code> の内容を監視して、パッケージの新しいリリースがあればメールで教えてくれるものだ。</p>

            <h3 id="依存ライブラリのセキュリティ問題のチェック">依存ライブラリのセキュリティ問題のチェック</h3>

            <p><a href="https://security.sensiolabs.org/">Security Advisories Checker</a> は、Webサービスとコマンドラインツールとして提供されている。
                <code class="highlighter-rouge">composer.lock</code> ファイルを調べて、もし依存関係に更新が必要なら教えてくれるものだ。</p>

            <h3 id="composerでのグローバルな依存関係の扱い">Composerでのグローバルな依存関係の扱い</h3>

            <p>Composer は、グローバルな依存関係やそのバイナリを扱うこともできる。 使いかたはとても簡単で、単にコマンドの前に <code class="highlighter-rouge">global</code> をつけるだけでいい。 たとえば、PHPUnit をグローバルに使えるようインストールしたければ、こんなコマンドを実行する。</p>

            <figure class="highlight">
                <pre><code class="language-console" data-lang="console"><span class="err">composer global require phpunit/phpunit</span></code></pre>
            </figure>

            <p>このコマンドは、 <code class="highlighter-rouge">~/.composer</code> ディレクトリを作って、グローバルな依存関係をそこに置く。 インストールされたパッケージのバイナリを全体で使えるようにするには、 <code class="highlighter-rouge">~/.composer/vendor/bin</code> ディレクトリを環境変数 <code class="highlighter-rouge">$PATH</code> に追加すればいい。</p>

            <ul>
                <li><a href="http://getcomposer.org/doc/00-intro.md">Composerとは</a></li>
            </ul>


        </section>


        <section class="chapter" id="pear">
            <h2 id="pear_title">PEAR</h2>

            <p>古くからあるパッケージ管理ツールが <a href="http://pear.php.net/">PEAR</a> だ。 Composer と同じような感じだけど、違うところもある。</p>

            <p>PEARの個々のパッケージは、ルールに従った構造にしておかないといけない。 つまり、PEARで使えるようにするにはパッケージの作者がきちんと準備しておかないといけないってことだ。 PEARで使うことを想定していないプロジェクトは、PEARではうまく使えない。
            </p>

            <p>PEARはパッケージをグローバル環境にインストールする。つまり、 何かパッケージをインストールすれば、同じサーバー上のすべてのプロジェクトでそのパッケージが使えるようになる。 すべてのプロジェクトが同じパッケージの同じバージョンを使ってるというのなら、これは便利だ。 でも、プロジェクトによって使っているバージョンが違うなんていう場合はちょっとまずいことになる可能性がある。
            </p>

            <h3 id="pearのインストール">PEARのインストール</h3>

            <p>PEARをインストールするには、<code class="highlighter-rouge">.phar</code> インストーラをダウンロードして実行すればいい。 PEARのドキュメントを見れば、各種OS向けに
                <a href="http://pear.php.net/manual/en/installation.getting.php">インストール手順の詳しい説明</a> がある。</p>

            <p>Linuxを使っている場合は、ディストリビューションが提供しているパッケージマネージャーもチェックしよう。 たとえば、DebianやUbuntuには <code class="highlighter-rouge">php-pear</code> というaptパッケージが用意されている。</p>

            <h3 id="パッケージのインストール">パッケージのインストール</h3>

            <p><a href="http://pear.php.net/packages.php">PEAR パッケージリスト</a>にあるパッケージなら、名前を指定して次のようにインストールできる。</p>

            <figure class="highlight">
                <pre><code class="language-console" data-lang="console"><span class="err">pear install foo</span></code></pre>
            </figure>

            <p>別のチャネルで公開されているパッケージをインストールするには、まずそのチャネルを
                <code class="highlighter-rouge">discover</code> しないといけない。そして、インストールのときにもチャネル名を指定する。 詳しくは <a href="http://pear.php.net/manual/en/guide.users.commandline.channels.php">チャネルの使い方に関するドキュメント</a> を参照すること。</p>

            <ul>
                <li><a href="http://pear.php.net/">PEARについて調べる</a></li>
            </ul>

            <h3 id="pearの依存関係をcomposerで管理する">PEARの依存関係をComposerで管理する</h3>

            <p>既に<a href="/#composer_と_packagist">Composer</a>を使っているけれどもPEARのコードもインストールしたいという場合は、 ComposerにPEARの依存関係を処理させることもできる。 たとえばこれは、
                <code class="highlighter-rouge">pear2.php.net</code>のコードをインストールする例だ。</p>

            <figure class="highlight">
                <pre><code class="language-json" data-lang="json"><span class="p">{</span><span class="w">
    </span><span class="nt">"repositories"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"pear"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://pear2.php.net"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nt">"require"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"pear-pear2/PEAR2_Text_Markdown"</span><span class="p">:</span><span class="w"> </span><span class="s2">"*"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"pear-pear2/PEAR2_HTTP_Request"</span><span class="p">:</span><span class="w"> </span><span class="s2">"*"</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span></code></pre>
            </figure>

            <p>最初のセクションでは、<code class="highlighter-rouge">"repositories"</code>を使ってComposerにpearリポジトリを「初期化」 (PEARの用語でいうと「discover」)する。 そして、
                <code class="highlighter-rouge">require</code>セクションではパッケージ名を次のように指定する。</p>

            <blockquote>
                <p>pear-channel/Package</p>
            </blockquote>

            <p>“pear”というプレフィックスをハードコードすることで、衝突を回避している。 というのも、pearチャネルの名前と別のパッケージベンダーの名前が同じになってしまう可能性があるからだ。 このようにして、チャネルの短縮名（あるいは完全なURL）を使ってそのパッケージが属するチャネルを指定できるようにする。
            </p>

            <p>このコードをインストールすると、venderディレクトリの中にチャネル名のディレクトリができあがって、 Composerのオートローダーを通して自動的に使えるようになる。
            </p>

            <blockquote>
                <p>vendor/pear-pear2.php.net/PEAR2_HTTP_Request/pear2/HTTP/Request.php</p>
            </blockquote>

            <p>このPEARパッケージを使うには、単純にこのように参照するだけでいい。</p>

            <figure class="highlight">
                <pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="nv">$request</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">pear2\HTTP\Request</span><span class="p">();</span></code></pre>
            </figure>

            <ul>
                <li><a href="http://getcomposer.org/doc/05-repositories.md#pear">PEARとComposerの組み合わせについて調べる</a></li>
            </ul>


        </section>

        <div class="back-to-top">
            <p><a href="#top" class="top">Back to Top</a></p>
        </div>
        <section class="chapter" id="coding_practices">
            <h1 id="coding_practices_title">コーディングに関する慣習</h1>

        </section>


        <section class="chapter" id="the_basics">
            <h2 id="the_basics_title">基本</h2>

            <p>PHP はとても懐が深い言語で、いろんなレベルの技術者が使えるし、手早く効率的にコードを書くことができる。 しかし実際に使っているうちに、初めて身につけたときの基本を忘れてしまい、 横着する方法とかあまりよろしくない習慣とかばかり身につけてしまう。 そんな風潮に一石を投じるために書いたのがこのセクションだ。PHPでコードを書くときの基本を忘れないようにしよう。
            </p>

            <ul>
                <li>詳しくは <a href="/pages/The-Basics.html">基本</a> で</li>
            </ul>

        </section>


        <section class="chapter" id="date_and_time">
            <h2 id="date_and_time_title">日付や時刻の扱いかた</h2>

            <p>PHP の DateTime クラスを使えば、日付や時刻の読み書き、比較、そして計算ができる。 PHP には DateTime クラス以外にも日付や時刻がらみの関数が大量にあるけど、 DateTime クラスにはちゃんとしたオブジェクト指向のインターフェイスがあるので たいていの場合はこのクラスを使ったほうがいい。 タイムゾーンだって扱えるけど、ここではそこまでは深追いしない。
            </p>

            <p>DateTime を使って何かの操作をするためには、日付や時刻を表す文字列をファクトリーメソッド
                <code class="highlighter-rouge">createFromFormat()</code> でオブジェクトに変換するか、あるいは <code class="highlighter-rouge">new DateTime</code> で現在の日時を取得する。
                <code class="highlighter-rouge">format()</code> メソッドを使えば、DateTime を文字列に戻して出力できる。</p>

            <figure class="highlight">
                <pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="nv">$raw</span> <span class="o">=</span> <span class="s1">'22. 11. 1968'</span><span class="p">;</span>
<span class="nv">$start</span> <span class="o">=</span> <span class="nx">DateTime</span><span class="o">::</span><span class="na">createFromFormat</span><span class="p">(</span><span class="s1">'d. m. Y'</span><span class="p">,</span> <span class="nv">$raw</span><span class="p">);</span>

<span class="k">echo</span> <span class="s1">'Start date: '</span> <span class="o">.</span> <span class="nv">$start</span><span class="o">-&gt;</span><span class="na">format</span><span class="p">(</span><span class="s1">'Y-m-d'</span><span class="p">)</span> <span class="o">.</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span></code></pre>
            </figure>

            <p>DateTime を使った計算をするときに使えるのが the DateInterval クラスだ。 DateTime には <code class="highlighter-rouge">add()</code> や <code class="highlighter-rouge">sub()</code> といった関数があって、その引数に指定するのがこの DateInterval となる。 1日が86400秒であることを前提としたコードを書いてはいけない。 サマータイムとかタイムゾーンの移動がからむと、この前提はあっさり崩れてしまうからだ。 そんなときには DateInterval を使う。二つの日付の差を計算するときには
                <code class="highlighter-rouge">diff()</code> メソッドを使う。このメソッドは DateInterval を返し、結果を表示するのも簡単だ。</p>

            <figure class="highlight">
                <pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="c1">// $start をコピーして、1か月と6日を足す
</span><span class="nv">$end</span> <span class="o">=</span> <span class="k">clone</span> <span class="nv">$start</span><span class="p">;</span>
<span class="nv">$end</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="k">new</span> <span class="nx">DateInterval</span><span class="p">(</span><span class="s1">'P1M6D'</span><span class="p">));</span>

<span class="nv">$diff</span> <span class="o">=</span> <span class="nv">$end</span><span class="o">-&gt;</span><span class="na">diff</span><span class="p">(</span><span class="nv">$start</span><span class="p">);</span>
<span class="k">echo</span> <span class="s1">'Difference: '</span> <span class="o">.</span> <span class="nv">$diff</span><span class="o">-&gt;</span><span class="na">format</span><span class="p">(</span><span class="s1">'%m month, %d days (total: %a days)'</span><span class="p">)</span> <span class="o">.</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
<span class="o">//</span> <span class="nx">Difference</span><span class="o">:</span> <span class="mi">1</span> <span class="nx">month</span><span class="p">,</span> <span class="mi">6</span> <span class="nx">days</span> <span class="p">(</span><span class="nx">total</span><span class="o">:</span> <span class="mi">37</span> <span class="nx">days</span><span class="p">)</span></code></pre>
            </figure>

            <p>DateTime オブジェクトどうしでごく普通に比較することもできる。</p>

            <figure class="highlight">
                <pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$start</span> <span class="o">&lt;</span> <span class="nv">$end</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="s2">"Start is before the end!</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
<span class="p">}</span></code></pre>
            </figure>

            <p>最後にもうひとつ DatePeriod クラスの例を示そう。繰り返し発生するイベントを順に処理するときに使える。 開始日時と終了日時を表す二つの DateTime 、そしてイベントの間隔を受け取って、すべてのイベントを返すものだ。</p>

            <figure class="highlight">
                <pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="c1">// $start から $end までの間のすべての木曜日を返す
</span><span class="nv">$periodInterval</span> <span class="o">=</span> <span class="nx">DateInterval</span><span class="o">::</span><span class="na">createFromDateString</span><span class="p">(</span><span class="s1">'first thursday'</span><span class="p">);</span>
<span class="nv">$periodIterator</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DatePeriod</span><span class="p">(</span><span class="nv">$start</span><span class="p">,</span> <span class="nv">$periodInterval</span><span class="p">,</span> <span class="nv">$end</span><span class="p">,</span> <span class="nx">DatePeriod</span><span class="o">::</span><span class="na">EXCLUDE_START_DATE</span><span class="p">);</span>
<span class="k">foreach</span> <span class="p">(</span><span class="nv">$periodIterator</span> <span class="k">as</span> <span class="nv">$date</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 毎木曜日を表示する
</span>    <span class="k">echo</span> <span class="nv">$date</span><span class="o">-&gt;</span><span class="na">format</span><span class="p">(</span><span class="s1">'Y-m-d'</span><span class="p">)</span> <span class="o">.</span> <span class="s1">' '</span><span class="p">;</span>
<span class="p">}</span></code></pre>
            </figure>

            <p>PHP APIの拡張として有名なのが <a href="http://carbon.nesbot.com">Carbon</a> だ。 これは DateTime クラスのすべてを継承しているので、コードの書き換えを最小限に抑えられる。 さらに追加機能として、地域化のサポートや、 DateTimeオブジェクトの加減算とフォーマットの方法の追加がある。 また、自分で選んだ日付と時刻をシミュレートする機能もあって、これはコードをテストするときに使える。
            </p>

            <ul>
                <li><a href="http://php.net/book.datetime">DateTime</a></li>
                <li><a href="http://php.net/function.date">日付の書式</a> (日付の書式指定文字列に使えるオプション)</li>
            </ul>


        </section>


        <section class="chapter" id="design_patterns">
            <h2 id="design_patterns_title">デザインパターン</h2>

            <p>アプリケーションをつくるときには、一般的なパターンに従ってコードを書くとよい。 同じくプロジェクトの全体構造についても、一般的なパターンに従おう。 なぜそうするといいかというと、自分のコードを管理しやすくなるし、 何がどうなっているのかを他の開発者にもわかってもらいやすくなるからだ。
            </p>

            <p>フレームワークを使ってコードを書くと、上位レベルのコードやプロジェクトの構造のほとんどはそのフレームワークの流儀に従うことになる。 すでにそこには、いろんなパターンが適用されているだろう。 ただ、そのフレームワークの上で書く自分のコードの中でどんなパターンを適用するかは、自分次第だ。 一方、フレームワークを使わずにコードを書く場合はどうだろう。 自分が書こうとしているアプリケーションのタイプや規模に応じて、最適なパターンをみつける必要がある。
            </p>

            <ul>
                <li>詳しくは <a href="/pages/Design-Patterns.html">デザインパターン</a> で</li>
            </ul>

        </section>


        <section class="chapter" id="php_and_utf8">
            <h2 id="php_and_utf8_title">UTF-8の扱い</h2>

            <p><em>このセクションは、もともと<a href="https://alexcabal.com/">Alex Cabal</a>が
<a href="https://phpbestpractices.org/#utf-8">PHP Best Practices</a>向けに書いたものだ。この記事をもとに、UTF-8について説明する。</em></p>

            <h3 id="一発で済ませる方法はない注意してきちんと一貫性を保つこと">一発で済ませる方法はない。注意して、きちんと一貫性を保つこと。</h3>

            <p>今のところPHPは、低レベルではUnicodeをサポートしていない。 PHPでUTF-8文字列をきちんと処理する方法もあるにはあるが、簡単ではない。さらに、ウェブアプリケーションのあらゆるレベル （つまり、HTMLやSQLからPHPまで）に手を入れる必要がある。 ここでは、それらについて、現実的な範囲で手短にまとめた。
            </p>

            <h3 id="phpレベルでのutf-8">PHPレベルでのUTF-8</h3>

            <p>文字列の連結や変数への代入などの基本操作については、UTF-8だからといって何か特別なことをする必要はない。 しかし、大半の文字列関数（
                <code class="highlighter-rouge">strpos()</code> や <code class="highlighter-rouge">strlen()</code> など）については、そういうわけにはいかない。 これらの関数には、対応する関数として <code class="highlighter-rouge">mb_*</code> が用意されていることが多い。 たとえば <code class="highlighter-rouge">mb_strpos()</code> や <code class="highlighter-rouge">mb_strlen()</code> だ。 これらの <code class="highlighter-rouge">mb_*</code> 関数は <a href="http://php.net/book.mbstring">マルチバイト文字列拡張モジュール</a> が提供するもので、 Unicode文字列を扱えるように設計されている。
            </p>

            <p>Unicode文字列を扱う場合は、常に <code class="highlighter-rouge">mb_*</code> 関数を使う必要がある。 たとえば、UTF-8文字列に対して <code class="highlighter-rouge">substr()</code> を使うと、その結果の中に文字化けした半角文字が含まれてしまう可能性がある。 この場合、マルチバイト文字列のときに使うべき関数は <code class="highlighter-rouge">mb_substr()</code> だ。</p>

            <p>常に <code class="highlighter-rouge">mb_*</code> 関数を使うように覚えておくのが大変なところだ。 たとえ一か所でもそれを忘れてしまうと、それ以降の Unicode 文字列は壊れてしまう可能性がある。</p>

            <p>そして、すべての文字列関数に <code class="highlighter-rouge">mb_*</code> 版があるわけではない。 自分が使いたい関数にマルチバイト版がないだって？ ご愁傷様。
            </p>

            <p>すべてのPHPスクリプトの先頭（あるいは、グローバルにインクルードするファイルの先頭）で <code class="highlighter-rouge">mb_internal_encoding()</code> 関数を使わないといけないし、スクリプトの中でブラウザに出力するつもりなら、それだけではなく
                <code class="highlighter-rouge">mb_http_output()</code> 関数も使わなければいけない。 すべてのスクリプトでエンコーディングを明示しておけば、後で悩まされることもなくなるだろう。
            </p>

            <p>さらに、文字列を操作する関数の多くには、文字エンコーディングを指定するためのオプション引数が用意されている。 このオプションがある場合は、常に UTF-8 を明示しておくべきだ。 たとえば <code class="highlighter-rouge">htmlentities()</code> には文字エンコーディングを設定する引数があるので、 UTF-8 文字列を扱うなら常にそう指定しておかないといけない。 PHP 5.4.0 以降では、 <code class="highlighter-rouge">htmlentities()</code> や <code class="highlighter-rouge">htmlspecialchars()</code> のデフォルトエンコーディングが UTF-8 に変わった。</p>

            <p>最後に、他の人たち向けに配布するつもりのアプリケーションなど、その実行環境で <code class="highlighter-rouge">mbstring</code> が使えるかどうか定かではない場合は、 Composer の <a href="https://packagist.org/packages/patchwork/utf8">patchwork/utf8</a> パッケージを使うことも検討しよう。 これは、もし <code class="highlighter-rouge">mbstring</code> があればそれを使い、なければ非 UTF-8 関数にフォールバックするというものだ。</p>

            <h3 id="データベースレベルでのutf-8">データベースレベルでのUTF-8</h3>

            <p>PHP スクリプトから MySQL に接続する場合は、上で書いた注意をすべて守ったにもかかわらず UTF-8 文字列がそれ以外のエンコーディングで格納されてしまう可能性がある。
            </p>

            <p>PHP から MySQL に渡す文字列を確実に UTF-8 として扱わせるには、データベースとテーブルの文字セットや照合順序の設定を、すべて
                <code class="highlighter-rouge">utf8mb4</code> にしておく必要がある。さらに、PDO の接続文字列にも、文字セットとして <code class="highlighter-rouge">utf8mb4</code> を指定する。 詳細は以下のコードを参照すること。 <em>これ、試験に出るよ。</em></p>

            <p>UTF-8 を完全にサポートするには、文字セット <code class="highlighter-rouge">utf8mb4</code> を使わないといけない。 <code class="highlighter-rouge">utf8</code> はダメ！！！ その理由が知りたければ「あわせて読みたい」を参照すること。
            </p>

            <h3 id="ブラウザレベルでのutf-8">ブラウザレベルでのUTF-8</h3>

            <p><code class="highlighter-rouge">mb_http_output()</code> 関数を使えば、PHP スクリプトからブラウザへの出力が UTF-8 文字列になることを保証できる。</p>

            <p>あとは、HTTPレスポンスの中で、そのページをUTF-8として扱うようブラウザに指示する必要がある。 昔ながらのやりかたは、そのページの <code class="highlighter-rouge">&lt;head&gt;</code> タグの中で <a href="http://htmlpurifier.org/docs/enduser-utf8.html">charset の <code class="highlighter-rouge">&lt;meta&gt;</code> タグ</a> を指定することだった。 この方法でも間違いではないが、 <code class="highlighter-rouge">Content-Type</code> ヘッダーの中で文字セットを指定したほうが、
                <a href="https://developers.google.com/speed/docs/best-practices/rendering#SpecifyCharsetEarly">ずっと高速になる</a>。</p>

            <figure class="highlight">
                <pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="c1">// PHP に対して、今後このスクリプトの中では UTF-8 文字列を使うことを伝える
</span><span class="nb">mb_internal_encoding</span><span class="p">(</span><span class="s1">'UTF-8'</span><span class="p">);</span>

<span class="c1">// PHP に対して、ブラウザに UTF-8 で出力することを伝える
</span><span class="nb">mb_http_output</span><span class="p">(</span><span class="s1">'UTF-8'</span><span class="p">);</span>

<span class="c1">// UTF-8 のテスト用文字列
</span><span class="nv">$string</span> <span class="o">=</span> <span class="s1">'Êl síla erin lû e-govaned vîn.'</span><span class="p">;</span>

<span class="c1">// 何らかのマルチバイト関数で文字列を操作する。
// ここでは、デモの意味も込めて、非ASCII文字のところで文字列をカットしてみた。
</span><span class="nv">$string</span> <span class="o">=</span> <span class="nb">mb_substr</span><span class="p">(</span><span class="nv">$string</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">15</span><span class="p">);</span>

<span class="c1">// データベースに接続し、この文字列を格納する。
// このドキュメントにある PDO のサンプルを見れば、より詳しい情報がわかる。
// ここでの肝は、データソース名 (DSN) における `charset=utf8mb4` だ。
</span><span class="nv">$link</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span>
    <span class="s1">'mysql:host=your-hostname;dbname=your-db;charset=utf8mb4'</span><span class="p">,</span>
    <span class="s1">'your-username'</span><span class="p">,</span>
    <span class="s1">'your-password'</span><span class="p">,</span>
    <span class="k">array</span><span class="p">(</span>
        <span class="nx">PDO</span><span class="o">::</span><span class="na">ATTR_ERRMODE</span> <span class="o">=&gt;</span> <span class="nx">PDO</span><span class="o">::</span><span class="na">ERRMODE_EXCEPTION</span><span class="p">,</span>
        <span class="nx">PDO</span><span class="o">::</span><span class="na">ATTR_PERSISTENT</span> <span class="o">=&gt;</span> <span class="kc">false</span>
    <span class="p">)</span>
<span class="p">);</span>

<span class="c1">// 変換した文字列を、UTF-8としてデータベースに格納する。
// DBとテーブルの文字セットや照合順序が、ちゃんとutf8mb4になっているかな？
</span><span class="nv">$handle</span> <span class="o">=</span> <span class="nv">$link</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="s1">'insert into ElvishSentences (Id, Body) values (?, ?)'</span><span class="p">);</span>
<span class="nv">$handle</span><span class="o">-&gt;</span><span class="na">bindValue</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">PDO</span><span class="o">::</span><span class="na">PARAM_INT</span><span class="p">);</span>
<span class="nv">$handle</span><span class="o">-&gt;</span><span class="na">bindValue</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nv">$string</span><span class="p">);</span>
<span class="nv">$handle</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>

<span class="c1">// 今格納したばかりの文字列を取り出して、きちんと格納できているかどうかを確かめる
</span><span class="nv">$handle</span> <span class="o">=</span> <span class="nv">$link</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="s1">'select * from ElvishSentences where Id = ?'</span><span class="p">);</span>
<span class="nv">$handle</span><span class="o">-&gt;</span><span class="na">bindValue</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">PDO</span><span class="o">::</span><span class="na">PARAM_INT</span><span class="p">);</span>
<span class="nv">$handle</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>

<span class="c1">// 結果をオブジェクトに代入して、後でHTMLの中で使う
</span><span class="nv">$result</span> <span class="o">=</span> <span class="nv">$handle</span><span class="o">-&gt;</span><span class="na">fetchAll</span><span class="p">(</span><span class="nx">\PDO</span><span class="o">::</span><span class="na">FETCH_OBJ</span><span class="p">);</span>

<span class="nb">header</span><span class="p">(</span><span class="s1">'Content-Type: text/html; charset=UTF-8'</span><span class="p">);</span>
<span class="cp">?&gt;&lt;!doctype html&gt;</span>
<span class="nt">&lt;html&gt;</span>
    <span class="nt">&lt;head&gt;</span>
        <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"UTF-8"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;title&gt;</span>UTF-8 テストページ<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;/head&gt;</span>
    <span class="nt">&lt;body&gt;</span>
        <span class="cp">&lt;?php</span>
        <span class="k">foreach</span><span class="p">(</span><span class="nv">$result</span> <span class="k">as</span> <span class="nv">$row</span><span class="p">){</span>
            <span class="k">print</span><span class="p">(</span><span class="nv">$row</span><span class="o">-&gt;</span><span class="na">Body</span><span class="p">);</span>  <span class="c1">// 変換したUTF-8文字列が、ブラウザに正しく出力されるはず
</span>        <span class="p">}</span>
        <span class="cp">?&gt;</span>
    <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span></code></pre>
            </figure>

            <h3 id="あわせて読みたい">あわせて読みたい</h3>

            <ul>
                <li><a href="http://php.net/language.operators.string">PHPマニュアル: 文字列演算子</a></li>
                <li><a href="http://php.net/ref.strings">PHPマニュアル: String関数</a>
                    <ul>
                        <li><a href="http://php.net/function.strpos"><code class="highlighter-rouge">strpos()</code></a></li>
                        <li><a href="http://php.net/function.strlen"><code class="highlighter-rouge">strlen()</code></a></li>
                        <li><a href="http://php.net/function.substr"><code class="highlighter-rouge">substr()</code></a></li>
                    </ul>
                </li>
                <li><a href="http://php.net/ref.mbstring">PHPマニュアル: マルチバイト文字列関数</a>
                    <ul>
                        <li><a href="http://php.net/function.mb-strpos"><code class="highlighter-rouge">mb_strpos()</code></a></li>
                        <li><a href="http://php.net/function.mb-strlen"><code class="highlighter-rouge">mb_strlen()</code></a></li>
                        <li><a href="http://php.net/function.mb-substr"><code class="highlighter-rouge">mb_substr()</code></a></li>
                        <li><a href="http://php.net/function.mb-internal-encoding"><code class="highlighter-rouge">mb_internal_encoding()</code></a></li>
                        <li><a href="http://php.net/function.mb-http-output"><code class="highlighter-rouge">mb_http_output()</code></a></li>
                        <li><a href="http://php.net/function.htmlentities"><code class="highlighter-rouge">htmlentities()</code></a></li>
                        <li><a href="http://php.net/function.htmlspecialchars"><code class="highlighter-rouge">htmlspecialchars()</code></a></li>
                    </ul>
                </li>
                <li><a href="http://blog.loftdigital.com/blog/php-utf-8-cheatsheet">PHP UTF-8 Cheatsheet</a></li>
                <li><a href="http://www.phpwact.org/php/i18n/utf-8">Handling UTF-8 with PHP</a></li>
                <li><a href="http://stackoverflow.com/questions/571694/what-factors-make-php-unicode-incompatible">Stack Overflow: What factors make PHP Unicode-incompatible?</a></li>
                <li><a href="http://stackoverflow.com/questions/140728/best-practices-in-php-and-mysql-with-international-strings">Stack Overflow: Best practices in PHP and MySQL with international strings</a></li>
                <li><a href="http://mathiasbynens.be/notes/mysql-utf8mb4">How to support full Unicode in MySQL databases</a></li>
                <li><a href="http://www.sitepoint.com/bringing-unicode-to-php-with-portable-utf8/">Bringing Unicode to PHP with Portable UTF-8</a></li>
                <li><a href="http://stackoverflow.com/questions/8218230/php-domdocument-loadhtml-not-encoding-utf-8-correctly">Stack Overflow: DOMDocument loadHTML does not encode UTF-8 correctly</a></li>
            </ul>

        </section>


        <section class="chapter" id="i18n_l10n">
            <h2 id="i18n_l10n_title">Internationalization (i18n) and Localization (l10n)</h2>

            <p><em>Disclaimer for newcomers: i18n and l10n are numeronyms, a kind of abbreviation where numbers are used to shorten
words - in our case, internationalization becomes i18n and localization, l10n.</em></p>

            <p>First of all, we need to define those two similar concepts and other related things:</p>

            <ul>
                <li><strong>Internationalization</strong> is when you organize your code so it can be adapted to different languages or regions without refactorings. This is usually done once - preferably, in the beginning of the project, or else you’ll probably need some huge changes in the source!</li>
                <li><strong>Localization</strong> happens when you adapt the interface (mainly) by translating contents, based on the i18n work done before. It usually is done every time a new language or region needs support and is updated when new interface pieces are added, as they need to be available in all supported languages.</li>
                <li><strong>Pluralization</strong> defines the rules needed between different languages to interoperate strings containing numbers and counters. For instance, in English when you have only one item, it’s singular, and anything different from that is called plural; plural in this language is indicated by adding an S after some words, and sometimes changes parts of it. In other languages, such as Russian or Serbian, there are two plural forms in addition to the singular - you may even find languages with a total of four, five or six forms, such as Slovenian, Irish or Arabic.</li>
            </ul>

            <h2 id="common-ways-to-implement">Common ways to implement</h2>
            <p>The easiest way to internationalize PHP software is by using array files and using those strings in templates, such as
                <code class="highlighter-rouge">&lt;h1&gt;&lt;?=$TRANS['title_about_page']?&gt;&lt;/h1&gt;</code>. This is, however, hardly a recommended way for serious projects, as it poses some maintenance issues along the road - some might appear in the very beginning, such as pluralization. So, please, don’t try this if your project will contain more than a couple of pages.</p>

            <p>The most classic way and often taken as reference for i18n and l10n is a <a href="https://en.wikipedia.org/wiki/Gettext">Unix tool called <code class="highlighter-rouge">gettext</code></a>. It dates back to 1995 and is still a complete implementation for translating software. It is pretty easy to get running, while it still sports powerful supporting tools. It’s about Gettext we will be talking here. Also, to help you not get messy over the command-line, we will be presenting a great GUI application that can be used to easily update your l10n source files.
            </p>

            <h3 id="other-tools">Other tools</h3>

            <p>There are common libraries used that support Gettext and other implementations of i18n. Some of them may seem easier to install or sport additional features or i18n file formats. In this document, we focus on the tools provided with the PHP core, but here we list others for completion:</p>

            <ul>
                <li><a href="https://github.com/oscarotero/Gettext">oscarotero/Gettext</a>: Gettext support with an OO interface; includes improved helper functions, powerful extractors for several file formats (some of them not supported natively by the <code class="highlighter-rouge">gettext</code> command), and can also export to other formats besides <code class="highlighter-rouge">.mo/.po</code> files. Can be useful if you need to integrate your translation files into other parts of the system, like a JavaScript interface.</li>
                <li><a href="https://symfony.com/doc/current/components/translation.html">symfony/translation</a>: supports a lot of different formats, but recommends using verbose XLIFF’s. Doesn’t include helper functions nor a built-in extractor, but supports placeholders using <code class="highlighter-rouge">strtr()</code> internally.</li>
                <li><a href="https://docs.zendframework.com/zend-i18n/translation">zend/i18n</a>: supports array and INI files, or Gettext formats. Implements a caching layer to save you from reading the filesystem every time. It also includes view helpers, and locale-aware input filters and validators. However, it has no message extractor.</li>
            </ul>

            <p>Other frameworks also include i18n modules, but those are not available outside of their codebases:</p>
            <ul>
                <li><a href="https://laravel.com/docs/master/localization">Laravel</a> supports basic array files, has no automatic extractor but includes a <code class="highlighter-rouge">@lang</code> helper for template files.</li>
                <li><a href="http://www.yiiframework.com/doc-2.0/guide-tutorial-i18n.html">Yii</a> supports array, Gettext, and database-based translation, and includes a messages extractor. It is backed by the
                    <a href="http://br2.php.net/manual/en/intro.intl.php"><code class="highlighter-rouge">Intl</code></a> extension, available since PHP 5.3, and based on the <a href="http://www.icu-project.org">ICU project</a>; this enables Yii to run powerful replacements, like spelling out numbers, formatting dates, times, intervals, currency, and ordinals.</li>
            </ul>

            <p>If you decide to go for one of the libraries that provide no extractors, you may want to use the gettext formats, so you can use the original gettext toolchain (including Poedit) as described in the rest of the chapter.</p>

            <h2 id="gettext">Gettext</h2>

            <h3 id="installation">Installation</h3>
            <p>You might need to install Gettext and the related PHP library by using your package manager, like <code class="highlighter-rouge">apt-get</code> or <code class="highlighter-rouge">yum</code>. After installed, enable it by adding <code class="highlighter-rouge">extension=gettext.so</code> (Linux/Unix) or <code class="highlighter-rouge">extension=php_gettext.dll</code> (Windows) to your <code class="highlighter-rouge">php.ini</code>.</p>

            <p>Here we will also be using <a href="https://poedit.net">Poedit</a> to create translation files. You will probably find it in your system’s package manager; it’s available for Unix, Mac, and Windows, and can be <a href="https://poedit.net/download">downloaded for free on their website</a> as well.</p>

            <h3 id="structure">Structure</h3>

            <h4 id="types-of-files">Types of files</h4>
            <p>There are three files you usually deal with while working with gettext. The main ones are PO (Portable Object) and MO (Machine Object) files, the first being a list of readable “translated objects” and the second, the corresponding binary to be interpreted by gettext when doing localization. There’s also a POT (Template) file, that simply contains all existing keys from your source files, and can be used as a guide to generate and update all PO files. Those template files are not mandatory: depending on the tool you’re using to do l10n, you can go just fine with only PO/MO files. You’ll always have one pair of PO/MO files per language and region, but only one POT per domain.</p>

            <h3 id="domains">Domains</h3>
            <p>There are some cases, in big projects, where you might need to separate translations when the same words convey different meaning given a context. In those cases, you split them into different <em>domains</em>. They’re basically named groups of POT/PO/MO files, where the filename is the said <em>translation domain</em>. Small and medium-sized projects usually, for simplicity, use only one domain; its name is arbitrary, but we will be using “main” for our code samples.<br /> In <a href="https://symfony.com/doc/current/components/translation.html">Symfony</a> projects, for example, domains are used to separate the translation for validation messages.</p>

            <h4 id="locale-code">Locale code</h4>
            <p>A locale is simply a code that identifies one version of a language. It’s defined following the <a href="https://en.wikipedia.org/wiki/List_of_ISO_639-1_codes">ISO 639-1</a> and
                <a href="http://en.wikipedia.org/wiki/ISO_3166-1_alpha-2">ISO 3166-1 alpha-2</a> specs: two lower-case letters for the language, optionally followed by an underline and two upper-case letters identifying the country or regional code. For <a href="http://www.gnu.org/software/gettext/manual/gettext.html#Rare-Language-Codes">rare languages</a>, three letters are used.</p>

            <p>For some speakers, the country part may seem redundant. In fact, some languages have dialects in different countries, such as Austrian German (<code class="highlighter-rouge">de_AT</code>) or Brazilian Portuguese (<code class="highlighter-rouge">pt_BR</code>). The second part is used to distinguish between those dialects - when it’s not present, it’s taken as a “generic” or “hybrid” version of the language.</p>

            <h3 id="directory-structure">Directory structure</h3>
            <p>To use Gettext, we will need to adhere to a specific structure of folders. First, you’ll need to select an arbitrary root for your l10n files in your source repository. Inside it, you’ll have a folder for each needed locale, and a fixed
                <code class="highlighter-rouge">LC_MESSAGES</code> folder that will contain all your PO/MO pairs. Example:</p>

            <figure class="highlight">
                <pre><code class="language-console" data-lang="console">&lt;project root&gt;
 ├─ src/
 ├─ templates/
 └─ locales/
    ├─ forum.pot
    ├─ site.pot
    ├─ de/
    │  └─ LC_MESSAGES/
    │     ├─ forum.mo
    │     ├─ forum.po
    │     ├─ site.mo
    │     └─ site.po
    ├─ es_ES/
    │  └─ LC_MESSAGES/
    │     └─ ...
    ├─ fr/
    │  └─ ...
    ├─ pt_BR/
    │  └─ ...
    └─ pt_PT/
<span class="err">       └─ ...</span></code></pre>
            </figure>

            <h3 id="plural-forms">Plural forms</h3>
            <p>As we said in the introduction, different languages might sport different plural rules. However, gettext saves us from this trouble once again. When creating a new <code class="highlighter-rouge">.po</code> file, you’ll have to declare the <a href="http://docs.translatehouse.org/projects/localization-guide/en/latest/l10n/pluralforms.html">plural rules</a> for that language, and translated pieces that are plural-sensitive will have a different form for each of those rules. When calling Gettext in code, you’ll have to specify the number related to the sentence, and it will work out the correct form to use - even using string substitution if needed.</p>

            <p>Plural rules include the number of plurals available and a boolean test with <code class="highlighter-rouge">n</code> that would define in which rule the given number falls (starting the count with 0). For example:</p>

            <ul>
                <li>Japanese: <code class="highlighter-rouge">nplurals=1; plural=0</code> - only one rule</li>
                <li>English: <code class="highlighter-rouge">nplurals=2; plural=(n != 1);</code> - two rules, first if N is one, second rule otherwise</li>
                <li>Brazilian Portuguese: <code class="highlighter-rouge">nplurals=2; plural=(n &gt; 1);</code> - two rules, second if N is bigger than one, first otherwise</li>
            </ul>

            <p>Now that you understood the basis of how plural rules works - and if you didn’t, please look at a deeper explanation on the <a href="https://lingohub.com/blog/2013/07/php-internationalization-with-gettext-tutorial/#Plurals">LingoHub tutorial</a> -, you might want to copy the ones you need from a <a href="http://docs.translatehouse.org/projects/localization-guide/en/latest/l10n/pluralforms.html">list</a> instead of writing them by hand.</p>

            <p>When calling out Gettext to do localization on sentences with counters, you’ll have to give him the related number as well. Gettext will work out what rule should be in effect and use the correct localized version. You will need to include in the <code class="highlighter-rouge">.po</code> file a different sentence for each plural rule defined.</p>

            <h3 id="sample-implementation">Sample implementation</h3>
            <p>After all that theory, let’s get a little practical. Here’s an excerpt of a <code class="highlighter-rouge">.po</code> file - don’t mind with its format, but instead the overall content, you’ll learn how to edit it easily later:</p>

            <figure class="highlight">
                <pre><code class="language-po" data-lang="po">msgid ""
msgstr ""
"Language: pt_BR\n"
"Content-Type: text/plain; charset=UTF-8\n"
"Plural-Forms: nplurals=2; plural=(n &gt; 1);\n"

msgid "We're now translating some strings"
msgstr "Nós estamos traduzindo algumas strings agora"

msgid "Hello %1$s! Your last visit was on %2$s"
msgstr "Olá %1$s! Sua última visita foi em %2$s"

msgid "Only one unread message"
msgid_plural "%d unread messages"
msgstr[0] "Só uma mensagem não lida"
msgstr[1] "%d mensagens não lidas"</code></pre>
            </figure>

            <p>The first section works like a header, having the <code class="highlighter-rouge">msgid</code> and <code class="highlighter-rouge">msgstr</code> especially empty. It describes the file encoding, plural forms and other things that are less relevant. The second section translates a simple string from English to Brazilian Portuguese, and the third does the same, but leveraging string replacement from <a href="http://php.net/manual/en/function.sprintf.php"><code class="highlighter-rouge">sprintf</code></a> so the translation may contain the user name and visit date.<br /> The last section is a sample of pluralization forms, displaying the singular and plural version as <code class="highlighter-rouge">msgid</code> in English and their corresponding translations as <code class="highlighter-rouge">msgstr</code> 0 and 1 (following the number given by the plural rule). There, string replacement is used as well so the number can be seen directly in the sentence, by using <code class="highlighter-rouge">%d</code>. The plural forms always have two <code class="highlighter-rouge">msgid</code> (singular and plural), so it’s advised to not use a complex language as the source of translation.</p>

            <h3 id="discussion-on-l10n-keys">Discussion on l10n keys</h3>
            <p>As you might have noticed, we’re using as source ID the actual sentence in English. That <code class="highlighter-rouge">msgid</code> is the same used throughout all your <code class="highlighter-rouge">.po</code> files, meaning other languages will have the same format and the same <code class="highlighter-rouge">msgid</code> fields but translated <code class="highlighter-rouge">msgstr</code> lines.</p>

            <p>Talking about translation keys, there are two main “schools” here:</p>

            <ol>
                <li><em><code class="highlighter-rouge">msgid</code> as a real sentence</em>.<br /> The main advantages are:
                    <ul>
                        <li>if there are pieces of the software untranslated in any given language, the key displayed will still maintain some meaning. Example: if you happen to translate by heart from English to Spanish but need help to translate to French, you might publish the new page with missing French sentences, and parts of the website would be displayed in English instead;
                        </li>
                        <li>it’s much easier for the translator to understand what’s going on and make a proper translation based on the
                            <code class="highlighter-rouge">msgid</code>;</li>
                        <li>it gives you “free” l10n for one language - the source one;</li>
                        <li>The only disadvantage: if you need to change the actual text, you would need to replace the same <code class="highlighter-rouge">msgid</code> across several language files.</li>
                    </ul>
                </li>
                <li><em><code class="highlighter-rouge">msgid</code> as a unique, structured key</em>.<br /> It would describe the sentence role in the application in a structured way, including the template or part where the string is located instead of its content.
                    <ul>
                        <li>it’s a great way to have the code organized, separating the text content from the template logic.</li>
                        <li>however, that could bring problems to the translator that would miss the context. A source language file would be needed as a basis for other translations. Example: the developer would ideally have an <code class="highlighter-rouge">en.po</code> file, that translators would read to understand what to write in <code class="highlighter-rouge">fr.po</code> for instance.</li>
                        <li>missing translations would display meaningless keys on screen (<code class="highlighter-rouge">top_menu.welcome</code> instead of <code class="highlighter-rouge">Hello there, User!</code> on the said untranslated French page). That’s good it as would force translation to be complete before publishing - but bad as translation issues would be really awful in the interface. Some libraries, though, include an option to specify a given language as “fallback”, having a similar behavior as the other approach.</li>
                    </ul>
                </li>
            </ol>

            <p>The <a href="http://www.gnu.org/software/gettext/manual/gettext.html">Gettext manual</a> favors the first approach as, in general, it’s easier for translators and users in case of trouble. That’s how we will be working here as well. However, the <a href="https://symfony.com/doc/current/components/translation/usage.html#creating-translations">Symfony documentation</a> favors keyword-based translation, to allow for independent changes of all translations without affecting templates as well.</p>

            <h3 id="everyday-usage">Everyday usage</h3>
            <p>In a common application, you would use some Gettext functions while writing static text in your pages. Those sentences would then appear in <code class="highlighter-rouge">.po</code> files, get translated, compiled into <code class="highlighter-rouge">.mo</code> files and then, used by Gettext when rendering the actual interface. Given that, let’s tie together what we have discussed so far in a step-by-step example:</p>

            <h4 id="1-a-sample-template-file-including-some-different-gettext-calls">1. A sample template file, including some different gettext calls</h4>

            <figure class="highlight">
                <pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span> <span class="k">include</span> <span class="s1">'i18n_setup.php'</span> <span class="cp">?&gt;</span>
<span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"header"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;h1&gt;</span><span class="cp">&lt;?=</span><span class="nb">sprintf</span><span class="p">(</span><span class="nb">gettext</span><span class="p">(</span><span class="s1">'Welcome, %s!'</span><span class="p">),</span> <span class="nv">$name</span><span class="p">)</span><span class="cp">?&gt;</span><span class="nt">&lt;/h1&gt;</span>
    <span class="c">&lt;!-- code indented this way only for legibility --&gt;</span>
    <span class="cp">&lt;?php</span> <span class="k">if</span> <span class="p">(</span><span class="nv">$unread</span><span class="p">)</span><span class="o">:</span> <span class="cp">?&gt;</span>
        <span class="nt">&lt;h2&gt;</span><span class="cp">&lt;?=</span><span class="nb">sprintf</span><span class="p">(</span>
            <span class="nb">ngettext</span><span class="p">(</span><span class="s1">'Only one unread message'</span><span class="p">,</span>
                     <span class="s1">'%d unread messages'</span><span class="p">,</span>
                     <span class="nv">$unread</span><span class="p">),</span>
            <span class="nv">$unread</span><span class="p">)</span><span class="cp">?&gt;</span>
        <span class="nt">&lt;/h2&gt;</span>
    <span class="cp">&lt;?php</span> <span class="k">endif</span> <span class="cp">?&gt;</span>
<span class="nt">&lt;/div&gt;</span>

<span class="nt">&lt;h1&gt;</span><span class="cp">&lt;?=</span><span class="nb">gettext</span><span class="p">(</span><span class="s1">'Introduction'</span><span class="p">)</span><span class="cp">?&gt;</span><span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;p&gt;</span><span class="cp">&lt;?=</span><span class="nb">gettext</span><span class="p">(</span><span class="s1">'We\'re now translating some strings'</span><span class="p">)</span><span class="cp">?&gt;</span><span class="nt">&lt;/p&gt;</span></code></pre>
            </figure>

            <ul>
                <li><a href="http://php.net/manual/en/function.gettext.php"><code class="highlighter-rouge">gettext()</code></a> simply translates a <code class="highlighter-rouge">msgid</code> into its corresponding <code class="highlighter-rouge">msgstr</code> for a given language. There’s also the shorthand function <code class="highlighter-rouge">_()</code> that works the same way;</li>
                <li><a href="http://php.net/manual/en/function.ngettext.php"><code class="highlighter-rouge">ngettext()</code></a> does the same but with plural rules;</li>
                <li>there’s also <a href="http://php.net/manual/en/function.dgettext.php"><code class="highlighter-rouge">dgettext()</code></a> and <a href="http://php.net/manual/en/function.dngettext.php"><code class="highlighter-rouge">dngettext()</code></a>, that allows you to override the domain for a single call. More on domain configuration in the next example.</li>
            </ul>

            <h4 id="2-a-sample-setup-file-i18n_setupphp-as-used-above-selecting-the-correct-locale-and-configuring-gettext">2. A sample setup file (<code class="highlighter-rouge">i18n_setup.php</code> as used above), selecting the correct locale and configuring Gettext</h4>

            <figure class="highlight">
                <pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="sd">/**
 * Verifies if the given $locale is supported in the project
 * @param string $locale
 * @return bool
 */</span>
<span class="k">function</span> <span class="nf">valid</span><span class="p">(</span><span class="nv">$locale</span><span class="p">)</span> <span class="p">{</span>
   <span class="k">return</span> <span class="nb">in_array</span><span class="p">(</span><span class="nv">$locale</span><span class="p">,</span> <span class="p">[</span><span class="s1">'en_US'</span><span class="p">,</span> <span class="s1">'en'</span><span class="p">,</span> <span class="s1">'pt_BR'</span><span class="p">,</span> <span class="s1">'pt'</span><span class="p">,</span> <span class="s1">'es_ES'</span><span class="p">,</span> <span class="s1">'es'</span><span class="p">]);</span>
<span class="p">}</span>

<span class="c1">//setting the source/default locale, for informational purposes
</span><span class="nv">$lang</span> <span class="o">=</span> <span class="s1">'en_US'</span><span class="p">;</span>

<span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'lang'</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nx">valid</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'lang'</span><span class="p">]))</span> <span class="p">{</span>
    <span class="c1">// the locale can be changed through the query-string
</span>    <span class="nv">$lang</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">'lang'</span><span class="p">];</span>    <span class="c1">//you should sanitize this!
</span>    <span class="nb">setcookie</span><span class="p">(</span><span class="s1">'lang'</span><span class="p">,</span> <span class="nv">$lang</span><span class="p">);</span> <span class="c1">//it's stored in a cookie so it can be reused
</span><span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_COOKIE</span><span class="p">[</span><span class="s1">'lang'</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nx">valid</span><span class="p">(</span><span class="nv">$_COOKIE</span><span class="p">[</span><span class="s1">'lang'</span><span class="p">]))</span> <span class="p">{</span>
    <span class="c1">// if the cookie is present instead, let's just keep it
</span>    <span class="nv">$lang</span> <span class="o">=</span> <span class="nv">$_COOKIE</span><span class="p">[</span><span class="s1">'lang'</span><span class="p">];</span> <span class="c1">//you should sanitize this!
</span><span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">'HTTP_ACCEPT_LANGUAGE'</span><span class="p">]))</span> <span class="p">{</span>
    <span class="c1">// default: look for the languages the browser says the user accepts
</span>    <span class="nv">$langs</span> <span class="o">=</span> <span class="nb">explode</span><span class="p">(</span><span class="s1">','</span><span class="p">,</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">'HTTP_ACCEPT_LANGUAGE'</span><span class="p">]);</span>
    <span class="nb">array_walk</span><span class="p">(</span><span class="nv">$langs</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="o">&amp;</span><span class="nv">$lang</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$lang</span> <span class="o">=</span> <span class="nb">strtr</span><span class="p">(</span><span class="nb">strtok</span><span class="p">(</span><span class="nv">$lang</span><span class="p">,</span> <span class="s1">';'</span><span class="p">),</span> <span class="p">[</span><span class="s1">'-'</span> <span class="o">=&gt;</span> <span class="s1">'_'</span><span class="p">]);</span> <span class="p">});</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$langs</span> <span class="k">as</span> <span class="nv">$browser_lang</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">valid</span><span class="p">(</span><span class="nv">$browser_lang</span><span class="p">))</span> <span class="p">{</span>
            <span class="nv">$lang</span> <span class="o">=</span> <span class="nv">$browser_lang</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// here we define the global system locale given the found language
</span><span class="nb">putenv</span><span class="p">(</span><span class="s2">"LANG=</span><span class="nv">$lang</span><span class="s2">"</span><span class="p">);</span>

<span class="c1">// this might be useful for date functions (LC_TIME) or money formatting (LC_MONETARY), for instance
</span><span class="nb">setlocale</span><span class="p">(</span><span class="nx">LC_ALL</span><span class="p">,</span> <span class="nv">$lang</span><span class="p">);</span>

<span class="c1">// this will make Gettext look for ../locales/&lt;lang&gt;/LC_MESSAGES/main.mo
</span><span class="nb">bindtextdomain</span><span class="p">(</span><span class="s1">'main'</span><span class="p">,</span> <span class="s1">'../locales'</span><span class="p">);</span>

<span class="c1">// indicates in what encoding the file should be read
</span><span class="nb">bind_textdomain_codeset</span><span class="p">(</span><span class="s1">'main'</span><span class="p">,</span> <span class="s1">'UTF-8'</span><span class="p">);</span>

<span class="c1">// if your application has additional domains, as cited before, you should bind them here as well
</span><span class="nb">bindtextdomain</span><span class="p">(</span><span class="s1">'forum'</span><span class="p">,</span> <span class="s1">'../locales'</span><span class="p">);</span>
<span class="nb">bind_textdomain_codeset</span><span class="p">(</span><span class="s1">'forum'</span><span class="p">,</span> <span class="s1">'UTF-8'</span><span class="p">);</span>

<span class="c1">// here we indicate the default domain the gettext() calls will respond to
</span><span class="nb">textdomain</span><span class="p">(</span><span class="s1">'main'</span><span class="p">);</span>

<span class="c1">// this would look for the string in forum.mo instead of main.mo
// echo dgettext('forum', 'Welcome back!');
</span><span class="cp">?&gt;</span></code></pre>
            </figure>

            <h4 id="3-preparing-translation-for-the-first-run">3. Preparing translation for the first run</h4>
            <p>To make matters easier - and one of the powerful advantages Gettext has over custom framework i18n packages - is its custom file type. “Oh man, that’s quite hard to understand and edit by hand, a simple array would be easier!” Make no mistake, applications like <a href="https://poedit.net">Poedit</a> are here to help - <em>a lot</em>. You can get the program from
                <a href="https://poedit.net/download">their website</a>, it’s free and available for all platforms. It’s a pretty easy tool to get used to, and a very powerful one at the same time - using all powerful features Gettext has available.</p>

            <p>In the first run, you should select “File &gt; New Catalog” from the menu. There you’ll have a small screen where we will set the terrain so everything else runs smoothly. You’ll be able to find those settings later through “Catalog &gt; Properties”:</p>

            <ul>
                <li>Project name and version, Translation Team and email address: useful information that goes in the <code class="highlighter-rouge">.po</code> file header;</li>
                <li>Language: here you should use that format we mentioned before, such as <code class="highlighter-rouge">en_US</code> or <code class="highlighter-rouge">pt_BR</code>;</li>
                <li>Charsets: UTF-8, preferably;</li>
                <li>Source charset: set here the charset used by your PHP files - probably UTF-8 as well, right?</li>
                <li>plural forms: here go those rules we mentioned before - there’s a link in there with samples as well;</li>
                <li>Source paths: here you must include all folders from the project where <code class="highlighter-rouge">gettext()</code> (and siblings) will happen - this is usually your templates folder(s)</li>
                <li>Source keywords: this last part is filled by default, but you might need to alter it later - and is one of the powerful points of Gettext. The underlying software knows how the <code class="highlighter-rouge">gettext()</code> calls look like in several programming languages, but you might as well create your own translation forms. This will be discussed later in the “Tips” section.</li>
            </ul>

            <p>After setting those points you’ll be prompted to save the file - using that directory structure we mentioned as well, and then it will run a scan through your source files to find the localization calls. They’ll be fed empty into the translation table, and you’ll start typing in the localized versions of those strings. Save it and a <code class="highlighter-rouge">.mo</code> file will be (re)compiled into the same folder and ta-dah: your project is internationalized.</p>

            <h4 id="4-translating-strings">4. Translating strings</h4>
            <p>As you may have noticed before, there are two main types of localized strings: simple ones and the ones with plural forms. The first ones have simply two boxes: source and localized string. The source string can’t be modified as Gettext/Poedit do not include the powers to alter your source files - you should change the source itself and rescan the files. Tip: you may right-click a translation line and it will hint you with the source files and lines where that string is being used.<br /> On the other hand, plural form strings include two boxes to show the two source strings, and tabs so you can configure the different final forms.</p>

            <p>Whenever you change your sources and need to update the translations, just hit Refresh and Poedit will rescan the code, removing non-existent entries, merging the ones that changed and adding new ones. It may also try to guess some translations, based on other ones you did. Those guesses and the changed entries will receive a “Fuzzy” marker, indicating it needs review, being highlighted in the list. It’s also useful if you have a translation team and someone tries to write something they’re not sure about: just mark Fuzzy and someone else will review later.</p>

            <p>Finally, it’s advised to leave “View &gt; Untranslated entries first” marked, as it will help you <em>a lot</em> to not forget any entry. From that menu, you can also open parts of the UI that allow you to leave contextual information for translators if needed.</p>

            <h3 id="tips--tricks">Tips &amp; Tricks</h3>

            <h4 id="possible-caching-issues">Possible caching issues</h4>
            <p>If you’re running PHP as a module on Apache (<code class="highlighter-rouge">mod_php</code>), you might face issues with the <code class="highlighter-rouge">.mo</code> file being cached. It happens the first time it’s read, and then, to update it, you might need to restart the server. On Nginx and PHP5 it usually takes only a couple of page refreshes to refresh the translation cache, and on PHP7 it is rarely needed.</p>

            <h4 id="additional-helper-functions">Additional helper functions</h4>
            <p>As preferred by many people, it’s easier to use <code class="highlighter-rouge">_()</code> instead of <code class="highlighter-rouge">gettext()</code>. Many custom i18n libraries from frameworks use something similar to <code class="highlighter-rouge">t()</code> as well, to make translated code shorter. However, that’s the only function that sports a shortcut. You might want to add in your project some others, such as <code class="highlighter-rouge">__()</code> or <code class="highlighter-rouge">_n()</code> for <code class="highlighter-rouge">ngettext()</code>, or maybe a fancy <code class="highlighter-rouge">_r()</code> that would join <code class="highlighter-rouge">gettext()</code> and <code class="highlighter-rouge">sprintf()</code> calls. Other libraries, such as
                <a href="https://github.com/oscarotero/Gettext">oscarotero’s Gettext</a> also provide helper functions like these.</p>

            <p>In those cases, you’ll need to instruct the Gettext utility on how to extract the strings from those new functions. Don’t be afraid, it’s very easy. It’s just a field in the <code class="highlighter-rouge">.po</code> file, or a Settings screen on Poedit. In the editor, that option is inside “Catalog &gt; Properties &gt; Source keywords”. You need to include there the specifications of those new functions, following <a href="https://www.gnu.org/software/gettext/manual/gettext.html#Language-specific-options">a specific format</a>:</p>

            <ul>
                <li>if you create something like <code class="highlighter-rouge">t()</code> that simply returns the translation for a string, you can specify it as <code class="highlighter-rouge">t</code>. Gettext will know the only function argument is the string to be translated;</li>
                <li>if the function has more than one argument, you can specify in which one the first string is - and if needed, the plural form as well. For instance, if we call our function like this: <code class="highlighter-rouge">__('one user', '%d users', $number)</code>, the specification would be <code class="highlighter-rouge">__:1,2</code>, meaning the first form is the first argument, and the second form is the second argument. If your number comes as the first argument instead, the spec would be <code class="highlighter-rouge">__:2,3</code>, indicating the first form is the second argument, and so on.</li>
            </ul>

            <p>After including those new rules in the <code class="highlighter-rouge">.po</code> file, a new scan will bring in your new strings just as easy as before.</p>

            <h3 id="references">References</h3>

            <ul>
                <li><a href="https://en.wikipedia.org/wiki/Internationalization_and_localization">Wikipedia: i18n and l10n</a></li>
                <li><a href="https://en.wikipedia.org/wiki/Gettext">Wikipedia: Gettext</a></li>
                <li><a href="https://lingohub.com/blog/2013/07/php-internationalization-with-gettext-tutorial/">LingoHub: PHP internationalization with gettext tutorial</a></li>
                <li><a href="http://php.net/manual/en/book.gettext.php">PHP Manual: Gettext</a></li>
                <li><a href="http://www.gnu.org/software/gettext/manual/gettext.html">Gettext Manual</a></li>
            </ul>


        </section>

        <div class="back-to-top">
            <p><a href="#top" class="top">Back to Top</a></p>
        </div>
        <section class="chapter" id="dependency_injection">
            <h1 id="dependency_injection_title">依存性の注入</h1>

            <p><a href="http://en.wikipedia.org/wiki/Dependency_injection">Wikipedia</a>によると、</p>

            <blockquote>
                <p>依存性の注入とはソフトウェアデザインパターンの1つである。依存関係をソースコードから排除して、実行時あるいはコンパイル時にその依存関係を変更できるようにする。</p>
            </blockquote>

            <p>とのことだが、この説明は必要以上に小難しく言っているように思える。 依存性の注入とはコンポーネントに依存関係を渡せる仕組みのことで、コンストラクタで注入したりメソッド呼び出しをしたりプロパティを設定したりといった方法がある。 それだけのことだ。
            </p>

        </section>


        <section class="chapter" id="basic_concept">
            <h2 id="basic_concept_title">基本的な概念</h2>

            <p>考えかたを説明するために、シンプルな例を示そう。細かいところは手を抜いているけどね。</p>

            <p>ここに <code class="highlighter-rouge">Database</code> クラスがある。こいつがデータベースとやりとりするためには、何らかのアダプターが必要だ。 そこで、コンストラクタの中でアダプターのインスタンスを作っている。アダプターの名前を直接指定してね。 こんな書きかただと <code class="highlighter-rouge">Database</code> クラスを単体でテストするのが難しくなるし、 このクラスがアダプターと密接に結びついてしまう。
            </p>

            <figure class="highlight">
                <pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="k">namespace</span> <span class="nx">Database</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Database</span>
<span class="p">{</span>
    <span class="k">protected</span> <span class="nv">$adapter</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">adapter</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MySqlAdapter</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">MysqlAdapter</span> <span class="p">{}</span></code></pre>
            </figure>

            <p>このコードを書き換えて依存性の注入を使うようにすれば、この依存関係を緩やかにできる。</p>

            <figure class="highlight">
                <pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="k">namespace</span> <span class="nx">Database</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Database</span>
<span class="p">{</span>
    <span class="k">protected</span> <span class="nv">$adapter</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nx">MySqlAdapter</span> <span class="nv">$adapter</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">adapter</span> <span class="o">=</span> <span class="nv">$adapter</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">MysqlAdapter</span> <span class="p">{}</span></code></pre>
            </figure>

            <p>これで、依存関係を外部から <code class="highlighter-rouge">Database</code> クラスに渡せるようになった。このクラス自身に作らせる必要がなくなったんだ。 コンストラクタで指定する以外にも、依存関係を引数で受け取ってそれを設定するようなメソッドを新たに作ってもいいし、 あるいは <code class="highlighter-rouge">$adapter</code> という <code class="highlighter-rouge">public</code> プロパティを作って、依存関係を直接設定できるようにしてもいい。</p>

        </section>


        <section class="chapter" id="complex_problem">
            <h2 id="complex_problem_title">複雑な問題</h2>

            <p>これまでに依存性の注入について調べたことがある人なら、
                <em>“制御の反転（IoC：Inversion of Control）”</em> や <em>“依存関係逆転の原則（DIP：Dependency Inversion Principle）”</em> といった言葉に見覚えがあるだろう。これらは複雑な問題で、依存性の注入によって解決できるものだ。
            </p>

            <h3 id="制御の反転">制御の反転</h3>

            <p>制御の反転とは、文字通り、システムの「制御を反転」することだ。システム全体の制御を、オブジェクトから切り離したままで行う。 依存性の注入の文脈では、依存関係の制御や作成を、システム内のどこか別の場所でやるってことを意味する。
            </p>

            <p>PHPのフレームワークでも、制御の反転は実現されてきた。でも、実際のところ、何の制御を反転しているのだろう。そして、反転した結果、制御はどこに行ってしまったのだろう。 たとえば、たいていのMVCフレームワークには、あらゆるコントローラの親になる基底コントローラが用意されている。 そして、それを継承しなければ依存関係のアクセスできない。 これはこれで制御の反転だが、でも、依存関係を緩くしたというよりは、単純に依存関係を別の場所に移しただけのことだ。
            </p>

            <p>依存性の注入を使えば、これをもっとすっきりと解決できる。依存関係が必要になったときに、必要なものだけを注入すればいい。 ハードコーディングする必要はない。
            </p>

            <h3 id="依存関係逆転の原則">依存関係逆転の原則</h3>

            <p>依存関係逆転の原則は、オブジェクト指向設計の原則である S.O.L.I.D の “D” にあたるもので、
                <em>「抽象に依存しろ。具象に依存するな」</em> という原則だ。 簡単に言うと、依存関係はインターフェイスや抽象クラスに対して設定すべきものであり、それを実装したクラスに対して設定してはいけないってこと。 先ほどの例をこの原則に沿って書き直すと、こんなふうになる。
            </p>

            <figure class="highlight">
                <pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="k">namespace</span> <span class="nx">Database</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Database</span>
<span class="p">{</span>
    <span class="k">protected</span> <span class="nv">$adapter</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nx">AdapterInterface</span> <span class="nv">$adapter</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">adapter</span> <span class="o">=</span> <span class="nv">$adapter</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">interface</span> <span class="nx">AdapterInterface</span> <span class="p">{}</span>

<span class="k">class</span> <span class="nc">MysqlAdapter</span> <span class="k">implements</span> <span class="nx">AdapterInterface</span> <span class="p">{}</span></code></pre>
            </figure>

            <p>これで <code class="highlighter-rouge">Database</code> クラスは、具象クラスではなくインターフェイスに依存するように変わった。で、いったい何がうれしいんだろう。</p>

            <p>こんな場面を考えてみよう。君は今、とあるチームの一員として作業をしている。アダプターを作っているのは別のメンバーだ。 最初の例だと、その人がアダプターを完成させるまでは、自分のコードのユニットテストのモックを作れない。 インターフェイスに依存するようにした新しいバージョンだと、そのインターフェイスを使ってモックを作ることができる。 同僚が作るアダプターもそのインターフェイスに沿っているとわかっているからだ。
            </p>

            <p>そんなことより、もっとすばらしいメリットもある。こっちの方式のほうが、コードがずっとスケーラブルになるんだ。 仮に将来、別のデータベースに移行することになったとしよう。 そんな場合でも、このインターフェイスを実装した新しいアダプターを書いたらそれでおしまいだ。 それ以外は何もいじる必要がない。 新しいアダプターがきちんと決まりごとに従っているということを、インターフェイスが保証してくれるからだ。
            </p>

        </section>


        <section class="chapter" id="containers">
            <h2 id="containers_title">コンテナ</h2>

            <p>DIコンテナについてまず知っておくべきなのは、DIコンテナを使ってさえいれば「依存性の注入」ができるわけではないってことだ。 DIコンテナは、依存性の注入を実現するための便利な道具として使える。 でも、使い方をミスって、サービスロケーションというアンチパターンを作ってしまっていることも多い。 DIコンテナをサービスロケーターとしてクラスに組み込んでしまうと、 依存関係を別の場所に移そうとしていたはずなのに、よりきつい依存関係を作り込むことになる。 おまけにそのコードはわかりにくくなってしまうし、テストもしづらくなる。
            </p>

            <p>いまどきのフレームワークにはたいていDIコンテナが用意されていて、依存関係をコード以外のところで設定できる。 要するに、アプリケーションのコードがすっきりと書けて、フレームワーク本体とあまり密接につながりすぎないようにできるということ。
            </p>

        </section>


        <section class="chapter" id="further_reading">
            <h2 id="further_reading_title">あわせて読みたい</h2>

            <ul>
                <li><a href="http://ralphschindler.com/2011/05/18/learning-about-dependency-injection-and-php">Learning about Dependency Injection and PHP</a></li>
                <li><a href="http://fabien.potencier.org/article/11/what-is-dependency-injection">What is Dependency Injection?</a></li>
                <li><a href="https://mwop.net/blog/260-Dependency-Injection-An-analogy.html">Dependency Injection: An analogy</a></li>
                <li><a href="http://net.tutsplus.com/tutorials/php/dependency-injection-huh/">Dependency Injection: Huh?</a></li>
                <li><a href="http://philipobenito.github.io/dependency-injection-as-a-tool-for-testing/">Dependency Injection as a tool for testing</a></li>
            </ul>

        </section>

        <div class="back-to-top">
            <p><a href="#top" class="top">Back to Top</a></p>
        </div>
        <section class="chapter" id="databases">
            <h1 id="databases_title">データベース</h1>

            <p>PHP のコードを書いていると、情報を保存するためにデータベースを使うことが多くなる。 データベースを操作するには、いくつかの方法がある。
                <strong>PHP 5.1.0 の時代までは</strong> 、おすすめの方法は <a href="http://php.net/mysqli">mysqli</a>、<a href="http://php.net/pgsql">pgsql</a>、<a href="http://php.net/mssql">mssql</a> などのネイティブドライバを使うことだった。
            </p>

            <p>このデータベースしか使わないよ！っていうのならネイティブドライバもいい。 でもたとえば、MySQL を使っているけど一部は MSSQL であるとか、 Oracle にもつなぐことがあるとか、そんな場合は同じドライバでは対応できない。 そして、データベースが変わるたびに新しい API を覚えないといけないことになる。 ばかげた話だ。
            </p>


        </section>


        <section class="chapter" id="mysql_extension">
            <h2 id="mysql_extension_title">MySQL 用の拡張モジュール</h2>

            <p>PHP 用の <a href="http://php.net/mysql">mysql</a> 拡張モジュールは既に思いっきり古くなっていて、これらの拡張モジュールがその後継になっている。</p>

            <ul>
                <li><a href="http://php.net/mysqli">mysqli</a></li>
                <li><a href="http://php.net/pdo">pdo</a></li>
            </ul>

            <p><a href="http://php.net/mysql">mysql</a> 拡張モジュールの開発は大昔に終了していて、 <a href="http://php.net/migration55.deprecated">PHP 5.5.0で「廃止予定」となった</a>。 そして、 <strong><a href="http://php.net/manual/ja/migration70.removed-exts-sapis.php">PHP 7.0.0で公式に削除された</a></strong> 。</p>

            <p>いま使っているモジュールがどれなのかを知りたいなら、わざわざ <code class="highlighter-rouge">php.ini</code> の設定を調べるまでもない。 お好みのエディターで <code class="highlighter-rouge">mysql_*</code> を検索してみればいい。
                <code class="highlighter-rouge">mysql_connect()</code> とか <code class="highlighter-rouge">mysql_query()</code> みたいな関数がヒットしたら、 <code class="highlighter-rouge">mysql</code> モジュールを使ってるってことだ。</p>

            <p>当面は PHP 7.x を使うつもりがないのだとしても、今ちゃんと考えておかないと、いざというときに大変なことになる。 いちばんいいのは、通常の開発スケジュールの中で、mysql モジュールを使っている部分を
                <a href="http://php.net/mysqli">mysqli</a> や <a href="http://php.net/pdo">PDO</a> に徐々に置き換えていくことだ。 そうすれば、後になってあせらずにすむ。
            </p>

            <p>** <a href="http://php.net/mysql">mysql</a> から <a href="http://php.net/mysqli">mysqli</a> への移行について、単に「<code class="highlighter-rouge">mysql_*</code> を <code class="highlighter-rouge">mysqli_*</code> に置換すればOK」などと書いているような記事には用心すること。話を単純化しすぎているだけではなく、mysqli ならではの利点（パラメータのバインドなど。これは <a href="http://php.net/pdo">PDO</a> でも用意されている）の活用ができなくなってしまう。 **</p>

            <ul>
                <li><a href="http://php.net/mysqlinfo.api.choosing">PHP: MySQL 用の API の選択肢</a></li>
                <li><a href="http://wiki.hashphp.org/PDO_Tutorial_for_MySQL_Developers">MySQL開発者用のPDOチュートリアル</a></li>
            </ul>


        </section>


        <section class="chapter" id="pdo_extension">
            <h2 id="pdo_extension_title">PDO 拡張モジュール</h2>

            <p><a href="http://php.net/pdo">PDO</a> はデータベースとの接続を抽象化するライブラリだ。PHP 5.1.0 以降に組み込まれていて、 いろんなデータベースを同じインターフェイスで扱える。 MySQLを使うコードもSQLiteを使うコードも、基本的には同じようになるってことだ。
            </p>

            <figure class="highlight">
                <pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="c1">// PDO + MySQL
</span><span class="nv">$pdo</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="s1">'mysql:host=example.com;dbname=database'</span><span class="p">,</span> <span class="s1">'user'</span><span class="p">,</span> <span class="s1">'password'</span><span class="p">);</span>
<span class="nv">$statement</span> <span class="o">=</span> <span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="s2">"SELECT some_field FROM some_table"</span><span class="p">);</span>
<span class="nv">$row</span> <span class="o">=</span> <span class="nv">$statement</span><span class="o">-&gt;</span><span class="na">fetch</span><span class="p">(</span><span class="nx">PDO</span><span class="o">::</span><span class="na">FETCH_ASSOC</span><span class="p">);</span>
<span class="k">echo</span> <span class="nb">htmlentities</span><span class="p">(</span><span class="nv">$row</span><span class="p">[</span><span class="s1">'some_field'</span><span class="p">]);</span>

<span class="c1">// PDO + SQLite
</span><span class="nv">$pdo</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="s1">'sqlite:/path/db/foo.sqlite'</span><span class="p">);</span>
<span class="nv">$statement</span> <span class="o">=</span> <span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="s2">"SELECT some_field FROM some_table"</span><span class="p">);</span>
<span class="nv">$row</span> <span class="o">=</span> <span class="nv">$statement</span><span class="o">-&gt;</span><span class="na">fetch</span><span class="p">(</span><span class="nx">PDO</span><span class="o">::</span><span class="na">FETCH_ASSOC</span><span class="p">);</span>
<span class="k">echo</span> <span class="nb">htmlentities</span><span class="p">(</span><span class="nv">$row</span><span class="p">[</span><span class="s1">'some_field'</span><span class="p">]);</span></code></pre>
            </figure>

            <p>PDO は、SQL のクエリをデータベースにあわせて変換するものではないし、 もともと存在しない機能をエミュレートするものでもない。 純粋に、いろんなデータベースに同じ API で接続するためのものだ。</p>

            <p>もっと大切なことは、<code class="highlighter-rouge">PDO</code> を使えば、外部からの入力 (ID など) を安全に SQL クエリに埋め込めるということだ。データベースへの SQL インジェクション攻撃を心配しなくてもよくなる。 そのためには、PDO ステートメントとバインド変数を使えばよい。</p>

            <p>数値の ID をクエリ文字列として受け取る PHP スクリプトを考えてみよう。 渡された ID を使って、データベースからユーザー情報を取り出す。 最初に示すのは <code class="highlighter-rouge">悪い方法</code> だ。</p>

            <figure class="highlight">
                <pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="nv">$pdo</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="s1">'sqlite:/path/db/users.db'</span><span class="p">);</span>
<span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="s2">"SELECT name FROM users WHERE id = "</span> <span class="o">.</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">'id'</span><span class="p">]);</span> <span class="o">//</span> <span class="o">&lt;--</span> <span class="err">ダメ、ゼッタイ！</span></code></pre>
            </figure>

            <p>こんな恐ろしいコードを書いちゃいけない。 これは、クエリ文字列のパラメータを SQL に直に埋め込んでいることになる。 あっという間に <a href="http://wiki.hashphp.org/Validation">SQLインジェクション</a> 攻撃を食らうだろう。 どこかのずるがしこい攻撃者が <code class="highlighter-rouge">id</code> に渡す内容をひと工夫して
                <code class="highlighter-rouge">http://domain.com/?id=1%3BDELETE+FROM+users</code> みたいな URL を呼んだとしよう。 このとき変数 <code class="highlighter-rouge">$_GET['id']</code> の内容は <code class="highlighter-rouge">1;DELETE FROM users</code> となり、全ユーザーが消えてしまうことになる！ こんな書き方ではなく、PDO のバインド変数で ID を受け取らないといけない。</p>

            <figure class="highlight">
                <pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="nv">$pdo</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="s1">'sqlite:/path/db/users.db'</span><span class="p">);</span>
<span class="nv">$stmt</span> <span class="o">=</span> <span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="s1">'SELECT name FROM users WHERE id = :id'</span><span class="p">);</span>
<span class="nv">$id</span> <span class="o">=</span> <span class="nb">filter_input</span><span class="p">(</span><span class="nx">INPUT_GET</span><span class="p">,</span> <span class="s1">'id'</span><span class="p">,</span> <span class="nx">FILTER_SANITIZE_NUMBER_INT</span><span class="p">);</span> <span class="c1">// &lt;-- まずデータのフィルタリングを行う ([データのフィルタリング](#data_filtering) を参照)。特に INSERT や UPDATE などで重要
</span><span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">bindParam</span><span class="p">(</span><span class="s1">':id'</span><span class="p">,</span> <span class="nv">$id</span><span class="p">,</span> <span class="nx">PDO</span><span class="o">::</span><span class="na">PARAM_INT</span><span class="p">);</span> <span class="c1">// &lt;-- PDOが自動的にSQLのエスケープ処理をする
</span><span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span></code></pre>
            </figure>

            <p>これが正しい方法だ。この例では、PDO ステートメントでバインド変数を使っている。 外部からの入力である ID がエスケープされてからデータベースに渡るので、 SQL インジェクション攻撃を受けることがなくなる。</p>

            <p>INSERT や UPDATE などの書き込み操作の場合は、まず <a href="#data_filtering">データをフィルタリング</a> することが大切だ。 その後で、その他 (HTML タグや JavaScript など) のエスケープを行う。 PDO はあくまでも SQL 用のエスケープを行うものであり、アプリケーション全体の面倒をみてくれるわけではない。</p>

            <ul>
                <li><a href="http://php.net/book.pdo">PDOについて調べる</a></li>
            </ul>

            <p>あと、データベースのコネクションはリソースを使うということにも気をつけよう。 コネクションを明示的に閉じることを忘れたせいでリソースを食いつぶしてしまうなんて話は珍しくない。 とはいえ、これは別にPHPに限った話でもないけどね。 PDOを使っている場合は、オブジェクトへの参照をすべて削除して(Nullを代入するなどして) オブジェクトを破棄してしまえば、暗黙のうちにコネクションを閉じることが保証される。 オブジェクトを明示的に破棄しない場合は、スクリプトの実行が終わった時点でPHPが自動的に接続を閉じる。 もちろん、持続的接続を使っている場合は別だ。
            </p>

            <ul>
                <li><a href="http://php.net/pdo.connections">PDOの接続について調べる</a></li>
            </ul>


        </section>


        <section class="chapter" id="databases_interacting">
            <h2 id="databases_interacting_title">データベースとのやりとり</h2>

            <p>PHPを勉強し始めたばかりの開発者がやってしまいがちなのが、データベースとのやりとりと画面表示のロジックをごちゃまぜにしてしまうことだ。 たとえば、こんなコードになる。
            </p>

            <figure class="highlight">
                <pre><code class="language-php" data-lang="php"><span class="nt">&lt;ul&gt;</span>
<span class="cp">&lt;?php</span>
<span class="k">foreach</span> <span class="p">(</span><span class="nv">$db</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="s1">'SELECT * FROM table'</span><span class="p">)</span> <span class="k">as</span> <span class="nv">$row</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="s2">"&lt;li&gt;"</span><span class="o">.</span><span class="nv">$row</span><span class="p">[</span><span class="s1">'field1'</span><span class="p">]</span><span class="o">.</span><span class="s2">" - "</span><span class="o">.</span><span class="nv">$row</span><span class="p">[</span><span class="s1">'field1'</span><span class="p">]</span><span class="o">.</span><span class="s2">"&lt;/li&gt;"</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">?&gt;</span>
<span class="nt">&lt;/ul&gt;</span></code></pre>
            </figure>

            <p>これは、あらゆる意味でよろしくない。 まず何と言っても、デバッグしづらいし、テストもしづらいし、読みづらい。 あと、何も制限をかけていないので、大量のフィールドを出力してしまうことになる。
            </p>

            <p>同じことをもっとすっきり行う方法はいろいろある。<a href="/#object-oriented-programming">OOP</a>が好きな人向けのやりかたもあれば
                <a href="/#functional-programming">関数型プログラミング</a>が好きな人向けのやりかたもある。 が、まずは、分離することからはじめよう。
            </p>

            <p>これが第一歩だ。</p>

            <figure class="highlight">
                <pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="k">function</span> <span class="nf">getAllFoos</span><span class="p">(</span><span class="nv">$db</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nv">$db</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="s1">'SELECT * FROM table'</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">foreach</span> <span class="p">(</span><span class="nx">getAllFoos</span><span class="p">(</span><span class="nv">$db</span><span class="p">)</span> <span class="k">as</span> <span class="nv">$row</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="s2">"&lt;li&gt;"</span><span class="o">.</span><span class="nv">$row</span><span class="p">[</span><span class="s1">'field1'</span><span class="p">]</span><span class="o">.</span><span class="s2">" - "</span><span class="o">.</span><span class="nv">$row</span><span class="p">[</span><span class="s1">'field1'</span><span class="p">]</span><span class="o">.</span><span class="s2">"&lt;/li&gt;"</span><span class="p">;</span> <span class="c1">// BAD!!
</span><span class="p">}</span></code></pre>
            </figure>

            <p>少しはマシになった。この二つを別々のファイルに分けてしまえば、きれいに分離できるだろう。</p>

            <p>次に、このメソッドを保持するクラスを用意する。「モデル」だ。 そして、シンプルな <code class="highlighter-rouge">.php</code> ファイルをもうひとつ作って、そこに画面表示ロジックを入れる。「ビュー」だ。 これで、何となく <a href="http://code.tutsplus.com/tutorials/mvc-for-noobs--net-10488">MVC</a> っぽくなった。これは、多くの <a href="/#frameworks_title">フレームワーク</a> で使われている、OOPのアーキテクチャだ。</p>

            <p><strong>foo.php</strong></p>

            <figure class="highlight">
                <pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="nv">$db</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="s1">'mysql:host=localhost;dbname=testdb;charset=utf8'</span><span class="p">,</span> <span class="s1">'username'</span><span class="p">,</span> <span class="s1">'password'</span><span class="p">);</span>

<span class="c1">// モデルを読み込む
</span><span class="k">include</span> <span class="s1">'models/FooModel.php'</span><span class="p">;</span>

<span class="c1">// インスタンスを作る
</span><span class="nv">$fooModel</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FooModel</span><span class="p">(</span><span class="nv">$db</span><span class="p">);</span>
<span class="c1">// Fooのリストを作る
</span><span class="nv">$fooList</span> <span class="o">=</span> <span class="nv">$fooModel</span><span class="o">-&gt;</span><span class="na">getAllFoos</span><span class="p">();</span>

<span class="c1">// ビューを表示する
</span><span class="k">include</span> <span class="s1">'views/foo-list.php'</span><span class="p">;</span></code></pre>
            </figure>

            <p><strong>models/FooModel.php</strong></p>

            <figure class="highlight">
                <pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="k">class</span> <span class="nc">FooModel</span>
<span class="p">{</span>
    <span class="k">protected</span> <span class="nv">$db</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nx">PDO</span> <span class="nv">$db</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">db</span> <span class="o">=</span> <span class="nv">$db</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">getAllFoos</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">db</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="s1">'SELECT * FROM table'</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre>
            </figure>

            <p><strong>views/foo-list.php</strong></p>

            <figure class="highlight">
                <pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span> <span class="k">foreach</span> <span class="p">(</span><span class="nv">$fooList</span> <span class="k">as</span> <span class="nv">$row</span><span class="p">)</span><span class="o">:</span> <span class="cp">?&gt;</span>
    <span class="cp">&lt;?=</span> <span class="nv">$row</span><span class="p">[</span><span class="s1">'field1'</span><span class="p">]</span> <span class="cp">?&gt;</span> - <span class="cp">&lt;?=</span> <span class="nv">$row</span><span class="p">[</span><span class="s1">'field1'</span><span class="p">]</span> <span class="cp">?&gt;</span>
<span class="cp">&lt;?php</span> <span class="k">endforeach</span> <span class="cp">?&gt;</span></code></pre>
            </figure>

            <p>本質的にこれは、今どきのフレームワークがやっていることと、ほぼ同じだ。それを手作業でやってみた。 毎回こんなことをする必要はないかもしれないが、画面表示とデータベース操作を混在させすぎると、
                <a href="/#unit-testing">ユニットテスト</a> をしたくなったときにやっかいな問題が発生してしまう。</p>

            <p><a href="http://phpbridge.org/">PHPBridge</a> に、 <a href="http://phpbridge.org/intro-to-php/creating_a_data_class">Creating a Data Class</a> という記事が公開されている。 ここで扱ったのと同じ話題をとりあげていて、データベース操作に慣れた人にとって最適の記事だ。
            </p>


        </section>


        <section class="chapter" id="databases_abstraction_layers">
            <h2 id="databases_abstraction_layers_title">抽象化レイヤー</h2>

            <p>多くのフレームワークは、データベースの抽象化レイヤーを用意している。<a href="http://php.net/book.pdo">PDO</a>を利用しているものもあれば、そうでないものもある。 あるデータベースには存在するけれども別のデータベースには存在しない機能などをエミュレートするために、 クエリーをPHPのメソッドでラップしたりするものだ。 PDOではデータベースへの接続の抽象化しかしないが、フレームワークの抽象化レイヤーは、それ以上のことをしてくれる。 もちろんそれなりのオーバーヘッドが発生するだろう。 でも、MySQLでもPostgreSQLでもSQLiteでも動くようなアプリケーションを書いているのなら、 多少のオーバーヘッドを割り引いてでも、すっきりしたコードを書けるほうがうれしいだろう。
            </p>

            <p>以下の抽象化レイヤーは、 <a href="http://www.php-fig.org/psr/psr-0/">PSR-0</a> や <a href="http://www.php-fig.org/psr/psr-4/">PSR-4</a> で定められた標準名前空間に従っている。 これらはアプリケーションを問わずに利用できる。
            </p>

            <ul>
                <li><a href="https://github.com/auraphp/Aura.Sql">Aura SQL</a></li>
                <li><a href="http://www.doctrine-project.org/projects/dbal.html">Doctrine2 DBAL</a></li>
                <li><a href="http://propelorm.org/">Propel</a></li>
                <li><a href="https://packages.zendframework.com/docs/latest/manual/en/index.html#zendframework/zend-db">Zend-db</a></li>
            </ul>


        </section>

        <div class="back-to-top">
            <p><a href="#top" class="top">Back to Top</a></p>
        </div>
        <section class="chapter" id="templating">
            <h1 id="templating_title">テンプレート</h1>

            <p>テンプレートは、コントローラーやドメインロジックを、プレゼンテーションロジックから切り離すための便利な手段だ。 テンプレ—トには、アプリケーションで使うHTMLを含めることが多いが、それ以外のフォーマット（XMLなど）を含めることもある。 テンプレートのことを「ビュー」と呼ぶこともある。いわゆる
                <a href="/pages/Design-Patterns.html#model-view-controller">model–view–controller</a> (MVC) パターンの、二番目の要素 <strong>の一部</strong> だ。</p>

        </section>


        <section class="chapter" id="templating_benefits">
            <h2 id="templating_benefits_title">メリット</h2>

            <p>テンプレートを使う主なメリットは、画面に表示する内容をアプリケーションから切り離せることだ。 テンプレートは、フォーマット済みのコンテンツを表示するという責務だけを負う。 データを検索したり、データベースに保存したりなどといった、雑多なタスクは気にしない。 このおかげで、すっきりしたリーダブルなコードが書けるようになる。チームで開発する際などには、これが特に有用だ。 開発者はサーバー側のコード（コントローラやモデル）、そしてデザイナーはクライアント側のコード（マークアップ） などという作業分担をしやすくなる。
            </p>

            <p>テンプレートには、プレゼンテーションのコードの構造を改善するという効果もある。 テンプレートは一般的に「views」などのフォルダにまとめられて、それぞれ個別のファイルになっていることが多い。 こうしておけばコードの再利用がしやすくなる。大規模なコードブロックを、小さめの再利用しやすいパーツ（パーシャルと呼ばれることもある）に分割できるからだ。 たとえば、サイトのヘッダやフッタをテンプレートにしておけば、各ページのテンプレートにそれをインクルードできるようになる。
            </p>

            <p>利用するライブラリによっては、テンプレートを使うことで、よりセキュリティを確保できるようにもなる。 ユーザーが作るコンテンツを自動的にエスケープしてくれたりする機能を持つようなテンプレートが、それにあたる。 さらに、サンドボックス機能を提供するライブラリもある。これは、デザイナーが、あらかじめ許可された変数と関数しか利用できないようにする仕組みだ。
            </p>

        </section>


        <section class="chapter" id="plain_php_templates">
            <h2 id="plain_php_templates_title">プレーンなPHPによるテンプレート</h2>

            <p>プレーンなPHPによるテンプレートとは、単にPHPのコードを使ったテンプレートという意味だ。 ごく自然な選択肢だとも言える。そもそもPHP自体がテンプレート言語だし。 あ、これって単に、PHPのコードをHTMLとかにも埋め込めるよねっていう以上の深い意味はないからね。 PHPの開発者にとっては、新しい構文を覚えずに済むというメリットがある。 どんな関数が使えるのかもわかっているし、ふだんPHPを書いているエディタのシンタックスハイライトや 自動補完機能も、そのまま使える。 その上、プレーンなPHPのテンプレートは高速であることが多い。コンパイルが不要だからだ。
            </p>

            <p>いまどきのPHPフレームワークは、たいてい何らかの仕組みのテンプレートシステムを持っている。 その多くでデフォルトになっているのが、プレーンPHPによるテンプレートだ。 フレームワーク以外では、
                <a href="http://platesphp.com/">Plates</a>や<a href="https://github.com/auraphp/Aura.View">Aura.View</a> といったライブラリがプレーンPHPテンプレートを使いやすくしてくれる。継承やレイアウト、拡張などの便利なテンプレート機能を用意してくれるんだ。
            </p>

            <h3 id="プレーンphpテンプレートのシンプルな例">プレーンPHPテンプレートのシンプルな例</h3>

            <p><a href="http://platesphp.com/">Plates</a> ライブラリを使った。</p>

            <figure class="highlight">
                <pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span> <span class="c1">// user_profile.php ?&gt;
</span>
<span class="o">&lt;?</span><span class="nx">php</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">insert</span><span class="p">(</span><span class="s1">'header'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'title'</span> <span class="o">=&gt;</span> <span class="s1">'User Profile'</span><span class="p">])</span> <span class="cp">?&gt;</span>

<span class="nt">&lt;h1&gt;</span>User Profile<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;p&gt;</span>Hello, <span class="cp">&lt;?=</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">escape</span><span class="p">(</span><span class="nv">$name</span><span class="p">)</span><span class="cp">?&gt;</span><span class="nt">&lt;/p&gt;</span>

<span class="cp">&lt;?php</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">insert</span><span class="p">(</span><span class="s1">'footer'</span><span class="p">)</span> <span class="cp">?&gt;</span></code></pre>
            </figure>

            <h3 id="プレーンphpテンプレートで継承を使う例">プレーンPHPテンプレートで継承を使う例</h3>

            <p><a href="http://platesphp.com/">Plates</a> ライブラリを使った。</p>

            <figure class="highlight">
                <pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span> <span class="c1">// template.php ?&gt;
</span>
<span class="o">&lt;</span><span class="nx">html</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="nx">head</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">title</span><span class="o">&gt;&lt;?=</span><span class="nv">$title</span><span class="cp">?&gt;</span><span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>

<span class="nt">&lt;main&gt;</span>
    <span class="cp">&lt;?=</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">section</span><span class="p">(</span><span class="s1">'content'</span><span class="p">)</span><span class="cp">?&gt;</span>
<span class="nt">&lt;/main&gt;</span>

<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span></code></pre>
            </figure>

            <figure class="highlight">
                <pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span> <span class="c1">// user_profile.php ?&gt;
</span>
<span class="o">&lt;?</span><span class="nx">php</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">layout</span><span class="p">(</span><span class="s1">'template'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'title'</span> <span class="o">=&gt;</span> <span class="s1">'User Profile'</span><span class="p">])</span> <span class="cp">?&gt;</span>

<span class="nt">&lt;h1&gt;</span>User Profile<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;p&gt;</span>Hello, <span class="cp">&lt;?=</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">escape</span><span class="p">(</span><span class="nv">$name</span><span class="p">)</span><span class="cp">?&gt;</span><span class="nt">&lt;/p&gt;</span></code></pre>
            </figure>


        </section>


        <section class="chapter" id="compiled_templates">
            <h2 id="compiled_templates_title">コンパイル形式のテンプレート</h2>

            <p>PHPはオブジェクト指向言語として成熟してきてはいるものの、テンプレート言語としては
                <a href="http://fabien.potencier.org/article/34/templating-engines-in-php">いまいち</a> だ。 コンパイル形式のテンプレート、たとえば <a href="http://twig.sensiolabs.org/">Twig</a> や <a href="https://github.com/box/brainy">Brainy</a> や <a href="http://www.smarty.net/">Smarty</a>* が、この穴を埋めてくれる。テンプレートに特化した、新しい構文を用意してくれるんだ。 自動エスケープから継承や制御構文まで、コンパイル形式のテンプレートは、いかに読み書きしやすく、安心して使えるかを重視して作られている。 さらに、コンパイル形式のテンプレートは、別の言語でさえも使うことができる。
                <a href="http://mustache.github.io/">Mustache</a> がそのよい例だ。 テンプレートをコンパイルする時間がかかるので、多少はパフォーマンスに影響する。 しかし、適切にキャッシュをすれば、その影響は微々たるものだ。
            </p>

            <p><em>*Smartyには自動エスケープ機能があるけど、これはデフォルトでは無効になっている。</em></p>

            <h3 id="コンパイル形式のテンプレートのシンプルな例">コンパイル形式のテンプレートのシンプルな例</h3>

            <p><a href="http://twig.sensiolabs.org/">Twig</a> ライブラリを使った。</p>

            <figure class="highlight">
                <pre><code class="language-html-jinja" data-lang="html+jinja">{% include 'header.html' with {'title': 'User Profile'} %}

&lt;h1&gt;User Profile&lt;/h1&gt;
&lt;p&gt;Hello, {{ name }}&lt;/p&gt;

{% include 'footer.html' %}</code></pre>
            </figure>

            <h3 id="コンパイル形式のテンプレートで継承を使う例">コンパイル形式のテンプレートで継承を使う例</h3>

            <p><a href="http://twig.sensiolabs.org/">Twig</a> ライブラリを使った。</p>

            <figure class="highlight">
                <pre><code class="language-html-jinja" data-lang="html+jinja">// template.html

&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;{% block title %}{% endblock %}&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;

&lt;main&gt;
    {% block content %}{% endblock %}
&lt;/main&gt;

&lt;/body&gt;
&lt;/html&gt;</code></pre>
            </figure>

            <figure class="highlight">
                <pre><code class="language-html-jinja" data-lang="html+jinja">// user_profile.html

{% extends "template.html" %}

{% block title %}User Profile{% endblock %}
{% block content %}
    &lt;h1&gt;User Profile&lt;/h1&gt;
    &lt;p&gt;Hello, {{ name }}&lt;/p&gt;
{% endblock %}</code></pre>
            </figure>


        </section>


        <section class="chapter" id="templating_further_reading">
            <h2 id="templating_further_reading_title">あわせて読みたい</h2>

            <h3 id="記事やチュートリアル">記事やチュートリアル</h3>

            <ul>
                <li><a href="http://fabien.potencier.org/article/34/templating-engines-in-php">Templating Engines in PHP</a></li>
                <li><a href="http://code.tutsplus.com/tutorials/an-introduction-to-views-templating-in-codeigniter--net-25648">An Introduction to Views &amp; Templating in CodeIgniter</a></li>
                <li><a href="http://www.smashingmagazine.com/2011/10/17/getting-started-with-php-templating/">Getting Started With PHP Templating</a></li>
                <li><a href="http://code.tutsplus.com/tutorials/roll-your-own-templating-system-in-php--net-16596">Roll Your Own Templating System in PHP</a></li>
                <li><a href="https://laracasts.com/series/laravel-from-scratch/episodes/7">Master Pages</a></li>
                <li><a href="http://code.tutsplus.com/tutorials/working-with-templates-in-symfony-2--cms-21172">Working With Templates in Symfony 2</a></li>
                <li><a href="https://github.com/box/brainy/wiki/Writing-Safe-Templates">Writing Safer Templates</a></li>
            </ul>

            <h3 id="ライブラリ">ライブラリ</h3>

            <ul>
                <li><a href="https://github.com/auraphp/Aura.View">Aura.View</a> <em>(native)</em></li>
                <li><a href="http://laravel.com/docs/blade">Blade</a> <em>(compiled, framework specific)</em></li>
                <li><a href="https://github.com/box/brainy">Brainy</a> <em>(compiled)</em></li>
                <li><a href="http://dwoo.org/">Dwoo</a> <em>(compiled)</em></li>
                <li><a href="https://github.com/nette/latte">Latte</a> <em>(compiled)</em></li>
                <li><a href="https://github.com/bobthecow/mustache.php">Mustache</a> <em>(compiled)</em></li>
                <li><a href="http://phptal.org/">PHPTAL</a> <em>(compiled)</em></li>
                <li><a href="http://platesphp.com/">Plates</a> <em>(native)</em></li>
                <li><a href="http://www.smarty.net/">Smarty</a> <em>(compiled)</em></li>
                <li><a href="http://twig.sensiolabs.org/">Twig</a> <em>(compiled)</em></li>
                <li><a href="http://framework.zend.com/manual/2.3/en/modules/zend.view.quick-start.html">Zend\View</a> <em>(native, framework specific)</em></li>
            </ul>

        </section>

        <div class="back-to-top">
            <p><a href="#top" class="top">Back to Top</a></p>
        </div>
        <section class="chapter" id="errors_and_exceptions">
            <h1 id="errors_and_exceptions_title">エラーと例外処理</h1>


        </section>


        <section class="chapter" id="errors">
            <h2 id="errors_title">エラー</h2>

            <p>例外処理を重視するプログラミング言語では、何か問題が起こったらすぐに例外を投げる。 それはそれでいいことではあるが、PHPはそうではなく、「例外処理も使える」プログラミング言語だ。 PHPには例外処理の仕組みがあるし、コアの中でもオブジェクトを扱うときには例外処理を行うことが増えている。 でも、PHPは基本的に、よっぽど致命的なエラーが発生しない限りは何があろうと処理を続行しようとする。
            </p>

            <p>たとえば、こんなコードを考えてみよう。</p>

            <figure class="highlight">
                <pre><code class="language-console" data-lang="console"><span class="w">$ </span><span class="nc">php</span><span class="kv"> -a
</span>php &gt; echo $foo;
<span class="err">Notice: Undefined variable: foo in php shell code on line 1</span></code></pre>
            </figure>

            <p>単純にnoticeレベルのエラーになるだけで、PHPはそのまま処理を続行する。 例外処理を重視する世界からやってきた人にとっては、これは少しキモいと思うかもしれないね。 たとえばPythonなら、未定義の変数を参照しようとすると、例外が発生する。
            </p>

            <figure class="highlight">
                <pre><code class="language-console" data-lang="console"><span class="w">$ </span><span class="nc">python</span><span class="kv">
</span>&gt;&gt;&gt; print foo
Traceback (most recent call last):
  File "&lt;stdin&gt;", line 1, in &lt;module&gt;
<span class="err">NameError: name 'foo' is not defined</span></code></pre>
            </figure>

            <p>実際の違いは、こういうことだ。 Pythonは、些細なことにまでこだわることで、プログラマーが余計な心配（「もし○○だったら、その場合は…」と考えたり、エッジケースを考慮したりなど） をせずに済むようにしている。 一方PHPは、どうしようもないエラーが発生しないかぎりは、一応エラーを報告したうえで処理を続行する。
            </p>

            <h3 id="エラーの深刻度">エラーの深刻度</h3>

            <p>PHPのエラーは、何段階かの深刻度レベルに別れている。PHPでよく使われるメッセージの形式は、 エラー（error）と注意（notice）そして警告（warning）だ。 それぞれ別々の深刻度レベルが設定されていて、 <code class="highlighter-rouge">E_ERROR</code>、<code class="highlighter-rouge">E_NOTICE</code>、そして <code class="highlighter-rouge">E_WARNING</code> になる。 「エラー」は実行時の致命的な問題で、ふつうはコードの書きかたがまずいせいで発生する。 これは修正しなければいけない。というのも、これが発生するとPHPの実行がそこで止まってしまうからだ。 「注意」は助言みたいなもので、問題を起こす可能性があるスクリプトを実行したときに発生する。 スクリプトの実行は止まらない。 「警告」は致命的ではない問題で、これもスクリプトの実行は止まらない。
            </p>

            <p>もうひとつ、コンパイル時に発生する <code class="highlighter-rouge">E_STRICT</code> という形式のメッセージもある。 これは、相互運用性や将来のバージョンのPHPとの互換性を考えたときに、コードを書き換えたほうがいいと提案するためのメッセージだ。
            </p>

            <h3 id="phpのエラー報告の挙動の変更">PHPのエラー報告の挙動の変更</h3>

            <p>エラー報告の挙動は、PHPの設定で変更することもできるしPHPの関数で変更することもできる。 組み込みの関数 <code class="highlighter-rouge">error_reporting()</code> にエラーレベル定数を渡せば、そのスクリプトの実行中に どのレベルのエラー処理をするのかを設定できる。 たとえば、エラー(error)とか警告(warning)は表示させたいけれども、別に注意(notice)は見たくないという場合は、こんなふうにすればいい。
            </p>

            <figure class="highlight">
                <pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="nb">error_reporting</span><span class="p">(</span><span class="k">E_ERROR</span> <span class="o">|</span> <span class="k">E_WARNING</span><span class="p">);</span></code></pre>
            </figure>

            <p>画面に表示するかしないか(開発時に有効)だけでなく、ログに出力するかしないか(運用時に有効)も制御できる。 詳細は <a href="/#error_reporting">エラーレポート</a> を参照。</p>

            <h3 id="インラインでのエラーの抑制">インラインでのエラーの抑制</h3>

            <p>「ここでのエラーは無視すること」とPHPに指示することもできる。そのときに使うのが、 エラー制御演算子 <code class="highlighter-rouge">@</code> だ。この演算子を何かの式の前に書くと、 その式で発生したあらゆるエラーは黙って揉み消される。
            </p>

            <figure class="highlight">
                <pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="k">echo</span> <span class="o">@</span><span class="nv">$foo</span><span class="p">[</span><span class="s1">'bar'</span><span class="p">];</span></code></pre>
            </figure>

            <p>これは、もし <code class="highlighter-rouge">$foo['bar']</code> が存在すればその内容を出力するが、仮に変数 <code class="highlighter-rouge">$foo</code> やキー <code class="highlighter-rouge">'bar'</code> が存在しなくてもエラーにはならない。単純に null を返して何も表示しないだけだ。 もしエラー制御演算子がなかったら、 <code class="highlighter-rouge">PHP Notice:  Undefined variable: foo</code> だとか
                <code class="highlighter-rouge">PHP Notice:  Undefined index: bar</code> のようなエラーになる。</p>

            <p>一見、よさげな機能だと感じるかもしれない。でも、これを使うと、あまり望ましくない代償を払うことになる。 まず、PHPでは、 <code class="highlighter-rouge">@</code> つきの式は <code class="highlighter-rouge">@</code> なしの式よりも処理効率が落ちてしまう。 「早まった最適化は諸悪の根源だ」とはいうものの、 もしパフォーマンスを重視するアプリケーションやライブラリを作っているのなら、 エラー制御演算子がパフォーマンスに及ぼす悪影響を知っておくべきだ。
            </p>

            <p>次に、エラー制御演算子を使うと、発生したエラーが <strong>完全に</strong> 隠蔽されてしまう。 画面にも表示されなければ、ログに書き出されることもない。 また、運用中のPHPシステムのエラー制御演算子を無効にする仕組みはない。 今見ているエラーが仮に些細なものだとしよう。だとしても、それ以外に無視できないエラーが発生するかもしれない。 そんなエラーも、同様に隠蔽されてしまう。
            </p>

            <p>エラー制御演算子を使わずにすむ道があるなら、その方向で考えるべきだ。 たとえばさっきのコードなら、こんなふうに書き直せばいい。
            </p>

            <figure class="highlight">
                <pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="k">echo</span> <span class="nb">isset</span><span class="p">(</span><span class="nv">$foo</span><span class="p">[</span><span class="s1">'bar'</span><span class="p">])</span> <span class="o">?</span> <span class="nv">$foo</span><span class="p">[</span><span class="s1">'bar'</span><span class="p">]</span> <span class="o">:</span> <span class="s1">''</span><span class="p">;</span></code></pre>
            </figure>

            <p>エラーの抑制を使うのが理にかなっている場面として考えられるのは、 たとえば <code class="highlighter-rouge">fopen()</code> を使っていてファイルの読み込みに失敗した場合だ。 もちろん実際に読み込む前にファイルがあるかどうかをチェックするだろうが、 そのチェックが終わってから実際に <code class="highlighter-rouge">fopen()</code> で読み込むまでの間に ファイルが削除されるかもしれない（まあありえないだろうけど、可能性はゼロではない）。 そんな場合、 <code class="highlighter-rouge">fopen()</code> が false を返し、 <em>そして</em> エラーも発生する。 ほんとはPHP側で何とかしてもらいたいところだけれど、現状ではエラーを抑制するくらいしか手がない。
            </p>

            <p>さっき、稼働中のPHPシステムではエラー制御演算子を無効化できないといったけれど、 実は、 <a href="http://xdebug.org/docs/basic">Xdebug</a> の設定 <code class="highlighter-rouge">xdebug.scream</code> を使えば、エラー制御演算子を無効化できる。
                <code class="highlighter-rouge">php.ini</code> に、こんなふうに書けばいい。</p>

            <figure class="highlight">
                <pre><code class="language-ini" data-lang="ini"><span class="py">xdebug.scream</span> <span class="p">=</span> <span class="s">On</span></code></pre>
            </figure>

            <p>実行時に設定するなら、 <code class="highlighter-rouge">ini_set</code> 関数を使えばいい。</p>

            <figure class="highlight">
                <pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="nb">ini_set</span><span class="p">(</span><span class="s1">'xdebug.scream'</span><span class="p">,</span> <span class="s1">'1'</span><span class="p">)</span></code></pre>
            </figure>

            <p>PHPの拡張モジュール “<a href="http://php.net/book.scream">Scream</a>” にはXdebugと同じような機能がある。 ただ、Screamの場合は、設定項目の名前が <code class="highlighter-rouge">scream.enabled</code> になる。</p>

            <p>この機能が役立つのは、コードのデバッグ中など、エラーから情報を読み取りたいときだ。 screamを使うときには気をつけて、あくまでも一時的なデバッグ用のツールとして使うようにしよう。 エラー制御演算子を無効にしたままでは正常に動かないというライブラリって、結構多いよ。
            </p>

            <ul>
                <li>[Error Control Operators]</li>
                <li><a href="http://www.sitepoint.com/">SitePoint</a></li>
                <li><a href="http://xdebug.org/docs/basic">Xdebug</a></li>
                <li><a href="http://php.net/book.scream">Scream</a></li>
            </ul>

            <h3 id="errorexception">ErrorException</h3>

            <p>PHPは、例外が大好きな人たちにも対応したプログラミング言語だ。 ほんの数行のコードを足すだけで、例外に対応できる。 基本的に、エラーが発生したときには、 <code class="highlighter-rouge">ErrorException</code> クラスを使って「例外」を投げればいい。 このクラスは、 <code class="highlighter-rouge">Exception</code> クラスを継承したものだ。</p>

            <p>これは、SymfonyやLaravelみたいな今どきのフレームワークでもよく使われている方法だ。 これらのフレームワークのデバッグモード <em>(開発モード)</em> は、 <em>スタックトレース</em> をいい感じに表示してくれる。</p>

            <p>開発中は、エラーを例外として投げるようにしておくと、その処理をしやすくなる。 開発中にもし例外が発生したら、それをcatch文でラップして、その状況に対応する処理を書くこともできる。 例外をひとつキャッチするたびに、アプリケーションはほんの少しずつ頑丈になっていく。
            </p>

            <p>もっと詳しいことが知りたい、あるいは <code class="highlighter-rouge">ErrorException</code> クラスを使ったエラー処理について調べたいという人は、
                <a href="http://php.net/class.errorexception">ErrorException クラス</a> のドキュメントを読もう。</p>

            <ul>
                <li><a href="http://php.net/language.operators.errorcontrol">エラー制御演算子</a></li>
                <li><a href="http://php.net/errorfunc.constants">エラー処理用に定義済みの定数</a></li>
                <li><a href="http://php.net/function.error-reporting"><code class="highlighter-rouge">error_reporting()</code></a></li>
                <li><a href="/#error_reporting">エラーレポート</a></li>
            </ul>


        </section>


        <section class="chapter" id="exceptions">
            <h2 id="exceptions_title">例外処理</h2>

            <p>最近はやりのプログラミング言語には、たいてい例外処理の仕組みがある。でも PHP の人は見落としがちだ。 たとえば Ruby なんかは例外処理を使いまくっている。 HTTP リクエストに失敗したときもデータベースへのクエリが失敗したときも、画像ファイルが見つからなかったときでさえも、 Ruby のプログラム (あるいはその中で使っている gem) は例外を投げる。 なので、画面を見ればすぐに「ああ、何か間違えたんだな」とわかる。
            </p>

            <p>PHP はそのあたりが極めて緩くて、たとえば <code class="highlighter-rouge">file_get_contents()</code> が失敗しても単に
                <code class="highlighter-rouge">FALSE</code> を返して警告を出すだけだ。古いフレームワークの多くもそんな感じだ。 たとえば CodeIgniter の場合は、単に false を返してログファイルにメッセージを書き出すだけ。 原因を知りたければ <code class="highlighter-rouge">$this-&gt;upload-&gt;get_error()</code> みたいなメソッドを実行することになる。 何が問題かというと、まずエラーが発生したのかどうかを自分で調べないといけないこと。 そして次に、エラー情報を取得する方法をドキュメントで調べないといけないこと。 もっとはっきりわかるようにしてくれたらいいのに。
            </p>

            <p>別の問題もある。何かのクラスがエラーを画面に投げっぱなしにしてそのまま終わるような場合だ。 そんなことをすれば、エラーがあったときにプログラム中で動的に対応することができなくなってしまう。 そんな場合は、エラーではなく例外を発生させないといけない。 例外にしておけば開発者がエラーに気づけるし、プログラムの中で対応できるようになる。 たとえばこんな感じだ。
            </p>

            <figure class="highlight">
                <pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="nv">$email</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Fuel\Email</span><span class="p">;</span>
<span class="nv">$email</span><span class="o">-&gt;</span><span class="na">subject</span><span class="p">(</span><span class="s1">'タイトル'</span><span class="p">);</span>
<span class="nv">$email</span><span class="o">-&gt;</span><span class="na">body</span><span class="p">(</span><span class="s1">'ごきげんいかが？'</span><span class="p">);</span>
<span class="nv">$email</span><span class="o">-&gt;</span><span class="na">to</span><span class="p">(</span><span class="s1">'guy@example.com'</span><span class="p">,</span> <span class="s1">'誰かさん'</span><span class="p">);</span>

<span class="k">try</span>
<span class="p">{</span>
    <span class="nv">$email</span><span class="o">-&gt;</span><span class="na">send</span><span class="p">();</span>
<span class="p">}</span>
<span class="k">catch</span><span class="p">(</span><span class="nx">Fuel\Email\ValidationFailedException</span> <span class="nv">$e</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// 検証に失敗した
</span><span class="p">}</span>
<span class="k">catch</span><span class="p">(</span><span class="nx">Fuel\Email\SendingFailedException</span> <span class="nv">$e</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// ドライバがメールを送れなかった
</span><span class="p">}</span>
<span class="nx">finally</span>
<span class="p">{</span>
    <span class="c1">// 例外が発生してもしなくても、ここは必ず実行される
</span><span class="p">}</span></code></pre>
            </figure>

            <h3 id="spl-の例外">SPL の例外</h3>

            <p>汎用的な <code class="highlighter-rouge">Exception</code> クラスには、開発者がデバッグするためのコンテキスト情報がほとんど含まれていない。 これを改善するには、特化型の <code class="highlighter-rouge">Exception</code> を作ればいい。つまり、<code class="highlighter-rouge">Exception</code> クラスのサブクラスを作るってことだ。</p>

            <figure class="highlight">
                <pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="k">class</span> <span class="nc">ValidationException</span> <span class="k">extends</span> <span class="nx">Exception</span> <span class="p">{}</span></code></pre>
            </figure>

            <p>こんなふうにすれば、catch ブロックを複数用意してそれぞれの例外で別の処理をできるようになる。 その結果、自作の例外クラスが <em>大量に</em> できあがってしまうかもしれないが、
                <a href="/#standard_php_library">SPL 拡張モジュール</a> が用意する例外クラスを使えば少しはましになるだろう。</p>

            <p>たとえば、マジックメソッド <code class="highlighter-rouge">__call()</code> を使っているときに、無効なメソッドを要求されたとしよう。 標準の Exception クラスを使うのは曖昧すぎるし、そのためだけに専用の例外クラスを作るのも何だし、 という場合には単に <code class="highlighter-rouge">throw new BadMethodCallException;</code> とすればよい。</p>

            <ul>
                <li><a href="http://php.net/language.exceptions">例外について</a></li>
                <li><a href="http://php.net/spl.exceptions">SPL 拡張モジュール</a></li>
                <li><a href="http://www.brandonsavage.net/exceptional-php-nesting-exceptions-in-php/">PHP での例外のネスト</a></li>
                <li><a href="http://ralphschindler.com/2010/09/15/exception-best-practices-in-php-5-3">PHP 5.3での例外処理のベストプラクティス</a></li>
            </ul>


        </section>

        <div class="back-to-top">
            <p><a href="#top" class="top">Back to Top</a></p>
        </div>
        <section class="chapter" id="security">
            <h1 id="security_title">セキュリティ</h1>

        </section>


        <section class="chapter" id="web_application_security">
            <h2 id="web_application_security_title">ウェブアプリケーションのセキュリティ</h2>

            <p>世の中には悪い人たちがいて、あなたの書いたウェブアプリケーションもきっと狙われている。 必要な対策をして、ウェブアプリケーションのセキュリティを固めておくことが大切だ。 ありがたいことに、
                <a href="https://www.owasp.org/">The Open Web Application Security Project</a> (OWASP) の人たちが、既知のセキュリティ問題とその対策をまとめてくれている。 セキュリティが気になる開発者は必読だ。 Padraic Bradyが書いた<a href="http://phpsecurity.readthedocs.org/en/latest/index.html">Survive The Deep End: PHP Security</a> も、 ウェブアプリケーションセキュリティに関してPHP向けに書かれたよいドキュメントだ。
            </p>

            <ul>
                <li><a href="https://www.owasp.org/index.php/Guide_Table_of_Contents">OWASP Security Guideを読む</a></li>
            </ul>


        </section>


        <section class="chapter" id="password_hashing">
            <h2 id="password_hashing_title">パスワードのハッシュ処理</h2>

            <p>誰もがいつかは、ログイン機能を持つ PHP アプリケーションを書くことになる。 ユーザー名とパスワード (のハッシュ) をデータベースに保存して、 ユーザーのログイン時にそれを使って認証するというやつだ。
            </p>

            <p>データベースにパスワードを保存するときは、適切に <a href="http://ja.wikipedia.org/wiki/暗号学的ハッシュ関数"><em>ハッシュ</em></a> することが大切だ。 パスワードのハッシュは不可逆な操作で、ユーザーのパスワードに対して一方通行で行う。 できあがる結果は固定長の文字列で、元には戻せない。 つまり、このハッシュを別のハッシュと比較すれば元の文字列どうしが一致するかどうかは判断できるが、 元の文字列が何だったかはわからないってことだ。 パスワードをハッシュせずにデータベースに保存していると、 万一第三者に不正アクセスされた場合に、すべてのユーザーアカウントが乗っ取られてしまう。
            </p>

            <p>Passwords should also be individually <a href="https://en.wikipedia.org/wiki/Salt_(cryptography)"><em>salted</em></a> by adding a random string to each password before hashing. This prevents dictionary attacks and the use of “rainbow tables” (a reverse list of crytographic hashes for common passwords.)</p>

            <p>Hashing and salting are vital as often users use the same password for multiple services and password quality can be poor.</p>

            <p>Fortunately, nowadays PHP makes this easy.</p>

            <p><strong><code class="highlighter-rouge">password_hash</code>によるパスワードのハッシュ</strong></p>

            <p>PHP 5.5からは、新たに<code class="highlighter-rouge">password_hash()</code>関数が使えるようになった。 現時点では、この関数はBCryptを使っている。これは、現在のPHPがサポートしているアルゴリズムの中では最強のものだ。 必要に応じて、将来はもっと強力なアルゴリズムをサポートするように更新されるだろう。 この関数をPHP 5.5より前のバージョンでも使えるようにするため、<code class="highlighter-rouge">password_compat</code>ライブラリも作られた。 このライブラリはPHP 5.3.7以降で使える。</p>

            <p>この例では、文字列をハッシュした後でそのハッシュを新たな文字列と比較している。 二つの文字列は違っている(‘secret-password’と’bad-password’)ので、このログインは失敗する。
            </p>

            <figure class="highlight">
                <pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="k">require</span> <span class="s1">'password.php'</span><span class="p">;</span>

<span class="nv">$passwordHash</span> <span class="o">=</span> <span class="nb">password_hash</span><span class="p">(</span><span class="s1">'secret-password'</span><span class="p">,</span> <span class="nx">PASSWORD_DEFAULT</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="nb">password_verify</span><span class="p">(</span><span class="s1">'bad-password'</span><span class="p">,</span> <span class="nv">$passwordHash</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">// パスワードが一致した
</span><span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// パスワードが一致しなかった
</span><span class="p">}</span></code></pre>
            </figure>

            <p><code class="highlighter-rouge">password_hash()</code> takes care of password salting for you. The salt is stored, along with the algorithm and “cost”, as part of the hash. <code class="highlighter-rouge">password_verify()</code> extracts this to determine how to check the password, so you don’t need a separate database field to store your salts.</p>

            <ul>
                <li><a href="http://php.net/function.password-hash"><code class="highlighter-rouge">password_hash</code> について調べる</a></li>
                <li><a href="https://github.com/ircmaxell/password_compat">PHP &gt;= 5.3.7 &amp;&amp; &lt; 5.5 で使える <code class="highlighter-rouge">password_compat</code></a></li>
                <li><a href="http://ja.wikipedia.org/wiki/暗号学的ハッシュ関数">暗号学的なハッシュについて調べる</a></li>
                <li><a href="https://en.wikipedia.org/wiki/Salt_(cryptography)">ソルトについて調べる</a></li>
                <li><a href="https://wiki.php.net/rfc/password_hash">PHP <code class="highlighter-rouge">password_hash()</code> RFC</a></li>
            </ul>


        </section>


        <section class="chapter" id="data_filtering">
            <h2 id="data_filtering_title">データのフィルタリング</h2>

            <p>PHP のコードに外部から渡される入力は、絶対に信用してはいけない。 外部からの入力は、常に検証してから使うようにしよう。
                <code class="highlighter-rouge">filter_var()</code> 関数や <code class="highlighter-rouge">filter_input()</code> 関数で、入力の検証や書式の判定 (メールアドレスなど) ができる。
            </p>

            <p>外部からの入力にはいろいろな種類がある。フォームから渡される <code class="highlighter-rouge">$_GET</code> や <code class="highlighter-rouge">$_POST</code> もあれば、 スーパーグローバル <code class="highlighter-rouge">$_SERVER</code> に含まれるものもある。そして
                <code class="highlighter-rouge">fopen('php://input', 'r')</code> でやってくる HTTP リクエストのボディもそうだ。 外部からの入力といっても、ユーザーがフォームで入力したものばかりとは限らないことに注意。 アップロードしたりダウンロードしたりしたファイル、セッションのデータ、 クッキーのデータ、サードパーティのウェブサービスからのデータ。 これらはみんな外部からの入力となる。
            </p>

            <p>外部からのデータをいったん保存して、何かと組み合わせて後で使うとしよう。 それでも、そのデータが外部からの入力であるという事実は変わらない。 そのデータを処理したり出力したり何かとつなげたりコードに組み込んだりするときには 「適切にフィルタリングできてる？」「信頼できる？」と確認しよう。
            </p>

            <p>データのフィルタリング方法は、その利用目的によって異なる。 たとえば、外部の入力を何も処理せずに HTML ページに出力すると、 あなたのサイト上で任意の JavaScript が実行できてしまうことになる！ これが、いわゆるクロスサイトスクリプティング (XSS) である。 とても危険な攻撃だ。こんなときに XSS を回避する方法のひとつは、
                <code class="highlighter-rouge">strip_tags()</code> で入力からすべての HTML タグを取り除くか、 あるいは <code class="highlighter-rouge">htmlentities()</code> や <code class="highlighter-rouge">htmlspecialchars()</code> でエスケープして HTML エンティティに変換することだ。</p>

            <p>別の例として、外部の入力をコマンドラインのオプションとして渡すことを考えよう。 これって非常に危険なことだし、ふつうはあまりやるべきではないことだ。 でも、もしやるなら、組み込みの関数 <code class="highlighter-rouge">escapeshellarg()</code> を使えばコマンドの引数を実行されてしまうことが防げる。
            </p>

            <p>最後の例は、外部の入力に基づいてファイルシステム上のファイルを読み込むというものだ。 このときは、ファイル名のかわりにファイルパスを渡されてしまうという攻撃が考えられる。 外部の入力から”/”や”../”、
                <a href="http://php.net/security.filesystem.nullbytes">null バイト</a>などを取り除いて、 隠しファイルや公開すべきでない場所のファイルを読み込まないようにする必要がある。
            </p>

            <ul>
                <li><a href="http://php.net/book.filter">データのフィルタリング</a></li>
                <li><a href="http://php.net/function.filter-var"><code class="highlighter-rouge">filter_var</code> 関数</a></li>
                <li><a href="http://php.net/function.filter-input"><code class="highlighter-rouge">filter_input</code> 関数</a></li>
                <li><a href="http://php.net/security.filesystem.nullbytes">null バイトの扱い</a></li>
            </ul>

            <h3 id="サニタイズ">サニタイズ</h3>

            <p>サニタイズとは、外部の入力から危険な文字を取り除く (あるいはエスケープする) ことだ。</p>

            <p>たとえば、外部の入力を HTML に含めたり SQL クエリに組み込んだりする前に、 サニタイズが必要となる。
                <a href="#databases">PDO</a> でバインド変数を使う場合は、 PDO が入力をサニタイズする。</p>

            <p>外部の入力を HTML として組み込むときに、いくつかの安全な HTML タグはそのまま使わせたいという場合もある。そんな要求を実現するのは非常に難しいので、 たいていの場合は Markdown や BBCode などのフォーマットを代替手段として使うのだが、 どうしてもとうい場合は <a href="http://htmlpurifier.org/">HTML Purifier</a> のようなホワイトリストライブラリを使える。
            </p>

            <p><a href="http://php.net/filter.filters.sanitize">サニタイズフィルター</a></p>

            <h3 id="アンシリアライズ">アンシリアライズ</h3>

            <p>ユーザーからの入力など、信頼できないところから渡されたデータを <code class="highlighter-rouge">unserialize()</code> するのは危険だ。 悪意のあるユーザーが送り込んだオブジェクト（ユーザー定義のプロパティつきのもの）のインスタンスを生成できてしまい、
                <strong>たとえそのオブジェクトを一切使わなくても</strong> そのデストラクタは実行されてしまう。 なので、信頼できないデータのアンシリアライズは避けるべきだ。
            </p>

            <p>どうしてもその必要がある場合は、PHP 7で追加されたオプション <a href="https://secure.php.net/manual/ja/function.unserialize.php"><code class="highlighter-rouge">allowed_classes</code></a> を使うこと。このオプションは、許可した型のオブジェクトだけをアンシリアライズできるように制限するものだ。
            </p>

            <h3 id="バリデーション">バリデーション</h3>

            <p>バリデーションとは、外部の入力が期待通りであるかどうかを確かめること。 たとえばユーザー登録の処理では、 メールアドレスや電話番号、あるいは年齢などを検証することになるだろう。
            </p>

            <p><a href="http://php.net/filter.filters.validate">バリデーションフィルター</a></p>


        </section>


        <section class="chapter" id="configuration_files">
            <h2 id="configuration_files_title">設定ファイル</h2>

            <p>自作のアプリケーションで設定ファイルを使うときには、これらの指針に従うのがお勧めだ。</p>

            <ul>
                <li>設定情報に直接アクセスしたり、ファイルシステム経由で取り込んだりできないようにする。</li>
                <li>どうしてもドキュメントルートに設定ファイルを置かざるを得ないのなら、そのファイルの拡張子を<code class="highlighter-rouge">.php</code>にする。 そうすれば、仮にそのファイルへ直接アクセスされたとしても、中身がそのまま見えてしまうことはない。
                </li>
                <li>設定ファイル内の情報は適切に保護すること。暗号化するなり、ファイルシステム上のパーミッションをきちんと設定するなりしておく。</li>
                <li>パスワードやAPIトークンなどの機密情報を含んだ設定ファイルは、ソース管理システムに含めないようにする。</li>
            </ul>

        </section>


        <section class="chapter" id="register_globals">
            <h2 id="register_globals_title">Register Globals</h2>

            <p><strong>注意:</strong> PHP 5.4.0 からは <code class="highlighter-rouge">register_globals</code> という設定項目がなくなったので、この設定は使えない。 このページは単に、大昔のアプリケーションをアップグレードしている人たち向けの警告として用意したものでしかない。
            </p>

            <p><code class="highlighter-rouge">register_globals</code>を有効にすると、<code class="highlighter-rouge">$_POST</code>や<code class="highlighter-rouge">$_GET</code>そして<code class="highlighter-rouge">$_REQUEST</code> などの内容にアプリケーションのグローバルスコープでアクセスできるようになる。 これを使うとセキュリティの問題が発生しやすくなる。 というのも、そのデータがどこからきたものなのかをアプリケーション側で判断できなくなるからだ。
            </p>

            <p>たとえば <code class="highlighter-rouge">$_GET['foo']</code> の内容に <code class="highlighter-rouge">$foo</code> でアクセスできることになるのだが、 これは、宣言されていない変数の中身を自動的に上書きしてしまうことにつながる。 PHP 5.4.0 より前のバージョンを使っている場合は、
                <strong>確実に</strong> <code class="highlighter-rouge">register_globals</code> を <strong>off</strong> にしておこう。</p>

            <ul>
                <li><a href="http://php.net/security.globals">register_globals に関する PHP マニュアルでの説明</a></li>
            </ul>

        </section>


        <section class="chapter" id="error_reporting">
            <h2 id="error_reporting_title">エラーレポート</h2>

            <p>エラーを記録しておくと、アプリケーションに何か問題があったときにその原因を見つけやすくなる。 しかしその一方で、アプリケーションの構造に関する情報を外部に公開してしまうことにもなる。 エラーメッセージを出すことで起こる問題からアプリケーションを守るには、 開発環境と本番環境でサーバーの設定を切り替える必要がある。
            </p>

            <h3 id="開発環境">開発環境</h3>

            <p><strong>開発</strong> 環境で、起こりうるエラーをすべて表示するときには、<code class="highlighter-rouge">php.ini</code>で次のように設定する。</p>

            <figure class="highlight">
                <pre><code class="language-ini" data-lang="ini"><span class="py">display_errors</span> <span class="p">=</span> <span class="s">On</span>
<span class="py">display_startup_errors</span> <span class="p">=</span> <span class="s">On</span>
<span class="py">error_reporting</span> <span class="p">=</span> <span class="s">-1</span>
<span class="py">log_errors</span> <span class="p">=</span> <span class="s">On</span></code></pre>
            </figure>

            <blockquote>
                <p>値に<code class="highlighter-rouge">-1</code>を指定すると、仮に将来のバージョンのPHPで新しいレベルと定数が追加されたとしてもすべてのエラーを表示するようになります。E_ALL 定数も、PHP 5.4以降これと同じ挙動になります。 - <a href="http://php.net/manual/function.error-reporting.php">php.net</a></p>
            </blockquote>

            <p><code class="highlighter-rouge">E_STRICT</code>エラーレベル定数は5.3.0で導入されたもので、当時は
                <code class="highlighter-rouge">E_ALL</code>には含まれていなかった。でも5.4.0からは<code class="highlighter-rouge">E_ALL</code>に含まれるようになった。 だからどうなんだって？ あらゆるエラーを表示させたいときには、5.3の場合は
                <code class="highlighter-rouge">-1</code>あるいは<code class="highlighter-rouge">E_ALL | E_STRICT</code>を使わないといけないってことだ。</p>

            <p><strong>PHPのバージョン別の、すべてのエラーを表示させるための設定</strong></p>

            <ul>
                <li>&lt; 5.3 <code class="highlighter-rouge">-1</code> or <code class="highlighter-rouge">E_ALL</code></li>
                <li> 5.3 <code class="highlighter-rouge">-1</code> or <code class="highlighter-rouge">E_ALL | E_STRICT</code></li>
                <li>&gt; 5.3 <code class="highlighter-rouge">-1</code> or <code class="highlighter-rouge">E_ALL</code></li>
            </ul>

            <h3 id="本番環境">本番環境</h3>

            <p><strong>本番</strong> 環境でエラーの情報を見せないようにするには、<code class="highlighter-rouge">php.ini</code>で次のように設定する。</p>

            <figure class="highlight">
                <pre><code class="language-ini" data-lang="ini"><span class="py">display_errors</span> <span class="p">=</span> <span class="s">Off</span>
<span class="py">display_startup_errors</span> <span class="p">=</span> <span class="s">Off</span>
<span class="py">error_reporting</span> <span class="p">=</span> <span class="s">E_ALL</span>
<span class="py">log_errors</span> <span class="p">=</span> <span class="s">On</span></code></pre>
            </figure>

            <p>この本番環境用の設定をしても、ウェブサーバーのエラーログにはエラーの内容がきちんと残る。 しかし、ユーザーにはエラーが見えなくなる。これらの設定項目についてもっと詳しく知りたければ、 PHP のマニュアルを読もう。</p>

            <ul>
                <li><a href="http://php.net/errorfunc.configuration#ini.error-reporting">error_reporting</a></li>
                <li><a href="http://php.net/errorfunc.configuration#ini.display-errors">display_errors</a></li>
                <li><a href="http://php.net/errorfunc.configuration#ini.display-startup-errors">display_startup_errors</a></li>
                <li><a href="http://php.net/errorfunc.configuration#ini.log-errors">log_errors</a></li>
            </ul>

        </section>

        <div class="back-to-top">
            <p><a href="#top" class="top">Back to Top</a></p>
        </div>
        <section class="chapter" id="testing">
            <h1 id="testing_title">テスト</h1>

            <p>PHPのコードを書くときには、自動化されたテストも書くのがよい習慣だとされている。 そうすれば、頑丈なアプリケーションが作れるようになる。自動テストを活用すれば、 何かを変更したり機能を追加したりしたときにもアプリケーションがきちんと動くことを確認できる。 欠かせないツールだ。
            </p>

            <p>PHP で使えるテスト用ツール (あるいはフレームワーク) にはいくつかのものがあり、 それぞれ異なる手法を使っている。が、目指すところは同じ。 手作業でのテストをなくす、そして最新の変更で既存の機能を壊していないかどうかを確かめるためだけに 大規模な品質保証チームを使うなんてことをなくす、というのが目標だ。
            </p>

        </section>


        <section class="chapter" id="test_driven_development">
            <h2 id="test_driven_development_title">テスト駆動開発</h2>

            <p><a href="http://en.wikipedia.org/wiki/Test-driven_development">Wikipedia</a> によると、</p>

            <blockquote>
                <p>Test-driven development (TDD) is a software development process that relies on the repetition of a very short development cycle: first the developer writes a failing automated test case that defines a desired improvement or new function, then produces code to pass that test and finally refactors the new code to acceptable standards. Kent Beck, who is credited with having developed or ‘rediscovered’ the technique, stated in 2003 that TDD encourages simple designs and inspires confidence.</p>
            </blockquote>

            <p>アプリケーションのテストには、いくつかの種類がある。</p>

            <h3 id="ユニットテスト">ユニットテスト</h3>

            <p>ユニットテストとはプログラミングの手法のひとつだ。 関数やクラスやメソッドが期待通りに動いていることを開発中に常に確かめる。 さまざまな関数やメソッドはの入出力の値をチェックすれば、 その内部ロジックが正しく動いていることを確認できる。 依存性注入の仕組みを利用してクラスのモックやスタブを使えば、 依存ライブラリが正しく使われていることを確かめられる。
            </p>

            <p>クラスや関数を作るときに、その振る舞いを確かめるためのユニットテストも同時に作る。 最も基本的なレベルだと、間違った引数を渡した場合にエラーになることや、 正しい引数を渡したときに正常に動くことなどを確認しないといけない。 こうしておけば、後にクラスや関数に手を加えたときにも 今までの機能が期待通りに動くかどうかを確かめられるようになる。 test.php で <code class="highlighter-rouge">var_dump()</code> とかいうやり方もあるけど、 まともなアプリケーションを作るつもりならそれはあり得ない。
            </p>

            <p>それ以外にもユニットテストの使い道はある。オープンソースに貢献する手段として使えるのだ。 うまく機能していないことを示すためにテストを書く。そして動くように修正する。 最後にテストが通ることを確認する。こんなパッチを送れば、きっと受け入れてもらいやすくなるだろう。 もし何かプロジェクトを運営していて pull request を受け付けているのなら、 「パッチにはテストをつけること」という条件をつけておくといいだろう。
            </p>

            <p><a href="http://phpunit.de">PHPUnit</a>は、PHPアプリケーションでユニットテストを書くための デファクトスタンダードのフレームワークだ。しかしそれ以外にも選択肢がある。
            </p>

            <ul>
                <li><a href="https://github.com/atoum/atoum">atoum</a></li>
                <li><a href="https://github.com/crysalead/kahlan">Kahlan</a></li>
                <li><a href="http://peridot-php.github.io/">Peridot</a></li>
                <li><a href="http://simpletest.org">SimpleTest</a></li>
            </ul>

            <h3 id="インテグレーションテスト">インテグレーションテスト</h3>

            <p><a href="http://en.wikipedia.org/wiki/Integration_testing">Wikipedia</a> によると、</p>

            <blockquote>
                <p>Integration testing (sometimes called Integration and Testing, abbreviated “I&amp;T”) is the phase in software testing in which individual software modules are combined and tested as a group. It occurs after unit testing and before validation testing. Integration testing takes as its input modules that have been unit tested, groups them in larger aggregates, applies tests defined in an integration test plan to those aggregates, and delivers as its output the integrated system ready for system testing.</p>
            </blockquote>

            <p>ユニットテスト用のツールの多くはインテグレーションテストにも使える。 ほぼ同じような指針で行うものだからである。
            </p>

            <h3 id="機能テスト">機能テスト</h3>

            <p>受け入れテストと呼ばれることもある。実際にアプリケーションを使う観点での自動テストを作ってその動きを確認する。 単にコード片が正しく動くとか、個々のパーツがお互いに正しくやりとりできるかとかいうレベルのテストではない。 このレベルのテストでは、実際のデータを使ったりアプリケーションの実際のユーザーをシミュレートしたりすることが一般的だ。
            </p>

            <h4 id="機能テスト用のツール">機能テスト用のツール</h4>

            <ul>
                <li><a href="http://seleniumhq.com">Selenium</a></li>
                <li><a href="http://mink.behat.org">Mink</a></li>
                <li><a href="http://codeception.com">Codeception</a> これはフルスタックのテスティングフレームワークで、受け入れテスト用のツール群も含んでいる</li>
                <li><a href="http://datasift.github.io/storyplayer">Storyplayer</a> これはフルスタックのテスティングフレームワークで、テスト環境をオンデマンドで作ったり破棄したりする機能も含んでいる</li>
            </ul>

        </section>


        <section class="chapter" id="behavior_driven_development">
            <h2 id="behavior_driven_development_title">振る舞い駆動開発</h2>

            <p>振る舞い駆動開発 (BDD) には二種類ある。SpecBDD と StoryBDD だ。 SpecBDD はコードの技術的な振る舞いを重視し、StoryBDD は業務的あるいは機能的な振る舞いを重視する。 PHP には、これら二種類の BDD 用のフレームワークが存在する。</p>

            <p>StoryBDD では、人間が読める形式のストーリーを書いてアプリケーションの振る舞いを表す。 そしてそのストーリーを、アプリケーションのテストとして実行する。 PHP アプリケーションで StoryBDD をするために使えるフレームワークが
                <a href="http://behat.org/">Behat</a> で、これは Ruby の <a href="http://cukes.info/">Cucumber</a> の影響を受けたフレームワークである。 Gherkin DSL を使ってフィーチャを記述できる。</p>

            <p>SpecBDD では、実際のコードのあるべき振る舞いをスペックとして書く。 関数やメソッドを単独でテストするのではなく、その関数やメソッドがどのように振る舞うのかを記述するのだ。 PHP で SpecBDD をするときに使えるフレームワークが <a href="http://www.phpspec.net/">PHPSpec</a> で、これは Ruby の <a href="http://rspec.info/">RSpec project</a> の影響を受けている。</p>

            <h3 id="bdd-に関するリンク">BDD に関するリンク</h3>

            <ul>
                <li><a href="http://behat.org/">Behat</a> は PHP 用の StoryBDD フレームワークで、Ruby の <a href="http://cukes.info/">Cucumber</a> プロジェクトの影響を受けている。</li>
                <li><a href="http://www.phpspec.net/">PHPSpec</a> は PHP 用の SpecBDD フレームワークで、Ruby の <a href="http://rspec.info/">RSpec</a> プロジェクトの影響を受けている。</li>
                <li><a href="http://codeception.com/">Codeception</a> はフルスタックのテストフレームワークで、BDD の原則に従っている。</li>
            </ul>


        </section>


        <section class="chapter" id="complementary_testing_tools">
            <h2 id="complementary_testing_tools_title">その他のテスト用ツール</h2>

            <p>これまでに取り上げたテストツールや振る舞い駆動開発フレームワーク以外にも、 いろいろなフレームワークやヘルパーライブラリがある。これらも有用に使える。
            </p>

            <h3 id="ツールへのリンク">ツールへのリンク</h3>

            <ul>
                <li><a href="http://seleniumhq.org/">Selenium</a> はブラウザ自動化ツールで、<a href="https://github.com/giorgiosironi/phpunit-selenium/">PHPUnit と組み合わせて使える</a>。</li>
                <li><a href="https://github.com/padraic/mockery">Mockery</a> はモックオブジェクトフレームワークで、<a href="http://phpunit.de/">PHPUnit</a> や <a href="http://www.phpspec.net/">PHPSpec</a> と組み合わせて使える。</li>
                <li><a href="https://github.com/phpspec/prophecy">Prophecy</a> は強力で柔軟な PHP 用モックオブジェクトフレームワークで、<a href="http://www.phpspec.net/">PHPSpec</a> に組み込まれている。さらに <a href="http://phpunit.de/">PHPUnit</a> と組み合わせても使える。</li>
            </ul>


        </section>

        <div class="back-to-top">
            <p><a href="#top" class="top">Back to Top</a></p>
        </div>
        <section class="chapter" id="servers_and_deployment">
            <h1 id="servers_and_deployment_title">各種サーバーへのデプロイ</h1>

            <p>PHP のアプリケーションをデプロイして本番サーバーで運用するための方法を紹介する。</p>

        </section>


        <section class="chapter" id="platform_as_a_service">
            <h2 id="platform_as_a_service_title">Platform as a Service (PaaS)</h2>

            <p>PaaS を使えば、PHP アプリケーションをウェブ上で動かすために必要なシステムやネットワーク環境を用意してくれる。 ほとんど何も設定せずに、PHP のアプリケーションやフレームワークを実行できるということだ。</p>

            <p>最近は、PHP アプリケーションのデプロイ先として PaaS を使うことが多くなった。あらゆる規模のアプリケーションを扱える。
                <a href="#php-paas-providers">PHP 用の PaaS “Platform as a Service” プロバイダ</a> を、<a href="#resources">情報源</a> にまとめた。
            </p>

        </section>


        <section class="chapter" id="virtual_or_dedicated_servers">
            <h2 id="virtual_or_dedicated_servers_title">仮想サーバーあるいは専用サーバー</h2>

            <p>サーバー管理が苦にならない人、あるいはサーバー管理を勉強してみたい人は、仮想サーバーあるいは専用サーバーを選ぶといい。 そうすれば、アプリケーションの運用環境を完全に制御できる。
            </p>

            <h3 id="nginx-と-php-fpm">nginx と PHP-FPM</h3>

            <p>PHP に組み込まれた FastCGI Process Manager (FPM) は <a href="http://nginx.org/">nginx</a> と組み合わせるのに最適だ。nginx は、軽量でパフォーマンスに優れたウェブサーバーである。 Apache よりも少ないメモリで動き、同時にさばけるリクエストの数も多い。 これは特に、共有メモリの少ない仮想サーバーでは重要だ。
            </p>

            <ul>
                <li><a href="http://nginx.org/">nginx</a></li>
                <li><a href="http://php.net/install.fpm">PHP-FPM</a></li>
                <li><a href="https://nealpoole.com/blog/2011/04/setting-up-php-fastcgi-and-nginx-dont-trust-the-tutorials-check-your-configuration/">nginx と PHP-FPM で安全な環境を作る</a></li>
            </ul>

            <h3 id="apache-と-php">Apache と PHP</h3>

            <p>PHP と Apache は長い付き合いだ。 Apache はいろんな設定が可能で、さまざまな <a href="http://httpd.apache.org/docs/2.4/mod/">モジュール</a> で機能を拡張できる。共有サーバーで PHP のフレームワークを動かしたり、WordPress みたいなアプリケーションを動かしたりするときにはよく使われる選択肢だ。 残念ながら Apache は、デフォルトでは nginx よりもメモリを食うし、 同時にさばけるユーザー数も nginx より少ない。</p>

            <p>Apache で PHP を動かすにはいくつかの選択肢がある。 一番よく使われていて簡単に設定できるのが、
                <a href="http://httpd.apache.org/docs/2.4/mod/prefork.html">prefork MPM</a> と mod_php5 の組み合わせだ。 メモリの使用効率はそれほどよくないが、とりあえず動かして使うには一番シンプルだ。 サーバー管理方面にあまり足を突っ込みたくない場合は、この方法がいいだろう。 注意すべき点は、mod_php5 を使う場合は必ず prefork MPM を使わないといけないということだ。</p>

            <p>Apache 本来のパフォーマンスや安定性をもっと絞り出したいという場合は、nginx と同じように FPM を使うこともできる。 この場合は、
                <a href="http://httpd.apache.org/docs/2.4/mod/worker.html">worker MPM</a> あるいは
                <a href="http://httpd.apache.org/docs/2.4/mod/event.html">event MPM</a> に mod_fastcgi あるいは mod_fcgid を組み合わせる。この設定はメモリの利用効率がよくて高速に動作するが、設定に手間がかかる。
            </p>

            <p>If you are running Apache 2.4 or later, you can use <a href="https://httpd.apache.org/docs/current/mod/mod_proxy_fcgi.html">mod_proxy_fcgi</a> to get great performance that is easy to setup.</p>

            <ul>
                <li><a href="http://httpd.apache.org/">Read more on Apache</a></li>
                <li><a href="http://httpd.apache.org/docs/2.4/mod/mpm_common.html">Read more on Multi-Processing Modules</a></li>
                <li><a href="https://blogs.oracle.com/opal/entry/php_fpm_fastcgi_process_manager">Read more on mod_fastcgi</a></li>
                <li><a href="http://httpd.apache.org/mod_fcgid/">Read more on mod_fcgid</a></li>
                <li><a href="https://httpd.apache.org/docs/current/mod/mod_proxy_fcgi.html">Read more on mod_proxy_fcgi</a></li>
                <li><a href="https://serversforhackers.com/video/apache-and-php-fpm">Read more on setting up Apache and PHP-FPM with mod_proxy_fcgi</a></li>
            </ul>


        </section>


        <section class="chapter" id="shared_servers">
            <h2 id="shared_servers_title">共有サーバー</h2>

            <p>PHP の人気のおかげで、いろんな共有サーバーで PHP が使える。 むしろ PHP が使えない共有サーバーを見つけるほうが難しいだろう。 ただし、最新バージョンが使えるかどうかは要注意だ。 共有サーバーでは、あなただけでなく他の開発者も同じマシンにウェブサイトをデプロイする。 その利点は、安上がりに使えるということだ。 ただ欠点もあって、同じサーバーに同居しているお隣さんが何をしでかすかがわからない。 めちゃめちゃ負荷のかかることをしてしまったり、セキュリティホールを作り込んでしまったりといった恐れがある。 もし充分な予算があるのなら、できるだけ共有サーバーは避けよう。
            </p>

        </section>


        <section class="chapter" id="building_and_deploying_your_application">
            <h2 id="building_and_deploying_your_application_title">アプリケーションのビルドとデプロイ</h2>

            <p>まさか、データベースのスキーマを変更したりテストを実行したりとかいったことを手作業でやってるなんてことはないよね？ ちょっと待った！新しいバージョンのアプリケーションをデプロイするときに手作業がひとつでも増えると、 致命的な間違いを犯してしまう可能性もそのぶん増えてしまうんだ。たとえ単純な更新作業だとしても、 きちんとしたビルド手順にしたがうこと。継続的インテグレーションの戦略にしたがって、
                <a href="http://ja.wikipedia.org/wiki/ビルド_(ソフトウェア)">ビルドの自動化</a> をしておくといい。</p>

            <p>自動化できるタスクには、こんなものがある。</p>

            <ul>
                <li>依存関係の管理</li>
                <li>必要な資産のコンパイル</li>
                <li>テストの実行</li>
                <li>ドキュメントの生成</li>
                <li>パッケージング</li>
                <li>デプロイ</li>
            </ul>

            <h3 id="デプロイツール">デプロイツール</h3>

            <p>デプロイツールとは、ソフトウェアのデプロイにからむありがちな作業を処理するスクリプトをまとめたものだと言える。 デプロイツール自体は君が作るソフトウェアの一部ではない。ソフトウェアを「外部から」支援するものだ。
            </p>

            <p>ビルド自動化やデプロイの助けとなるオープンソースのツールがたくさん公開されている。PHPで書かれているものもあれば、 そうじゃないものもある。PHP製じゃないからといって、それを使わない理由はない。 もし自分のやりたいことに適したツールがあるのなら、使うべきだ。いくつか例をあげよう。
            </p>

            <p><a href="http://www.phing.info/">Phing</a> を使えば、パッケージングやデプロイそしてテストといった処理をシンプルなXMLビルドファイルで設定できる。 Phingは
                <a href="http://ant.apache.org/">Apache Ant</a> をベースに作られたもので、 Webアプリのインストールやアップデートに必要となるタスク群を提供する。 カスタムタスクで機能を追加することもでき、カスタムタスクはPHPで書ける。 古くからあるツールだけあって堅実で安定してるけど、ちょっと古臭さも感じる (設定をXMLファイルで管理するところとかね)。
            </p>

            <p><a href="https://github.com/capistrano/capistrano/wiki">Capistrano</a> は
                <em>中級から上級のプログラマー</em> 向けのシステムだ。構造化された、繰り返し可能な形式で、 複数のリモートマシン上でコマンドを実行できる。 Ruby on Railsのアプリをデプロイするように設定されているが、 PHP のアプリもデプロイできる。 Capistranoを使いこなすには、RubyとRakeに関するそれなりの知識が必要だ。 Dave Gardnerのblog記事<a href="http://www.davegardner.me.uk/blog/2012/02/13/php-deployment-with-capistrano/">PHP Deployment with Capistrano</a> は、Capistranoに興味のあるPHP開発者への入門記事としておすすめだ。
            </p>

            <p><a href="http://rocketeer.autopergamene.eu/">Rocketeer</a> は、Laravelフレームワークの思想にヒントを得たものだ。 高速かつエレガントであり、よく考えられたデフォルト設定で簡単に使えることを目標としている。 複数サーバーや複数ステージ、アトミックなデプロイに対応していて、複数のデプロイを並列に実行できる。 すべてのパーツは動かしたままでの交換や拡張に対応しているし、ぜんぶPHPで書かれている。
            </p>

            <p><a href="http://deployer.org/">Deployer</a> はPHPで書かれたデプロイツールで、シンプルかつ機能的だ。 タスクを並列に実行し、アトミックなデプロイを行い、サーバー間の整合性を維持する。 SymfonyやLaravel、Zend Framework、そしてYiiなどで使える、一般的なタスクのレシピが用意されている。 Younes Rafieの記事<a href="http://www.sitepoint.com/deploying-php-applications-with-deployer/">Easy Deployment of PHP Applications with Deployer</a> は、Deployerを使ってアプリケーションをデプロイするためのよいチュートリアルになっている。
            </p>

            <p><a href="http://magephp.com/">Magallanes</a> もPHPで書かれたツールで、YAMLでのシンプルな設定ができる。 複数サーバーや複数環境、アトミックなデプロイに対応していて、 一般的なツールやフレームワークで使える組み込みのタスクが用意されている。
            </p>

            <h4 id="あわせて読みたい">あわせて読みたい:</h4>

            <ul>
                <li><a href="http://net.tutsplus.com/tutorials/other/automate-your-projects-with-apache-ant/">Apache Antによるプロジェクトの自動化</a></li>
                <li><a href="http://viccherubini.com/assets/Expert-PHP-Deployments.pdf">Expert PHP Deployments</a> - CapistranoやPhing、Vagrantによるデプロイを扱ったフリーの書籍</li>
                <li><a href="http://www.deployingphpapplications.com">Deploying PHP Applications</a> - PHPのデプロイに関するベストプラクティスやツールを扱った書籍</li>
            </ul>

            <h3 id="サーバープロビジョニング">サーバープロビジョニング</h3>

            <p>サーバーの構成管理は、大量のサーバーを扱うようになると特に大変なタスクだ。 いろんなツールが用意されているので、こういったインフラの構築を自動化できる。 ツールを使えば、適切なサーバーが適切な構成になっていることを確実にできる。 これらのツールは大規模なクラウドホスティングプロバイダー (Amazon Web Services, Heroku, DigitalOceanなど) にもインスタンスの管理用に統合されていることが多くて、 より簡単にアプリケーションをスケールできるようになっている。
            </p>

            <p><a href="https://www.ansible.com/">Ansible</a> は、YAMLファイルでインフラを管理するツールだ。 気軽に使い始められるし、複雑で大規模なアプリケーションにも使える。 クラウドのインスタンスを管理するためのAPIも用意されていて、 対応したツールを使えば動的インベントリを通じてインスタンスを管理できる。
            </p>

            <p><a href="https://puppet.com/">Puppet</a> は、独自の言語やファイルタイプを使ってサーバーや構成を管理する。 マスター／クライアント形式で使うこともできるし、「マスターレス」モードで使うこともできる。 マスター／クライアントモードの場合は、所定のインターバルでクライアントが中央サーバーをポーリングして、 新しい構成が見つかったら自分自身を更新する。 マスターレスモードでは、変更内容を各ノードにプッシュする。
            </p>

            <p><a href="https://www.chef.io/">Chef</a> はRubyで作られた強力なシステムインテグレーションフレームワークで、 サーバー環境や仮想マシンをまるごと構築できる。 Amazon Web Servicesとも統合されていて、OpsWorksというサービスを通じて利用する。</p>

            <h4 id="あわせて読みたい-1">あわせて読みたい:</h4>

            <ul>
                <li><a href="https://serversforhackers.com/an-ansible-tutorial">Ansibleチュートリアル</a></li>
                <li><a href="https://leanpub.com/ansible-for-devops">Ansible for DevOps</a> - Ansibleのすべてを扱った書籍</li>
                <li><a href="https://leanpub.com/ansible-for-aws">Ansible for AWS</a> - AnsibleとAmazon Web Servicesとの統合について扱った書籍</li>
                <li><a href="http://www.jasongrimes.org/2012/06/managing-lamp-environments-with-chef-vagrant-and-ec2-1-of-3/">LAMPアプリケーションのデプロイにChefやVagrantそしてEC2を使うというお題で書かれた全3回のシリーズ</a></li>
                <li><a href="https://github.com/chef-cookbooks/php">Chefのクックブック。PHPのインストールと設定やPEARについて扱っている</a></li>
                <li><a href="https://www.youtube.com/playlist?list=PL11cZfNdwNyPnZA9D1MbVqldGuOWqbumZ">Chefのビデオチュートリアルシリーズ</a></li>
            </ul>

            <h3 id="継続的インテグレーション">継続的インテグレーション</h3>

            <blockquote>
                <p>継続的インテグレーションはソフトウェア開発のプラクティスのひとつで、 チームのメンバーが自分たちの作業を頻繁に統合するというものだ。 通常は、各自が少なくとも一日に一度は統合する。一日に何度も統合することもある。 多くのチームが、この方針のおかげで統合時の問題が少なくなるし、 きちんとしたソフトウェアをより素早く開発できるようになると実感している。
                </p>
            </blockquote>

            <p><em>– マーティン・ファウラー</em></p>

            <p>PHPで継続的インテグレーションを実践する方法はいろいろある。
                <a href="https://travis-ci.org/">Travis CI</a> のおかげで、 ちょっとしたプロジェクトにも簡単に継続的インテグレーションを組み込めるようになった。 Travis CIは継続的インテグレーションのホスティング環境で、オープンソースコミュニティに開放されている。 GitHubと統合されており、PHPを含むさまざまな言語に対応している。
            </p>

            <h4 id="あわせて読みたい-2">あわせて読みたい</h4>

            <ul>
                <li><a href="http://jenkins-ci.org/">Jenkinsによる継続的インテグレーション</a></li>
                <li><a href="http://www.phptesting.org/">PHPCIによる継続的インテグレーション</a></li>
                <li><a href="http://www.jetbrains.com/teamcity/">Teamcityによる継続的インテグレーション</a></li>
            </ul>


        </section>

        <div class="back-to-top">
            <p><a href="#top" class="top">Back to Top</a></p>
        </div>
        <section class="chapter" id="virtualization">
            <h1 id="virtualization_title">仮想化</h1>

            <p>開発環境だの本番環境だの、いろいろ違う環境でアプリケーションを動かしていると、おかしなバグに出くわしてしまいかねない。 「開発環境だと問題ないのに、本番環境だと動かない」みたいなやつだ。 また、チームで開発しているときに、開発環境のいろんなライブラリのバージョンをきちんと統一しておくのも、面倒だ。
            </p>

            <p>Windowsで開発してLinux（などWindows以外の環境）にデプロイしていたり、チームで開発していたりする場合は、 仮想マシンを使うことを考えるべきだ。 何も難しいことはない。VMwareやVirtualBoxみたいな有名どころだけでなく、 仮想環境を簡単に準備するためのツールも用意されている。
            </p>

        </section>


        <section class="chapter" id="vagrant">
            <h2 id="vagrant_title">Vagrant</h2>

            <p><a href="http://vagrantup.com/">Vagrant</a>を使えば、既知の仮想環境を使って自分用のボックスを作れて、その環境の構成も、たったひとつの設定ファイルだけでできる。 このボックスを手動で設定することもできるし、
                <a href="http://www.puppetlabs.com/">Puppet</a>とか<a href="https://www.chef.io/">Chef</a>みたいな「プロビジョニング」ソフトにおまかせすることだってできる。 ベースとなる環境を配布できるようにしておけば、複数の開発環境をまったく同じ状態に構築できる。 複雑怪奇なコマンドを羅列した「環境構築手順書」だとかいうのもいらなくなるってこと。 ベース環境を「破棄」したり作りなおしたりするのもそんなに手間がかからないので、 まっさらな環境を用意するのもお手軽にできる。
            </p>

            <p>Vagrantは、フォルダを作って、ホストと仮想マシンの間でコードを共有する。 つまり、ホストマシンで作ったり編集したりしたコードを、そのまま仮想マシンの中で実行できるっていうことだ。
            </p>

            <h3 id="ちょっとした手助け">ちょっとした手助け</h3>

            <p>Vagrantを使い始めるときの手助けになるのが、これらのサービスだ。</p>

            <ul>
                <li><a href="http://rove.io/">Rove</a>: PHPなどのオプション込みで、一般的なVagrantビルドを作ってくれるサービス。プロビジョニングにはChefを使う。</li>
                <li><a href="https://puphpet.com/">Puphpet</a>: PHPの開発用の仮想マシンを作ってくれる、シンプルなGUI。
                    <strong>PHPに特化している。</strong> ローカルVM以外に、クラウドサービスにデプロイすることもできる。 プロビジョニングにはPuppetを使う。
                </li>
                <li><a href="http://getprotobox.com/">Protobox</a>: vagrant をラップしたウェブ GUI で、ウェブ開発向けの仮想マシンを用意してくれる。 シンプルな YAML ドキュメントを使って、仮想マシン上にインストールするすべてものを制御できる。</li>
                <li><a href="http://phansible.com/">Phansible</a>: 使いやすいインターフェイスで、PHP プロジェクト用の Ansible Playbook を生成してくれる。</li>
            </ul>


        </section>


        <section class="chapter" id="docker">
            <h2 id="docker_title">Docker</h2>

            <p><a href="http://docker.com/">Docker</a> - a lightweight alternative to a full virtual machine - is so called because it’s all about “containers”. A container is a building block which, in the simplest case, does one specific job, e.g. running a web server. An “image” is the package you use to build the container - Docker has a repository full of them.</p>

            <p>A typical LAMP application might have three containers: a web server, a PHP-FPM process and MySQL. As with shared folders in Vagrant, you can leave your application files where they are and tell Docker where to find them.</p>

            <p>You can generate containers from the command line (see example below) or, for ease of maintenance, build a <code class="highlighter-rouge">docker-compose.yml</code> file for your project specifying which to create and how they communicate with one another.</p>

            <p>Docker may help if you’re developing multiple websites and want the separation that comes from installing each on it’s own virtual machine, but don’t have the necessary disk space or the time to keep everything up to date. It’s efficient: the installation and downloads are quicker, you only need to store one copy of each image however often it’s used, containers need less RAM and share the same OS kernel, so you can have more servers running simultaneously, and it takes a matter of seconds to stop and start them, no need to wait for a full server boot.</p>

            <h3 id="例phpアプリケーションをdockerで実行する">例：PHPアプリケーションをDockerで実行する</h3>

            <p>マシンに<a href="https://docs.docker.com/installation/">Dockerをインストール</a>したら、あと一手間だけで、PHP が使える Apache 環境を用意できる。 次のコマンドは、最新版のPHP入りのApache環境をダウンロードして、 ディレクトリ <code class="highlighter-rouge">/path/to/your/php/files</code> を <code class="highlighter-rouge">http://localhost:8080</code> で見られるようにするものだ。</p>

            <figure class="highlight">
                <pre><code class="language-console" data-lang="console"><span class="err">docker run -d --name my-php-webserver -p 8080:80 -v /path/to/your/php/files:/var/www/html/ php:apache</span></code></pre>
            </figure>

            <p>これで、コンテナを初期化して実行できる。<code class="highlighter-rouge">-d</code> は、バックグラウンドで実行するオプションだ。 コンテナを停止したり、再開したりしたくなったりした場合は、nameに指定した名前を使って
                <code class="highlighter-rouge">docker stop my-php-webserver</code> や <code class="highlighter-rouge">docker start my-php-webserver</code> などとするだけだ。 さっきのパラメータを何度も指定する必要はない。
            </p>

            <h3 id="dockerについてもっと知りたい">Dockerについてもっと知りたい</h3>
            <p>ここではとりあえず、PHP の使える Apache 環境をお手軽に実行するためのコマンドだけを紹介した。 でも、Docker の実力はこんなものじゃなくて、まだまだいろんなことができる。 中でも、PHP 開発者にとっていちばん重要なのは、Web サーバーをデータベースのインスタンスに接続したりなどといった設定だ。 このあたりについては <a href="https://docs.docker.com/userguide/">Docker User Guide</a> を参照すること。 Take time to learn the terminology and read the <a href="https://docs.docker.com/userguide/">Docker User Guide</a> to get the most from it, and don’t run random code you’ve downloaded without checking it’s safe – unofficial images may not have the latest security patches. If in doubt, stick to the <a href="https://hub.docker.com/explore/">official repositiories</a>.</p>

            <p>The <a href="https://phpdocker.io/generator">PHPDocker.io</a> site will auto-generate all the files you need for a fully-featured LAMP/LEMP stack, including your choice of PHP version and extensions.</p>

            <ul>
                <li><a href="http://docker.com/">Docker 公式サイト</a></li>
                <li><a href="https://docs.docker.com/installation/">Docker のインストール</a></li>
                <li><a href="https://docs.docker.com/userguide/">Docker ユーザーガイド</a></li>
                <li><a href="https://hub.docker.com/">Docker Hub</a></li>
                <li><a href="https://hub.docker.com/explore/">Docker Hub - official images</a></li>
            </ul>


        </section>

        <div class="back-to-top">
            <p><a href="#top" class="top">Back to Top</a></p>
        </div>
        <section class="chapter" id="caching">
            <h1 id="caching_title">キャッシュ</h1>

            <p>PHP 自体は極めて高速だけど、リモート接続やファイルの読み込みなどが絡むとボトルネックになるかもしれない。 ありがたいことに、いろんなツールを活用すればアプリケーションを高速化できるし、 時間のかかる処理の実行回数を減らすこともできる。
            </p>

        </section>


        <section class="chapter" id="opcode_cache">
            <h2 id="opcode_cache_title">オペコードキャッシュ</h2>

            <p>PHPファイルを実行するときには、まずそれを<a href="http://php.net/manual/ja/internals2.opcodes.php">オペコード</a> (CPU用の機械語の指示) にコンパイルしなければいけない。 ソースコードに変更がなければ、オペコードも同じものになる。 ということは、PHP ファイルに変更がなければコンパイル処理は CPU リソースの無駄遣いになるということだ。</p>

            <p>オペコードキャッシュは、コンパイル済みのオペコードをメモリに格納し、それ以降の呼び出しで再利用することで、 冗長なコンパイルを回避している。よくあるのは、ファイルのシグネチャや更新時刻をチェックして変更の有無を判断する方式だ。
            </p>

            <p>オペコードキャッシュを使えば、アプリケーションの実行速度が相当向上する可能性がある。 PHP 5.5 からは、 <a href="http://php.net/book.opcache">Zend OPcache</a> というオペコードキャッシュが標準で組み込まれるようになった。 使っている PHP パッケージやディストリビューションにもよるけど、普通はデフォルトで有効になっていることが多い。
                <a href="http://php.net/manual/ja/opcache.configuration.php#ini.opcache.enable">opcache.enable</a> や、 <code class="highlighter-rouge">phpinfo()</code> の出力で確認しよう。 5.5 より前のバージョンなら、PECL の拡張モジュールが使える。</p>

            <p>オペコードキャッシュについて詳しく知りたければ、以下を参照すること。</p>

            <ul>
                <li><a href="http://php.net/book.opcache">Zend OPcache</a> (PHP 5.5 以降に組み込まれている)</li>
                <li>Zend OPcache (元 Zend Optimizer+) は <a href="https://github.com/zendtech/ZendOptimizerPlus">オープンソースになった</a></li>
                <li><a href="http://php.net/book.apc">APC</a> - PHP 5.4 以前のバージョン用</li>
                <li><a href="http://xcache.lighttpd.net/">XCache</a></li>
                <li><a href="http://www.iis.net/download/wincacheforphp">WinCache</a> (Microsoft Windows Server 用の拡張)</li>
                <li><a href="http://en.wikipedia.org/wiki/List_of_PHP_accelerators">Wikipediaにおける、PHPアクセラレータの一覧</a></li>
            </ul>


        </section>


        <section class="chapter" id="object_caching">
            <h2 id="object_caching_title">オブジェクトキャッシュ</h2>

            <p>コード内の個々のオブジェクトをキャッシュできれば便利なこともある。 持ってくるのにコストがかかるデータや、結果がほとんど変わらないデータベースへの問い合わせなどだ。 オブジェクトキャッシュ用のソフトウェアを使えば、こういったデータをメモリ上に保持でき、 その後のアクセスの高速化につながる。 一度取得したデータをどこかに格納しておいて、それ以降のリクエストではそこから直接取り出す。 そうすればパフォーマンスは劇的に向上するし、データベースサーバーにかかる負荷も減らせる。
            </p>

            <p>バイトコードキャッシュ用ソリューションの多くはカスタムデータも同様にキャッシュできるので、さらに活用できる。 APCu や XCache そして WinCache はすべて API を提供しており、PHP コードのデータをメモリキャッシュに格納できる。</p>

            <p>オブジェクトキャッシュシステムとして最もよく使われているのは APCu と memcached だ。 APCu はオブジェクトキャッシュの選択肢として最適で、 シンプルな API を使ってデータをメモリキャッシュに格納できる。 セットアップも簡単で、すぐに使えるようになる。 APCu の制約のひとつは、インストールしたサーバーと密接に結合してしまうことだ。 一方、Memcached は個別のサービスとしてインストールするものであり、 ネットワーク越しにアクセスできる。つまり、 中央で管理している超高速なストレージにオブジェクトを格納して、 いろんなシステムからそれを取り出せるということだ。
            </p>

            <p>PHPを(Fast-)CGIアプリケーションとしてウェブサーバーで実行するときには、 すべてのPHPプロセスが自身のキャッシュを持つことになる。つまり APCuのデータもワーカープロセス間では共有されないということだ。 こんなときには、かわりにmemcachedを検討すればいい。 こっちはPHPのプロセスには結びついていない。
            </p>

            <p>ネットワーク環境において、アクセス速度の面では APCu のほうが memcached より優れている。 しかし、memcached のほうが、より手軽にスケールアップできる。 複数のサーバーを使う予定がないとか memcached の追加機能が不要だという場合は、 オブジェクトキャッシュに APCu を選ぶのが最適だろう。</p>

            <p>APCu を使うロジックの例を示す。</p>

            <figure class="highlight">
                <pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="c1">// 'expensive_data' がキャッシュに保存されているかどうかを調べる
</span><span class="nv">$data</span> <span class="o">=</span> <span class="nb">apc_fetch</span><span class="p">(</span><span class="s1">'expensive_data'</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$data</span> <span class="o">===</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// データがキャッシュにないときは、コストのかかる操作をして取得する。
</span>    <span class="c1">// そして、その結果を保存してあとで使えるようにする。
</span>    <span class="nb">apc_add</span><span class="p">(</span><span class="s1">'expensive_data'</span><span class="p">,</span> <span class="nv">$data</span> <span class="o">=</span> <span class="nx">get_expensive_data</span><span class="p">());</span>
<span class="p">}</span>

<span class="nb">print_r</span><span class="p">(</span><span class="nv">$data</span><span class="p">);</span></code></pre>
            </figure>

            <p>PHP 5.5 より前のバージョンでは、APC がオブジェクトキャッシュとバイトコードキャッシュの両方の機能を提供していた。 APCu は、APC のオブジェクトキャッシュ機能を PHP 5.5 以降で使えるようにするものだ。 というのも、PHP 5.5 以降ではバイトコードキャッシュ（OPcache）の機能が標準で組み込まれるようになったからだ。</p>

            <h3 id="オブジェクトキャッシュシステムについての参考資料">オブジェクトキャッシュシステムについての参考資料</h3>

            <ul>
                <li><a href="https://github.com/krakjoe/apcu">APCu</a></li>
                <li><a href="http://php.net/ref.apc">APC 関数</a></li>
                <li><a href="http://memcached.org/">Memcached</a></li>
                <li><a href="http://redis.io/">Redis</a></li>
                <li><a href="http://xcache.lighttpd.net/wiki/XcacheApi">XCache APIs</a></li>
                <li><a href="http://php.net/ref.wincache">WinCache 関数</a></li>
            </ul>

        </section>

        <div class="back-to-top">
            <p><a href="#top" class="top">Back to Top</a></p>
        </div>
        <section class="chapter" id="documenting">
            <h1 id="documenting_title">Documenting your Code</h1>

        </section>


        <section class="chapter" id="phpdoc">
            <h2 id="phpdoc_title">PHPDoc</h2>

            <p>PHPDocは、非公式ながら、PHPのコードにコメントを書くときの標準として使われているものだ。
                <em>さまざまな</em> [タグ] が使える。 すべてのタグの一覧や実際の使用例は、 <a href="http://www.phpdoc.org/docs/latest/index.html">PHPDoc のマニュアル</a> を参照すること。</p>

            <p>いくつかのメソッドを持つクラスのドキュメントを書く例を示そう。</p>

            <figure class="highlight">
                <pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="sd">/**
 * @author A Name &lt;a.name@example.com&gt;
 * @link http://www.phpdoc.org/docs/latest/index.html
 */</span>
<span class="k">class</span> <span class="nc">DateTimeHelper</span>
<span class="p">{</span>
    <span class="sd">/**
     * @param mixed $anything Anything that we can convert to a \DateTime object
     *
     * @throws \InvalidArgumentException
     *
     * @return \DateTime
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">dateTimeFromAnything</span><span class="p">(</span><span class="nv">$anything</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$type</span> <span class="o">=</span> <span class="nb">gettype</span><span class="p">(</span><span class="nv">$anything</span><span class="p">);</span>

        <span class="k">switch</span> <span class="p">(</span><span class="nv">$type</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// Some code that tries to return a \DateTime object
</span>        <span class="p">}</span>

        <span class="k">throw</span> <span class="k">new</span> <span class="nx">\InvalidArgumentException</span><span class="p">(</span>
            <span class="s2">"Failed Converting param of type '</span><span class="si">{</span><span class="nv">$type</span><span class="si">}</span><span class="s2">' to DateTime object"</span>
        <span class="p">);</span>
    <span class="p">}</span>

    <span class="sd">/**
     * @param mixed $date Anything that we can convert to a \DateTime object
     *
     * @return void
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">printISO8601Date</span><span class="p">(</span><span class="nv">$date</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">echo</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">dateTimeFromAnything</span><span class="p">(</span><span class="nv">$date</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">format</span><span class="p">(</span><span class="s1">'c'</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="sd">/**
     * @param mixed $date Anything that we can convert to a \DateTime object
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">printRFC2822Date</span><span class="p">(</span><span class="nv">$date</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">echo</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">dateTimeFromAnything</span><span class="p">(</span><span class="nv">$date</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">format</span><span class="p">(</span><span class="s1">'r'</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre>
            </figure>

            <p>クラス全体のドキュメントの最初にあるのが <a href="http://www.phpdoc.org/docs/latest/references/phpdoc/tags/author.html">@author</a> タグと <a href="http://www.phpdoc.org/docs/latest/references/phpdoc/tags/link.html">@link</a> タグだ。
                <a href="http://www.phpdoc.org/docs/latest/references/phpdoc/tags/author.html">@author</a> タグは、コードの作者を表す。作者が複数いる場合は、何度も繰り返し使ってもかまわない。
                <a href="http://www.phpdoc.org/docs/latest/references/phpdoc/tags/link.html">@link</a> タグは、そのコードに関連するウェブサイトへのリンクを示すために使う。</p>

            <p>クラスの中に目を移すと、最初のメソッドには <a href="http://www.phpdoc.org/docs/latest/references/phpdoc/tags/param.html">@param</a> タグが記されている。 これは、このメソッドに渡すパラメータの型と名前そして説明を記述するものだ。 さらに、
                <a href="http://www.phpdoc.org/docs/latest/references/phpdoc/tags/return.html">@return</a> タグと
                <a href="http://www.phpdoc.org/docs/latest/references/phpdoc/tags/throws.html">@throws</a> タグも書かれている。 これらはそれぞれ、戻り値の型と、発生する可能性のある例外を記述するものだ。
            </p>

            <p>二番目と三番目のメソッドはほぼ同じだ。まず、最初のメソッドと同様に <a href="http://www.phpdoc.org/docs/latest/references/phpdoc/tags/param.html">@param</a> タグが書かれている。 二番目と三番目のメソッドの大きな違いは、 <a href="http://www.phpdoc.org/docs/latest/references/phpdoc/tags/return.html">@return</a> タグの有無だ。
                <code class="highlighter-rouge">@return void</code> は、このメソッドが何も戻さないことを明示している。 一方、歴史的に、 <code class="highlighter-rouge">@return void</code> を省略した場合も同じ意味（何も値を戻さない）になる。</p>


        </section>

        <div class="back-to-top">
            <p><a href="#top" class="top">Back to Top</a></p>
        </div>
        <section class="chapter" id="resources">
            <h1 id="resources_title">情報源</h1>

        </section>


        <section class="chapter" id="from_the_source">
            <h2 id="from_the_source_title">ソースから</h2>

            <ul>
                <li><a href="http://php.net/">PHP のサイト</a></li>
                <li><a href="http://php.net/docs.php">PHP のドキュメント</a></li>
            </ul>

        </section>


        <section class="chapter" id="people_to_follow">
            <h2 id="people_to_follow_title">フォローすべき人たち</h2>

            <p>PHPコミュニティの中で注目すべき人を見つけるのは、コミュニティに加わったばかりの人たちにとっては難しいものだ。 PHPコミュニティの主要メンバーとTwitterアカウントの一覧が、ここにまとまっている。
            </p>

            <ul>
                <li><a href="https://blog.newrelic.com/2014/05/02/25-php-developers-follow-online/">25 PHP Developers to Follow Online</a></li>
            </ul>


        </section>


        <section class="chapter" id="mentoring">
            <h2 id="mentoring_title">メンタリング</h2>

            <ul>
                <li><a href="http://php-mentoring.org/">php-mentoring.org</a> - Formal, peer to peer mentoring in the PHP community.</li>
            </ul>

        </section>


        <section class="chapter" id="php_paas_providers">
            <h2 id="php_paas_providers_title">PHP PaaS プロバイダ</h2>

            <ul>
                <li><a href="https://pagodabox.io/">PagodaBox</a></li>
                <li><a href="https://www.ctl.io/appfog/">AppFog</a></li>
                <li><a href="https://devcenter.heroku.com/categories/php">Heroku</a></li>
                <li><a href="https://www.fortrabbit.com/">fortrabbit</a></li>
                <li><a href="https://www.engineyard.com/features">Engine Yard Cloud</a></li>
                <li><a href="https://www.openshift.com/">Red Hat OpenShift Platform</a></li>
                <li><a href="https://aws.amazon.com/elasticbeanstalk/">AWS Elastic Beanstalk</a></li>
                <li><a href="http://www.windowsazure.com/">Windows Azure</a></li>
                <li><a href="https://cloud.google.com/appengine/docs/php/">Google App Engine</a></li>
                <li><a href="http://jelastic.com/">Jelastic</a></li>
                <li><a href="https://platform.sh/">Platform.sh</a></li>
                <li><a href="https://www.cloudways.com/en/">Cloudways</a></li>
                <li><a href="https://console.ng.bluemix.net/">IBM Bluemix Cloud Foundry</a></li>
                <li><a href="https://run.pivotal.io/">Pivotal Web Service Cloud Foundry</a></li>
            </ul>

            <p>これらのPaaSでどのバージョンのPHPが使われているのかを知りたければ、<a href="http://phpversions.info/paas-hosting/">PHP Versions</a> をチェックしよう。
            </p>

        </section>


        <section class="chapter" id="frameworks">
            <h1 id="frameworks_title">フレームワーク</h1>

            <p>PHP 開発者の多くは、ウェブアプリケーションを作るときに車輪の再発明を避けてフレームワークを使っている。 フレームワークを使えば低レベルの作業の多くを抽象化でき、 便利で使いやすいインターフェイスでよくある作業をこなせる。
            </p>

            <p>別に、フレームワークを使わないといけないというわけじゃない。 ふつうに PHP で書くべき場面だってある。 もしフレームワークを使うのなら、フレームワークはこんな感じに分類できることを知っておこう。
            </p>

            <ul>
                <li>マイクロフレームワーク</li>
                <li>フルスタックフレームワーク</li>
                <li>コンポーネントフレームワーク</li>
            </ul>

            <p>マイクロフレームワークというのは本質的にはラッパーで、 HTTP リクエストを手っ取り早くコールバックに振り分けるだけのものだ。 場合によっては、開発を支援するためのちょっとした追加ライブラリが付属することもある。 データベースの基本的なラッパーなどだ。マイクロフレームワークの主な使い道は、 リモート HTTP サービスの構築である。</p>

            <p>多くのフレームワークは、マイクロフレームワークが持つ機能に加えて大量の機能を用意している。 この種のフレームワークのことを、フルスタックフレームワークと呼ぶ。 ORM や認証パッケージなどが含まれることが多い。</p>

            <p>コンポーネントフレームワークとは、特定の目的のための専用ライブラリをとりまとめたフレームワークである。 この種のフレームワークのコンポーネントを各種組み合わせて、 マイクロフレームワークやフルスタックフレームワークを作ることもできる。
            </p>

            <ul>
                <li><a href="https://github.com/codeguy/php-the-right-way/wiki/Frameworks">PHP のフレームワーク一覧</a></li>
            </ul>

        </section>


        <section class="chapter" id="components">
            <h2 id="components_title">コンポーネント</h2>

            <p>先ほど説明したように、「コンポーネント」っていうのは 共有するコードを作ったりそれを配布したりするための手段のひとつだ。 コンポーネントを登録するリポジトリにもいろいろあるけど、中でも有名なのがこのふたつだ。
            </p>

            <ul>
                <li><a href="/#composer_と_packagist">Packagist</a></li>
                <li><a href="/#pear">PEAR</a></li>
            </ul>

            <p>どちらのリポジトリについてもコマンドラインのツールが存在し、 コンポーネントのインストールやアップグレードを簡単にできる。 詳細は
                <a href="/#依存関係の管理">依存関係の管理</a>を参照すること。</p>

            <p>コンポーネントベースのフレームワークもあれば、フレームワークを持たずにコンポーネントだけを提供するベンダーもある。 こういったプロジェクトが提供するパッケージは、他のパッケージや特定のフレームワークへの依存がほとんどない。
            </p>

            <p>たとえば<a href="https://github.com/fuelphp/validation">FuelPHPのValidationパッケージ</a>を使うときには、 別にFuelPHPフレームワークを使う必要はない。
            </p>

            <ul>
                <li><a href="http://auraphp.com/framework/2.x/ja/">Aura</a></li>
                <li><a href="https://github.com/fuelphp">FuelPHP</a></li>
                <li><a href="https://github.com/hoaproject">Hoa Project</a></li>
                <li><a href="https://github.com/orno">Orno</a></li>
                <li><a href="http://symfony.com/doc/current/components/index.html">Symfony Components</a></li>
                <li><a href="http://thephpleague.com/">The League of Extraordinary Packages</a></li>
                <li>Laravel’s Illuminate Components
                    <ul>
                        <li><a href="https://github.com/illuminate/container">IoC Container</a></li>
                        <li><a href="https://github.com/illuminate/database">Eloquent ORM</a></li>
                        <li><a href="https://github.com/illuminate/queue">Queue</a></li>
                    </ul>
                </li>
            </ul>

            <p><em>Laravelの <a href="https://github.com/illuminate">Illuminate コンポーネント</a> も、将来的には Laravel フレームワークからきちんと切り離されるようになるだろう。
現段階では、Laravel フレームワークからうまく切り離せているコンポーネントだけをリストにあげておいた。</em></p>


        </section>


        <section class="chapter" id="other_resources">
            <h2 id="other_resources_title">その他の資料</h2>

            <h3 id="チートシート">チートシート</h3>

            <ul>
                <li><a href="http://phpcheatsheets.com/">PHP Cheatsheets</a> - さまざまなバージョンの PHP における、変数の比較や演算など</li>
                <li><a href="https://www.owasp.org/index.php/PHP_Security_Cheat_Sheet">PHP Security Cheatsheet</a></li>
            </ul>

            <h3 id="ベストプラクティス">ベストプラクティス</h3>

            <ul>
                <li><a href="https://phpbestpractices.org/">PHP Best Practices</a></li>
                <li><a href="https://www.airpair.com/php/posts/best-practices-for-modern-php-development">Best practices for Modern PHP Development</a></li>
            </ul>

            <h3 id="news-around-the-php-and-web-development-communities">News around the PHP and web development communities</h3>
            <p>You can subscribe to weekly newsletters to keep yourself informed on new libraries, latest news, events and general announcements, as well as additional resources being published every now and then:</p>

            <ul>
                <li><a href="http://www.phpweekly.com">PHP Weekly</a></li>
                <li><a href="http://javascriptweekly.com">JavaScript Weekly</a></li>
                <li><a href="http://html5weekly.com">HTML5 Weekly</a></li>
                <li><a href="http://mobilewebweekly.co">Mobile Web Weekly</a></li>
                <li>There are also Weeklies on other platforms you might be interested in; here’s
                    <a href="https://github.com/jondot/awesome-weekly">a list of some</a>.</li>
            </ul>

            <h3 id="php界">PHP界</h3>

            <ul>
                <li><a href="http://blog.phpdeveloper.org/">PHP Developer blog</a></li>
            </ul>

        </section>


        <section class="chapter" id="videos">
            <h2 id="videos">動画チュートリアル</h2>

            <h3 id="youtubeチャンネル">YouTubeチャンネル</h3>
            <ul>
                <li><a href="https://www.youtube.com/user/phpacademy">PHP Academy</a></li>
                <li><a href="https://www.youtube.com/user/thenewboston">The New Boston</a></li>
                <li><a href="https://www.youtube.com/user/businessgeek">Sherif Ramadan</a></li>
                <li><a href="https://www.youtube.com/user/LevelUpTuts">Level Up Tuts</a></li>
            </ul>

            <h3 id="有償の動画">有償の動画</h3>

            <ul>
                <li><a href="http://teamtreehouse.com/library/standards-and-best-practices">Standards and Best practices</a></li>
                <li><a href="http://www.pluralsight.com/search/?searchTerm=php">PHP Training on Pluralsight</a></li>
                <li><a href="http://www.lynda.com/search?q=php">PHP Training on Lynda.com</a></li>
                <li><a href="http://code.tutsplus.com/categories/php/courses">PHP Training on Tutsplus</a></li>
                <li><a href="https://laracasts.com/">Laracasts</a></li>
            </ul>

        </section>


        <section class="chapter" id="books">
            <h2 id="books_title">書籍</h2>

            <p>PHPに関する本はいっぱい出てるけど、絶望的に古くなってしまっていてもはや正しい情報ではなくなっているものもある。 なぜか、この世に存在すらしていない「PHP 6」向けの本まで出ていたりする。 これが、PHP 5.6の次のメジャーバージョンの名前が「PHP 7」に決まった<a href="https://wiki.php.net/rfc/php6">理由のひとつかもしれない</a>。</p>

            <p>このセクションでは、PHPでの開発全般でおすすめの書籍を紹介する。 自分の本を載せて欲しいという人は、プルリクエストを出してもらえばレビューのうえで追加する。
            </p>

            <h3 id="無償の書籍">無償の書籍</h3>

            <ul>
                <li><a href="http://daylerees.com/php-pandas/">PHP Pandas</a> - ウェブ開発者になるための方法を教えるのが狙いだ。</li>
                <li><a href="https://leanpub.com/phptherightway/">PHP The Right Way</a> - このウェブサイトの内容が、無料の書籍として公開されている。</li>
                <li><a href="https://paragonie.com/book/pecl-libsodium">Using Libsodium in PHP Projects</a> - Libsodium 拡張モジュールを使って、 モダンでセキュアかつ高速な暗号化を行うためのガイド。
                </li>
            </ul>

            <h3 id="有償の書籍">有償の書籍</h3>

            <ul>
                <li><a href="https://apisyouwonthate.com/">Build APIs You Won’t Hate</a> - Everyone and their dog wants an API, so you should probably learn how to build them.</li>
                <li><a href="http://shop.oreilly.com/product/0636920033868.do">Modern PHP</a> - covers modern PHP features, best practices, testing, tuning, deployment and setting up a dev environment.</li>
                <li><a href="https://leanpub.com/buildingsecurephpapps">Building Secure PHP Apps</a> - Learn the security basics that a senior developer usually acquires over years of experience, all condensed down into one quick and easy handbook</li>
                <li><a href="https://leanpub.com/mlaphp">Modernizing Legacy Applications In PHP</a> - 細かく順を追って、自分のコードを手なずけていく。</li>
                <li><a href="https://leanpub.com/securingphp-coreconcepts">Securing PHP: Core Concepts</a> - A guide to some of the most common security terms and provides some examples of them in every day PHP</li>
                <li><a href="http://www.scalingphpbook.com/">Scaling PHP</a> - Stop playing sysadmin and get back to coding</li>
                <li><a href="https://leanpub.com/signalingphp">Signaling PHP</a> - PCNLT signals are a great help when writing PHP scripts that run from the command line.</li>
                <li><a href="https://leanpub.com/grumpy-testing">The Grumpy Programmer’s Guide To Building Testable PHP Applications</a> - Learning to write testable code doesn’t have to suck.</li>
                <li><a href="https://leanpub.com/minimumviabletests">Minimum Viable Tests</a> - Long-time PHP testing evangelist Chris Hartjes goes over what he feels is the minimum you need to know to get started.</li>
                <li><a href="https://leanpub.com/ddd-in-php">Domain-Driven Design in PHP</a> - See real examples written in PHP showcasing Domain-Driven Design Architectural Styles (Hexagonal Architecture, CQRS or Event Sourcing), Tactical Design Patterns, and Bounded Context Integration.</li>
            </ul>

        </section>

        <div class="back-to-top">
            <p><a href="#top" class="top">Back to Top</a></p>
        </div>
        <section class="chapter" id="community">
            <h1 id="community_title">コミュニティ</h1>

            <p>PHP のコミュニティは、規模が大きくなるにつれて多様化しており、 どこのコミュニティでも新たな仲間を歓迎している。 近所のユーザーグループに参加したり、ちょっと大きめのカンファレンスに参加したりすれば、 このページで紹介したことよりもずっと多くを学べるだろう。 IRC なら <a href="http://webchat.freenode.net/?channels=phpc">irc.freenode.com</a> に #phpc というチャンネルがあるし、 twitter なら <a href="https://twitter.com/phpc">@phpc</a> をフォローするといい。 いろんなところに飛び込んで、新しい人と出会って、いろんなことを学んで、友達になるんだ。 Google+にもPHPプログラマー向けの <a href="https://plus.google.com/u/0/communities/104245651975268426012">コミュニティ</a> があるし、
                <a href="http://stackoverflow.com/questions/tagged/php">StackOverflow</a> にもある。</p>

            <p><a href="http://php.net/cal.php">PHP 公式サイトのイベントカレンダー</a></p>


        </section>


        <section class="chapter" id="user_groups">
            <h2 id="user_groups_title">PHP ユーザーグループ</h2>

            <p>大都市に住んでいるなら、きっと近場に PHP ユーザーグループがあるはずだ。 近場の PHP ユーザーグループを見つけるには、<a href="http://php.net/ug.php">php.net のユーザーグループ一覧</a> を使えばいい。 これは
                <a href="http://php.ug/">PHP.ug</a>をベースにしたものだ。それ以外にも、<a href="http://www.meetup.com/find/">Meetup.com</a> を使ってもいいし、 お好みのサーチエンジン (たとえば <a href="https://www.google.com/search?q=php+user+group+near+me">Google</a> とか) で
                <code class="highlighter-rouge">php user group near me</code> みたいに検索してみるとかね。 小さな町なら、もしかしたらユーザーグループがないかもしれない。 だったら、作ればいい！
            </p>

            <p>数々のグループの中でも、特筆すべきものがある。<a href="https://nomadphp.com/">NomadPHP</a> と <a href="http://phpwomen.org/">PHPWomen</a> だ。
                <a href="https://nomadphp.com/">NomadPHP</a> は、オンラインでのミーティングを毎月2回開催している。 そのミーティングでは、PHP コミュニティの有名人によるプレゼンも行われている。
                <a href="http://phpwomen.org/">PHPWomen</a> は、PHP 界の女性をターゲットにしたユーザーグループだったが、今はそれにとどまらない。 より多様性のあるコミュニティを目指そうという人なら、誰でも受け入れている。 PHPWomen は、サポートやメンターシップ、教育などのネットワークを提供している。 そして「女性にやさしい」プロフェッショナルな空気を広めることを目指している。
            </p>

            <p><a href="https://wiki.php.net/usergroups">PHP Wiki のユーザーグループ情報</a></p>


        </section>


        <section class="chapter" id="conferences">
            <h2 id="conferences_title">PHP カンファレンス</h2>

            <p>世界各国で、地域レベルあるいは国レベルの大規模なカンファレンスが開かれている。 PHP界の有名人が登壇することも多いので、彼らから直接学ぶチャンスだ。
            </p>

            <p><a href="http://php.net/conferences/index.php">PHP のカンファレンスを探す</a></p>


        </section>


        <section class="chapter" id="elephpants">
            <h2 id="elephpants_title">ElePHPants</h2>

            <p><a href="http://php.net/elephpant.php">ElePHPant</a> は PHP プロジェクトのマスコットだ。 もともとは 1998 年に <a href="http://www.elroubio.net/">Vincent Pontier</a> がデザインしたもの。つまり彼は、世界中の elePHPant たちの父なる神である。 その約10年後には、かわいらしいぬいぐるみもできあがった。 いまやあちこちのPHPカンファレンスでelePHPantが見られるし、自分のPCのそばにelePHPantを置いているPHP開発者も多い。
            </p>

            <p><a href="http://7php.com/elephpant/">Vincent Pontierへのインタビュー</a></p>


        </section>


    </div>

    <footer class="site-footer" id="credits">
        <h2>Created and maintained by</h2>
        <ul>
            <li><a href="http://joshlockhart.com" target="_blank">Josh Lockhart</a></li>
            <li><a href="http://philsturgeon.co.uk/" target="_blank">Phil Sturgeon</a></li>
            <li><a href="https://github.com/codeguy/php-the-right-way/graphs/contributors" target="_blank">Project Contributors</a></li>
        </ul>
        <div class="license">
            <a class="cc-badge" rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/"></a>
            <br />
            <span xmlns:dct="http://purl.org/dc/terms/" href="http://purl.org/dc/dcmitype/Text" property="dct:title" rel="dct:type">PHP: The Right Way</span> by <a xmlns:cc="http://creativecommons.org/ns#" href="http://joshlockhart.com" property="cc:attributionName" rel="cc:attributionURL">Josh Lockhart</a>
            <br/> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/">Creative Commons Attribution-NonCommercial-ShareAlike 3.0 Unported License</a>.<br />Based on a work at <a xmlns:dct="http://purl.org/dc/terms/" href="http://www.phptherightway.com" rel="dct:source">www.phptherightway.com</a>.
        </div>
    </footer>
    <script>
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-362072-7']);
        _gaq.push(['_trackPageview']);
        (function() {
            var ga = document.createElement('script');
            ga.type = 'text/javascript';
            ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'stats.g.doubleclick.net/dc.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(ga, s);
        })();

    </script>
</body>

</html>
